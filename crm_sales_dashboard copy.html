u<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRM - Wsparcie Sprzeda≈ºy | SOHOsoft</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f8f9fa;
            color: #1f2937;
            line-height: 1.6;
        }

        /* Header */
        .header {
            background: white;
            border-bottom: 1px solid #e5e7eb;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-top {
            background: #1f2937;
            color: white;
            padding: 0.5rem 2rem;
            font-size: 0.75rem;
        }

        .header-main {
            padding: 1rem 2rem;
            border-bottom: 1px solid #e5e7eb;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.5rem;
            font-weight: 700;
            color: #1f2937;
            text-decoration: none;
        }

        .logo-main {
            font-family: serif;
            color: #3b82f6;
        }

        .logo-sub {
            font-size: 0.875rem;
            font-weight: 300;
            color: #6b7280;
        }

        .main-nav {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .nav-item {
            position: relative;
            padding: 0.75rem 1rem;
            color: #6b7280;
            text-decoration: none;
            font-weight: 500;
            border-radius: 6px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-item span:first-child {
            display: none;
        }

        .nav-item:hover {
            background: #f3f4f6;
            color: #1f2937;
        }

        .nav-item.active {
            background: #f0f9ff;
            color: #3b82f6;
        }

        .nav-item.active::after {
            content: '';
            position: absolute;
            bottom: -1rem;
            left: 0;
            right: 0;
            height: 2px;
            background: #3b82f6;
        }

        .nav-dropdown {
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            min-width: 200px;
            display: none;
            z-index: 1000;
        }

        .nav-item:hover .nav-dropdown {
            display: block;
        }

        .nav-dropdown-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            color: #6b7280;
            text-decoration: none;
            transition: all 0.2s;
        }

        .nav-dropdown-item span:first-child {
            display: none;
        }

        .nav-dropdown-item:hover {
            background: #f9fafb;
            color: #1f2937;
        }

        .nav-dropdown-item.active {
            background: #dbeafe;
            color: #3b82f6;
        }

        .breadcrumb {
            color: #6b7280;
            font-size: 0.875rem;
        }

        .breadcrumb span {
            color: #1f2937;
            font-weight: 500;
        }

        /* Navigation Tabs */
        .nav-tabs {
            background: white;
            border-bottom: 1px solid #e5e7eb;
            padding: 0 2rem;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 2rem;
            position: relative;
        }

        .nav-tab {
            padding: 1rem 0;
            color: #6b7280;
            text-decoration: none;
            border-bottom: 2px solid transparent;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .nav-tab:hover {
            color: #3b82f6;
        }

        .nav-tab.active {
            color: #3b82f6;
            border-bottom-color: #3b82f6;
        }

        .nav-tabs .btn {
            position: absolute;
            right: 2rem;
            top: 50%;
            transform: translateY(-50%);
        }

        /* BoxIcons styling */
        .bx {
            color: #3b82f6;
            font-size: 1.2rem;
        }

        .task-icon .bx {
            font-size: 1.5rem;
        }

        .activity-icon .bx {
            font-size: 1.5rem;
        }

        .goal-action-button .bx {
            color: white;
            font-size: 0.875rem;
        }

        /* Business Rules Styles */
        .business-rules-list {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .rule-item {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 1.5rem;
            transition: all 0.2s;
        }

        .rule-item:hover {
            background: #f3f4f6;
            border-color: #d1d5db;
        }

        .rule-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .rule-info h4 {
            margin: 0 0 0.5rem 0;
            color: #1f2937;
            font-size: 1.125rem;
            font-weight: 600;
        }

        .rule-description {
            margin: 0;
            color: #6b7280;
            font-size: 0.875rem;
            line-height: 1.4;
        }

        .rule-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .rule-details {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 1.5rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #e5e7eb;
        }

        .rule-triggers,
        .rule-actions,
        .rule-parameters {
            background: white;
            padding: 1rem;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
        }

        .rule-triggers strong,
        .rule-actions strong,
        .rule-parameters strong {
            color: #374151;
            font-size: 0.875rem;
            display: block;
            margin-bottom: 0.5rem;
        }

        .rule-triggers ul,
        .rule-actions ul {
            margin: 0;
            padding-left: 1rem;
            color: #6b7280;
            font-size: 0.813rem;
            line-height: 1.4;
        }

        .rule-triggers li,
        .rule-actions li {
            margin-bottom: 0.25rem;
        }

        .rule-parameters span {
            color: #6b7280;
            font-size: 0.813rem;
            line-height: 1.4;
        }

        .rule-actions ul li strong {
            color: #dc2626;
            font-weight: 600;
            display: inline;
            margin: 0;
        }

        @media (max-width: 768px) {
            .rule-details {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .rule-header {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }
            
            .rule-controls {
                justify-content: space-between;
            }
        }

        /* Rule Form Styles */
        .trigger-item,
        .action-item {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
            align-items: center;
        }

        .trigger-item input,
        .action-item input {
            flex: 1;
        }

        .trigger-item button,
        .action-item button {
            flex-shrink: 0;
            padding: 0.5rem 0.75rem;
            font-size: 0.813rem;
        }

        /* Scoring Configuration Styles */
        .scoring-config-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .scoring-category h4 {
            margin: 0 0 1rem 0;
            color: #1f2937;
            font-size: 1.125rem;
            font-weight: 600;
        }

        .scoring-items {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .scoring-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
        }

        .scoring-item span {
            font-weight: 500;
            color: #374151;
        }

        .scoring-points {
            width: 25% !important;
            text-align: center;
        }

        .scoring-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        /* Form Section Styles */
        .form-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: #f9fafb;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }

        .form-section h4 {
            margin: 0 0 1.5rem 0;
            color: #1f2937;
            font-size: 1.125rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .form-row.three-cols {
            grid-template-columns: 1fr 1fr 1fr;
        }

        /* Checkbox Group Styles */
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 0.75rem;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }

        .checkbox-item input[type="checkbox"] {
            margin: 0;
        }

        .checkbox-item span {
            font-size: 0.875rem;
            color: #374151;
        }

        /* Trigger and Action Config Styles */
        .trigger-config,
        .action-config {
            flex: 1;
            margin-right: 1rem;
        }

        .scoring-trigger-config,
        .custom-trigger-config {
            margin-top: 1rem;
        }

        .trigger-item,
        .action-item {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            margin-bottom: 1rem;
            padding: 1rem;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
        }


        .scoring-points-input,
        .scoring-time-input,
        .action-time-input {
            width: 100%;
        }

        @media (max-width: 768px) {
            .scoring-config-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .checkbox-group {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .trigger-item,
            .action-item {
                flex-direction: column;
                align-items: stretch;
            }
            
            .trigger-config,
            .action-config {
                margin-right: 0;
                margin-bottom: 1rem;
            }
        }

        /* Main Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Cards */
        .ecme-card {
            background: white;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1f2937;
        }

        /* Metrics Grid */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .metric-card {
            background: white;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
            padding: 1.5rem;
        }

        .metric-label {
            font-size: 0.875rem;
            color: #6b7280;
            margin-bottom: 0.5rem;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }

        .metric-change {
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .metric-change.positive {
            color: #10b981;
        }

        .metric-change.negative {
            color: #ef4444;
        }

        .metric-change.neutral {
            color: #6b7280;
        }

        /* Buttons */
        .btn {
            padding: 0.625rem 1.25rem;
            border-radius: 6px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.875rem;
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
        }

        .btn-primary:hover {
            background: #2563eb;
        }

        .btn-secondary {
            background: #f3f4f6;
            color: #1f2937;
        }

        .btn-secondary:hover {
            background: #e5e7eb;
        }

        /* Goals Section */
        .goals-grid {
            display: grid;
            gap: 1rem;
        }

        .goal-item {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .goal-item:hover {
            background: #f3f4f6;
        }

        .goal-actions {
            display: none;
            flex-direction: column;
            gap: 0.5rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #e5e7eb;
        }

        .goal-actions.show {
            display: flex;
        }

        .goal-action-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem;
            background: white;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
        }

        .goal-action-text {
            font-size: 0.875rem;
            color: #374151;
        }

        .goal-action-button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 0.375rem 0.75rem;
            border-radius: 4px;
            font-size: 0.75rem;
            cursor: pointer;
        }

        .goal-action-button:hover {
            background: #2563eb;
        }

        .goal-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 0.75rem;
        }

        .goal-title {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.25rem;
        }

        .goal-meta {
            font-size: 0.813rem;
            color: #6b7280;
        }

        .goal-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .goal-badge.liczbowy {
            background: #dbeafe;
            color: #1e40af;
        }

        .goal-badge.jakosciowy {
            background: #f3e8ff;
            color: #6b21a8;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }

        .progress-fill {
            height: 100%;
            background: #3b82f6;
            transition: width 0.3s ease;
        }

        .progress-fill.complete {
            background: #10b981;
        }

        .progress-label {
            font-size: 0.813rem;
            color: #6b7280;
        }

        /* Tasks Section */
        .task-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .task-item {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.2s;
        }

        .task-item:hover {
            border-color: #3b82f6;
            background: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .task-content {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex: 1;
        }

        .task-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #dbeafe;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            flex-shrink: 0;
        }

        .task-details {
            flex: 1;
        }

        .task-title {
            font-weight: 500;
            color: #1f2937;
            margin-bottom: 0.25rem;
        }

        .task-meta {
            font-size: 0.813rem;
            color: #6b7280;
        }

        .task-priority {
            display: inline-block;
            padding: 0.25rem 0.625rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
            margin-left: 0.5rem;
        }

        .task-priority.high {
            background: #fee2e2;
            color: #991b1b;
        }

        .task-priority.medium {
            background: #fef3c7;
            color: #92400e;
        }

        .task-priority.low {
            background: #dbeafe;
            color: #1e40af;
        }

        .task-action {
            margin-left: 1rem;
        }

        .btn-success {
            background: #3b82f6;
            color: white;
            border: 1px solid #3b82f6;
        }

        .btn-success:hover {
            background: #2563eb;
            border-color: #2563eb;
        }

        .btn-warning {
            background: #6b7280;
            color: white;
            border: 1px solid #6b7280;
        }

        .btn-warning:hover {
            background: #4b5563;
            border-color: #4b5563;
        }

        .btn-outline {
            background: white;
            border: 1px solid #3b82f6;
            color: #3b82f6;
        }

        .btn-outline:hover {
            background: #f0f9ff;
            color: #1e40af;
            border-color: #1e40af;
        }

        .task-item {
            cursor: move;
            transition: all 0.2s;
            position: relative;
        }

        .task-drag-handle {
            position: absolute;
            left: 0.5rem;
            top: 50%;
            transform: translateY(-50%);
            color: #9ca3af;
            font-size: 1.2rem;
            cursor: grab;
        }

        .task-drag-handle:active {
            cursor: grabbing;
        }

        .task-item:hover {
            background: #f9fafb;
        }

        .task-item.dragging {
            opacity: 0.5;
        }

        .task-item.completed {
            opacity: 0.6;
            text-decoration: line-through;
        }

        .task-checkbox {
            margin-right: 0.75rem;
            margin-left: 2rem;
        }

        .task-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* Activity Feed */
        .activity-feed {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .activity-item {
            display: flex;
            gap: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e5e7eb;
            cursor: pointer;
            transition: all 0.2s;
        }

        .activity-item:hover {
            background: #f9fafb;
            margin: 0 -0.5rem;
            padding-left: 0.5rem;
            padding-right: 0.5rem;
            border-radius: 6px;
        }

        .activity-item:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #f3f4f6;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-weight: 500;
            color: #1f2937;
            margin-bottom: 0.25rem;
        }

        .activity-meta {
            font-size: 0.813rem;
            color: #6b7280;
        }

        .activity-time {
            font-size: 0.813rem;
            color: #9ca3af;
            white-space: nowrap;
        }

        .activity-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .activity-actions .btn {
            font-size: 0.75rem;
            padding: 0.375rem 0.75rem;
        }

        /* Customers Table */
        .customers-table {
            width: 100%;
            border-collapse: collapse;
        }

        .customers-table thead {
            background: #f9fafb;
        }

        .customers-table th {
            text-align: left;
            padding: 0.75rem;
            font-size: 0.813rem;
            font-weight: 600;
            color: #6b7280;
            border-bottom: 1px solid #e5e7eb;
        }

        .customers-table td {
            padding: 1rem 0.75rem;
            border-bottom: 1px solid #e5e7eb;
            font-size: 0.875rem;
        }

        .customers-table tbody tr:hover {
            background: #f9fafb;
        }

        .customer-name {
            font-weight: 500;
            color: #1f2937;
        }

        .customer-company {
            font-size: 0.813rem;
            color: #6b7280;
        }

        .tag {
            display: inline-block;
            padding: 0.25rem 0.625rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
            background: #dbeafe;
            color: #1e40af;
        }

        /* Notes Section */
        .note-item {
            background: #fffbeb;
            border: 1px solid #fef3c7;
            border-radius: 6px;
            padding: 1rem;
            margin-bottom: 0.75rem;
        }

        .note-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .note-type {
            font-size: 0.75rem;
            font-weight: 500;
            color: #92400e;
        }

        .note-date {
            font-size: 0.75rem;
            color: #92400e;
        }

        .note-content {
            font-size: 0.875rem;
            color: #1f2937;
        }

        /* Calendar */
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .calendar-nav {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: #e5e7eb;
            border: 1px solid #e5e7eb;
        }

        .calendar-day-header {
            background: #f9fafb;
            padding: 0.5rem;
            text-align: center;
            font-size: 0.813rem;
            font-weight: 600;
            color: #6b7280;
        }

        .calendar-day {
            background: white;
            min-height: 100px;
            padding: 0.5rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        .calendar-day:hover {
            background: #f9fafb;
        }

        .calendar-day-number {
            font-size: 0.875rem;
            font-weight: 500;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }

        .calendar-day.other-month {
            background: #f9fafb;
        }

        .calendar-day.other-month .calendar-day-number {
            color: #9ca3af;
        }

        .calendar-event {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            margin-bottom: 0.25rem;
            background: #dbeafe;
            color: #1e40af;
        }

        .calendar-event.visit {
            background: #dcfce7;
            color: #166534;
        }

        /* Map */
        #route-map {
            height: 500px;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
        }

        .route-list {
            margin-top: 1rem;
        }

        .route-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            margin-bottom: 0.75rem;
        }

        .route-number {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #3b82f6;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            flex-shrink: 0;
        }

        .route-info {
            flex: 1;
        }

        .route-customer {
            font-weight: 500;
            color: #1f2937;
        }

        .route-address {
            font-size: 0.813rem;
            color: #6b7280;
        }

        .route-time {
            font-size: 0.813rem;
            color: #6b7280;
            text-align: right;
        }

        /* Forms */
        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 0.625rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.875rem;
            background: #f9fafb;
            transition: all 0.2s;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: #3b82f6;
            background: white;
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 8px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #6b7280;
            cursor: pointer;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 44px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #d1d5db;
            transition: 0.3s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: #3b82f6;
        }

        input:checked + .toggle-slider:before {
            transform: translateX(20px);
        }

        /* Alert Box */
        .alert {
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
            display: flex;
            align-items: start;
            gap: 0.75rem;
        }

        .alert-info {
            background: #dbeafe;
            border: 1px solid #93c5fd;
            color: #1e40af;
        }

        .alert-warning {
            background: #fef3c7;
            border: 1px solid #fde68a;
            color: #92400e;
        }

        .alert-icon {
            flex-shrink: 0;
        }

        /* Action Type Selector */
        .action-type-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .action-type-option {
            padding: 1.5rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .action-type-option:hover {
            border-color: #3b82f6;
            background: #f0f9ff;
        }

        .action-type-option.selected {
            border-color: #3b82f6;
            background: #dbeafe;
        }

        .action-type-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .action-type-label {
            font-weight: 500;
            color: #1f2937;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .main-nav {
                gap: 1rem;
            }
            
            .nav-item {
                padding: 0.5rem 0.75rem;
                font-size: 0.875rem;
            }
        }

        @media (max-width: 1200px) {
            .metrics-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .metrics-grid {
                grid-template-columns: 1fr;
            }

            .nav-tabs {
                overflow-x: auto;
            }

            .action-type-selector {
                grid-template-columns: 1fr;
            }

            .header-top {
                display: none;
            }

            .main-nav {
                display: none;
            }

            .header-content {
                justify-content: space-between;
            }

            .breadcrumb {
                font-size: 0.75rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <!-- Top Bar -->
        <div class="header-top">
            <div style="max-width: 1400px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center;">
                <div>Witaj w systemie SOHOsoft</div>
                <div>Wersja 2.1.4 | Ostatnie logowanie: 5 listopada 2024, 09:15</div>
            </div>
        </div>

        <!-- Main Header -->
        <div class="header-main">
            <div class="header-content">
                <!-- Logo -->
                <a href="#" class="logo">
                    <span class="logo-main">SOHO</span>
                    <span class="logo-sub">SOFT</span>
                </a>

                <!-- Main Navigation -->
                <nav class="main-nav">
                    <a href="#" class="nav-item">
                        <span>üè†</span>
                        Pulpit
                    </a>
                    
                    <a href="#" class="nav-item">
                        <span>üí∞</span>
                        Zam√≥wienia
                        <span>‚ñº</span>
                        <div class="nav-dropdown">
                            <a href="#" class="nav-dropdown-item">
                                <span>üìã</span>
                                Nowe zam√≥wienia
                            </a>
                            <a href="#" class="nav-dropdown-item">
                                <span>üìä</span>
                                Raporty sprzeda≈ºy
                            </a>
                            <a href="#" class="nav-dropdown-item">
                                <span>üîÑ</span>
                                Historia zam√≥wie≈Ñ
                            </a>
                        </div>
                    </a>
                    
                    <a href="#" class="nav-item">
                        <span>üë•</span>
                        Klienci
                        <span>‚ñº</span>
                        <div class="nav-dropdown">
                            <a href="#" class="nav-dropdown-item">
                                <span>üìù</span>
                                Lista klient√≥w
                            </a>
                            <a href="#" class="nav-dropdown-item">
                                <span>‚ûï</span>
                                Nowy klient
                            </a>
                            <a href="#" class="nav-dropdown-item">
                                <span>üìà</span>
                                Segmentacja
                            </a>
                        </div>
                    </a>
                    
                    <a href="#" class="nav-item">
                        <span>üì¶</span>
                        Asortyment
                        <span>‚ñº</span>
                        <div class="nav-dropdown">
                            <a href="#" class="nav-dropdown-item">
                                <span>üìã</span>
                                Katalog produkt√≥w
                            </a>
                            <a href="#" class="nav-dropdown-item">
                                <span>üè∑Ô∏è</span>
                                Kategorie
                            </a>
                            <a href="#" class="nav-dropdown-item">
                                <span>üìä</span>
                                Stan magazynowy
                            </a>
                        </div>
                    </a>
                    
                    <a href="#" class="nav-item active">
                        <span>üè∑Ô∏è</span>
                        Wsparcie sprzeda≈ºy
                        <span>‚ñº</span>
                        <div class="nav-dropdown">
                            <a href="#" class="nav-dropdown-item active">
                                <span>üìä</span>
                                CRM
                            </a>
                            <a href="#" class="nav-dropdown-item">
                                <span>üí∞</span>
                                Cenniki
                            </a>
                            <a href="#" class="nav-dropdown-item">
                                <span>üìà</span>
                                Cele handlowe
                            </a>
                            <a href="#" class="nav-dropdown-item">
                                <span>üóìÔ∏è</span>
                                Kalendarz
                            </a>
                        </div>
                    </a>
                    
                    <a href="#" class="nav-item">
                        <span>üì¢</span>
                        Marketing
                        <span>‚ñº</span>
                        <div class="nav-dropdown">
                            <a href="#" class="nav-dropdown-item">
                                <span>üìß</span>
                                Kampanie email
                            </a>
                            <a href="#" class="nav-dropdown-item">
                                <span>üì±</span>
                                Social Media
                            </a>
                            <a href="#" class="nav-dropdown-item">
                                <span>üìä</span>
                                Analityka
                            </a>
                        </div>
                    </a>
                    
                    <a href="#" class="nav-item">
                        <span>üõ°Ô∏è</span>
                        Administracja
                        <span>‚ñº</span>
                        <div class="nav-dropdown">
                            <a href="#" class="nav-dropdown-item">
                                <span>üë§</span>
                                U≈ºytkownicy
                            </a>
                            <a href="#" class="nav-dropdown-item">
                                <span>‚öôÔ∏è</span>
                                Ustawienia
                            </a>
                            <a href="#" class="nav-dropdown-item">
                                <span>üìä</span>
                                Logi systemu
                            </a>
                        </div>
                    </a>
                </nav>

                <!-- Header Actions -->
                <div style="display: flex; align-items: center; gap: 1rem;">
                </div>
            </div>
        </div>
    </div>


    <!-- Navigation Tabs -->
    <div class="nav-tabs">
        <a class="nav-tab active" onclick="switchTab('dashboard')">Dashboard</a>
        <a class="nav-tab" onclick="switchTab('goals')">Cele handlowe</a>
        <a class="nav-tab" onclick="switchTab('customers')">Klienci</a>
        <a class="nav-tab" onclick="switchTab('calendar')">Kalendarz</a>
        <a class="nav-tab" onclick="switchTab('routes')">Trasy wizyt</a>
        <a class="nav-tab" onclick="switchTab('settings')">Ustawienia</a>
        <button class="btn btn-primary" onclick="showModal('addModal')">+ Dodaj</button>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <!-- Metrics Grid - 8 wska≈∫nik√≥w -->
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-label">Przychody</div>
                    <div class="metric-value">124 890 PLN</div>
                    <div class="metric-change positive">
                        <span>‚Üë</span> +12% vs poprzedni
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Transakcje</div>
                    <div class="metric-value">342</div>
                    <div class="metric-change positive">
                        <span>‚Üë</span> +8% w tym okresie
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">≈öredni koszyk</div>
                    <div class="metric-value">365 PLN</div>
                    <div class="metric-change positive">
                        <span>‚Üë</span> +4% vs poprzedni
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Konwersja</div>
                    <div class="metric-value">3.7%</div>
                    <div class="metric-change neutral">
                        <span>‚Üí</span> Bez zmian
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Liczba klient√≥w</div>
                    <div class="metric-value">47</div>
                    <div class="metric-change positive">
                        <span>‚Üë</span> +5 w tym miesiƒÖcu
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">LTV klienta</div>
                    <div class="metric-value">24 750 PLN</div>
                    <div class="metric-change positive">
                        <span>‚Üë</span> +15% wzrost
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Czƒôstotliwo≈õƒá zakup√≥w</div>
                    <div class="metric-value">2.3 / mies.</div>
                    <div class="metric-change negative">
                        <span>‚Üì</span> -7% vs poprzedni
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Realizacja cel√≥w</div>
                    <div class="metric-value">73%</div>
                    <div class="metric-change negative">
                        <span>‚Üì</span> 5 cel√≥w w op√≥≈∫nieniu
                    </div>
                </div>
            </div>


            <!-- Tasks for Today -->
            <div class="ecme-card">
                <div class="card-header">
                    <h3 class="card-title">Zadania na dzi≈õ</h3>
                    <button class="btn btn-primary" onclick="showModal('addModal')">+ Nowe zadanie</button>
                </div>
                <div class="task-list" id="taskList">
                    <div class="task-item" draggable="true">
                        <div class="task-drag-handle">‚ãÆ‚ãÆ</div>
                        <input type="checkbox" class="task-checkbox" onchange="toggleTask(this)">
                        <div class="task-content">
                            <div class="task-icon"><i class='bx bx-car'></i></div>
                            <div class="task-details">
                                <div class="task-title">Wizyta u klienta - Restauracja Italiana
                                    <span class="task-priority high">Wysoki</span>
                                </div>
                                <div class="task-meta">10:00 ‚Ä¢ ul. Marsza≈Çkowska 15, Warszawa ‚Ä¢ Om√≥wienie nowej oferty</div>
                            </div>
                        </div>
                        <div class="task-actions">
                            <button class="btn btn-secondary" onclick="editTask(this)">Edytuj</button>
                            <button class="btn btn-success">Rozpocznij</button>
                        </div>
                    </div>

                    <div class="task-item" draggable="true">
                        <div class="task-drag-handle">‚ãÆ‚ãÆ</div>
                        <input type="checkbox" class="task-checkbox" onchange="toggleTask(this)">
                        <div class="task-content">
                            <div class="task-icon"><i class='bx bx-car'></i></div>
                            <div class="task-details">
                                <div class="task-title">Wizyta u klienta - Hotel Grand
                                    <span class="task-priority high">Wysoki</span>
                                </div>
                                <div class="task-meta">14:30 ‚Ä¢ ul. Nowy ≈öwiat 45, Warszawa ‚Ä¢ Prezentacja nowych produkt√≥w</div>
                            </div>
                        </div>
                        <div class="task-actions">
                            <button class="btn btn-secondary" onclick="editTask(this)">Edytuj</button>
                            <button class="btn btn-success">Szczeg√≥≈Çy</button>
                        </div>
                    </div>

                    <div class="task-item" draggable="true">
                        <div class="task-drag-handle">‚ãÆ‚ãÆ</div>
                        <input type="checkbox" class="task-checkbox" onchange="toggleTask(this)">
                        <div class="task-content">
                            <div class="task-icon"><i class='bx bx-user-plus'></i></div>
                            <div class="task-details">
                                <div class="task-title">Pozyskaj 2 nowe rejestracje
                                    <span class="task-priority medium">≈öredni</span>
                                </div>
                                <div class="task-meta">Cel Q4 2024 ‚Ä¢ Pozosta≈Ço: 11 rejestracji do ko≈Ñca kwarta≈Çu</div>
                            </div>
                        </div>
                        <div class="task-actions">
                            <button class="btn btn-secondary" onclick="editTask(this)">Edytuj</button>
                            <button class="btn btn-success">Zobacz leady</button>
                        </div>
                    </div>

                    <div class="task-item" draggable="true">
                        <div class="task-drag-handle">‚ãÆ‚ãÆ</div>
                        <input type="checkbox" class="task-checkbox" onchange="toggleTask(this)">
                        <div class="task-content">
                            <div class="task-icon"><i class='bx bx-phone-call'></i></div>
                            <div class="task-details">
                                <div class="task-title">Rozmowa telefoniczna - Bistro Central
                                    <span class="task-priority medium">≈öredni</span>
                                </div>
                                <div class="task-meta">16:00 ‚Ä¢ Potwierdzenie zam√≥wienia na imprezƒô firmowƒÖ</div>
                            </div>
                        </div>
                        <div class="task-actions">
                            <button class="btn btn-secondary" onclick="editTask(this)">Edytuj</button>
                            <button class="btn btn-success">Rozpocznij</button>
                        </div>
                    </div>

                    <div class="task-item" draggable="true">
                        <div class="task-drag-handle">‚ãÆ‚ãÆ</div>
                        <input type="checkbox" class="task-checkbox" onchange="toggleTask(this)">
                        <div class="task-content">
                            <div class="task-icon"><i class='bx bx-envelope'></i></div>
                            <div class="task-details">
                                <div class="task-title">Wys≈Çanie oferty - Catering Plus
                                    <span class="task-priority low">Niski</span>
                                </div>
                                <div class="task-meta">18:00 ‚Ä¢ Nowa oferta sezonowa na ≈õwiƒôta</div>
                            </div>
                        </div>
                        <div class="task-actions">
                            <button class="btn btn-secondary" onclick="editTask(this)">Edytuj</button>
                            <button class="btn btn-success">Rozpocznij</button>
                        </div>
                    </div>

                    
                </div>
            </div>

            <!-- Two Column Layout -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                <!-- Recent Activity -->
                <div class="ecme-card">
                    <div class="card-header">
                        <h3 class="card-title">Ostatnie aktywno≈õci klient√≥w</h3>
                    </div>
                    <div class="activity-feed">
                        <div class="activity-item" onclick="showActivityActions(this)">
                            <div class="activity-icon"><i class='bx bx-shopping-bag'></i></div>
                            <div class="activity-content">
                                <div class="activity-title">Nowe zam√≥wienie #8915</div>
                                <div class="activity-meta">Restauracja Italiana ‚Ä¢ 2,450 PLN</div>
                                <div class="activity-actions" style="display: none;">
                                    <button class="btn btn-secondary" onclick="event.stopPropagation(); showNoteModal('Restauracja Italiana')">+ Notatka</button>
                                    <button class="btn btn-primary" onclick="event.stopPropagation(); showTaskModal('Restauracja Italiana')">+ Zadanie</button>
                                </div>
                            </div>
                            <div class="activity-time">2 godz. temu</div>
                        </div>
                        <div class="activity-item" onclick="showActivityActions(this)">
                            <div class="activity-icon"><i class='bx bx-user-plus'></i></div>
                            <div class="activity-content">
                                <div class="activity-title">Nowa rejestracja</div>
                                <div class="activity-meta">Cafe Aroma ‚Ä¢ Warszawa</div>
                                <div class="activity-actions" style="display: none;">
                                    <button class="btn btn-secondary" onclick="event.stopPropagation(); showNoteModal('Cafe Aroma')">+ Notatka</button>
                                    <button class="btn btn-primary" onclick="event.stopPropagation(); showTaskModal('Cafe Aroma')">+ Zadanie</button>
                                </div>
                            </div>
                            <div class="activity-time">5 godz. temu</div>
                        </div>
                        <div class="activity-item" onclick="showActivityActions(this)">
                            <div class="activity-icon"><i class='bx bx-search'></i></div>
                            <div class="activity-content">
                                <div class="activity-title">PrzeglƒÖda≈Ç produkty</div>
                                <div class="activity-meta">Bistro Central ‚Ä¢ Pojemniki CN 1/3</div>
                                <div class="activity-actions" style="display: none;">
                                    <button class="btn btn-secondary" onclick="event.stopPropagation(); showNoteModal('Bistro Central')">+ Notatka</button>
                                    <button class="btn btn-primary" onclick="event.stopPropagation(); showTaskModal('Bistro Central')">+ Zadanie</button>
                                </div>
                            </div>
                            <div class="activity-time">1 dzie≈Ñ temu</div>
                        </div>
                        <div class="activity-item" onclick="showActivityActions(this)">
                            <div class="activity-icon"><i class='bx bx-x-circle'></i></div>
                            <div class="activity-content">
                                <div class="activity-title">Porzucony koszyk</div>
                                <div class="activity-meta">Catering Plus ‚Ä¢ 850 PLN warto≈õci</div>
                                <div class="activity-actions" style="display: none;">
                                    <button class="btn btn-secondary" onclick="event.stopPropagation(); showNoteModal('Catering Plus')">+ Notatka</button>
                                    <button class="btn btn-primary" onclick="event.stopPropagation(); showTaskModal('Catering Plus')">+ Zadanie</button>
                                </div>
                            </div>
                            <div class="activity-time">2 dni temu</div>
                        </div>
                        <div class="activity-item" onclick="showActivityActions(this)">
                            <div class="activity-icon"><i class='bx bx-envelope'></i></div>
                            <div class="activity-content">
                                <div class="activity-title">Zapytanie ofertowe</div>
                                <div class="activity-meta">Hotel Grand ‚Ä¢ Sztuƒáce jednorazowe</div>
                                <div class="activity-actions" style="display: none;">
                                    <button class="btn btn-secondary" onclick="event.stopPropagation(); showNoteModal('Hotel Grand')">+ Notatka</button>
                                    <button class="btn btn-primary" onclick="event.stopPropagation(); showTaskModal('Hotel Grand')">+ Zadanie</button>
                                </div>
                            </div>
                            <div class="activity-time">3 dni temu</div>
                        </div>
                    </div>
                </div>

                <!-- Active Goals Summary -->
                <div class="ecme-card">
                    <div class="card-header">
                        <h3 class="card-title">Aktywne cele</h3>
                        <button class="btn btn-secondary" onclick="switchTab('goals')">Zobacz wszystkie</button>
                    </div>
                    <div class="goals-grid">
                        <div class="goal-item" onclick="toggleGoalActions(this)">
                            <div class="goal-header">
                                <div>
                                    <div class="goal-title">Przych√≥d Q4 2024</div>
                                    <div class="goal-meta">Do 31 grudnia 2024</div>
                                </div>
                                <span class="goal-badge liczbowy">Liczbowy</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 78%"></div>
                            </div>
                            <div class="progress-label">234,500 PLN / 300,000 PLN (78%)</div>
                            <div class="goal-actions">
                                <div class="goal-action-item">
                                    <span class="goal-action-text">Skontaktuj siƒô z potencjalnymi klientami z listy lead√≥w</span>
                                    <button class="goal-action-button" onclick="event.stopPropagation(); alert('Przekierowanie do lead√≥w')">Zobacz leady</button>
                                </div>
                                <div class="goal-action-item">
                                    <span class="goal-action-text">Zaplanuj wizyty u klient√≥w Premium</span>
                                    <button class="goal-action-button" onclick="event.stopPropagation(); alert('Dodawanie wizyt')">Dodaj wizyty</button>
                                </div>
                                <div class="goal-action-item">
                                    <span class="goal-action-text">Wy≈õlij newsletter do nieaktywnych klient√≥w</span>
                                    <button class="goal-action-button" onclick="event.stopPropagation(); alert('Tworzenie newslettera')">Utw√≥rz</button>
                                </div>
                            </div>
                        </div>
                        <div class="goal-item" onclick="toggleGoalActions(this)">
                            <div class="goal-header">
                                <div>
                                    <div class="goal-title">Nowe rejestracje</div>
                                    <div class="goal-meta">Do 31 grudnia 2024</div>
                                </div>
                                <span class="goal-badge liczbowy">Liczbowy</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 56%"></div>
                            </div>
                            <div class="progress-label">14 / 25 rejestracji (56%)</div>
                            <div class="goal-actions">
                                <div class="goal-action-item">
                                    <span class="goal-action-text">Zweryfikuj ruch na stronie i znajd≈∫ kontakty do rejestracji</span>
                                    <button class="goal-action-button" onclick="event.stopPropagation(); alert('Przekierowanie do lead√≥w')">Znajd≈∫ kontakty</button>
                                </div>
                            </div>
                        </div>
                        <div class="goal-item" onclick="toggleGoalActions(this)">
                            <div class="goal-header">
                                <div>
                                    <div class="goal-title">Wizyty u klient√≥w</div>
                                    <div class="goal-meta">Do 31 grudnia 2024</div>
                                </div>
                                <span class="goal-badge liczbowy">Liczbowy</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 45%"></div>
                            </div>
                            <div class="progress-label">27 / 60 wizyt (45%)</div>
                            <div class="goal-actions">
                                <div class="goal-action-item">
                                    <span class="goal-action-text">Zaplanuj wizyty u klient√≥w Premium</span>
                                    <button class="goal-action-button" onclick="event.stopPropagation(); alert('Dodawanie wizyt')">Dodaj wizyty</button>
                                </div>
                            </div>
                        </div>
                        <div class="goal-item">
                            <div class="goal-header">
                                <div>
                                    <div class="goal-title">Retencja klient√≥w Premium</div>
                                    <div class="goal-meta">Cel ciƒÖg≈Çy</div>
                                </div>
                                <span class="goal-badge jakosciowy">Jako≈õciowy</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill complete" style="width: 92%"></div>
                            </div>
                            <div class="progress-label">92% retencja (cel: >85%)</div>
                            <div class="goal-actions">
                                <div class="goal-action-item">
                                <span class="goal-action-text">Skontaktuj siƒô z klientami, kt√≥rzy porzucili koszyki w ostatnich 7 dniach</span>
                                <button class="goal-action-button" onclick="event.stopPropagation(); alert('Przekierowanie do kontakt√≥w')">Zobacz kontakty</button>
                                </div>
                            </div>
                            </div>
                    </div>
                </div>
            </div>

            <!-- Alerts -->
            <div class="alert alert-warning">
                <div class="alert-icon">‚ö†Ô∏è</div>
                <div>
                    <strong>3 klient√≥w bez aktywno≈õci</strong> od ponad 30 dni: Restauracja Italiana, Bistro Central, Catering Plus
                </div>
            </div>

            <div class="alert alert-info">
                <div class="alert-icon">‚ÑπÔ∏è</div>
                <div>
                    <strong>Zaplanowane na dzi≈õ:</strong> 2 wizyty u klient√≥w (10:00 - Restauracja Italiana, 14:30 - Hotel Grand) i 3 rozmowy telefoniczne
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="ecme-card">
                <div class="card-header">
                    <h3 class="card-title">Sugerowane dzia≈Çania</h3>
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                    <div style="padding: 1.5rem; background: #f9fafb; border-radius: 8px; border: 1px solid #e5e7eb; display: flex; align-items: flex-start; gap: 1rem;">
                        <div style="width: 40px; height: 40px; background: #dbeafe; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            <i class='bx bx-phone-call' style="color: #3b82f6; font-size: 1.2rem;"></i>
                        </div>
                        <div style="flex: 1;">
                            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                                <h4 style="font-weight: 600; color: #1f2937; margin: 0;">Kontakt z nieaktywnymi klientami</h4>
                                <span style="background: #dc2626; color: white; padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.75rem; font-weight: 500;">Wysoki</span>
                            </div>
                            <p style="font-size: 0.875rem; color: #6b7280; margin: 0 0 1rem 0;">3 klient√≥w bez zam√≥wienia >30 dni ‚Ä¢ Bistro Central, Catering Plus, Cafe Aroma</p>
                            <button class="btn btn-outline" style="width: 100%;">Zadzwo≈Ñ</button>
                        </div>
                    </div>
                    <div style="padding: 1.5rem; background: #f9fafb; border-radius: 8px; border: 1px solid #e5e7eb; display: flex; align-items: flex-start; gap: 1rem;">
                        <div style="width: 40px; height: 40px; background: #dbeafe; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            <i class='bx bx-target-lock' style="color: #3b82f6; font-size: 1.2rem;"></i>
                        </div>
                        <div style="flex: 1;">
                            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                                <h4 style="font-weight: 600; color: #1f2937; margin: 0;">Oferta dla porzuconych koszyk√≥w</h4>
                                <span style="background: #f59e0b; color: white; padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.75rem; font-weight: 500;">≈öredni</span>
                            </div>
                            <p style="font-size: 0.875rem; color: #6b7280; margin: 0 0 1rem 0;">2 klient√≥w z warto≈õciƒÖ >800 PLN ‚Ä¢ Catering Plus, Hotel Marriott</p>
                            <button class="btn btn-outline" style="width: 100%;">Przygotuj ofertƒô</button>
                        </div>
                    </div>
                    <div style="padding: 1.5rem; background: #f9fafb; border-radius: 8px; border: 1px solid #e5e7eb; display: flex; align-items: flex-start; gap: 1rem;">
                        <div style="width: 40px; height: 40px; background: #dbeafe; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            <i class='bx bx-envelope' style="color: #3b82f6; font-size: 1.2rem;"></i>
                        </div>
                        <div style="flex: 1;">
                            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                                <h4 style="font-weight: 600; color: #1f2937; margin: 0;">Odpowied≈∫ na zapytanie - Hotel Grand</h4>
                                <span style="background: #3b82f6; color: white; padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.75rem; font-weight: 500;">Niski</span>
                            </div>
                            <p style="font-size: 0.875rem; color: #6b7280; margin: 0 0 1rem 0;">Zapytanie o sztuƒáce jednorazowe ‚Ä¢ Otrzymane 3 dni temu</p>
                            <button class="btn btn-outline" style="width: 100%;">Odpowiedz</button>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!-- Goals Tab -->
        <div id="goals" class="tab-content">
            <div class="ecme-card">
                <div class="card-header">
                    <h3 class="card-title">Cele handlowe</h3>
                    <button class="btn btn-primary" onclick="showModal('goalModal')">+ Nowy cel</button>
                </div>

                <!-- Filter Tabs -->
                <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; border-bottom: 1px solid #e5e7eb;">
                    <button class="btn btn-secondary goal-filter-btn active" onclick="filterGoals('all')" style="border-radius: 0; border-bottom: 2px solid #3b82f6;">Wszystkie (12)</button>
                    <button class="btn btn-secondary goal-filter-btn" onclick="filterGoals('numeric')" style="border-radius: 0; border-bottom: 2px solid transparent;">Liczbowe (8)</button>
                    <button class="btn btn-secondary goal-filter-btn" onclick="filterGoals('qualitative')" style="border-radius: 0; border-bottom: 2px solid transparent;">Jako≈õciowe (4)</button>
                    <button class="btn btn-secondary goal-filter-btn" onclick="filterGoals('in-progress')" style="border-radius: 0; border-bottom: 2px solid transparent;">W realizacji (9)</button>
                    <button class="btn btn-secondary goal-filter-btn" onclick="filterGoals('completed')" style="border-radius: 0; border-bottom: 2px solid transparent;">Zako≈Ñczone (3)</button>
                </div>

                <!-- Goals List -->
                <div class="goals-grid">
                    <!-- Liczbowe -->
                    <div class="goal-item" onclick="toggleGoalActions(this)" data-type="numeric" data-status="in-progress">
                        <div class="goal-header">
                            <div>
                                <div class="goal-title">Przych√≥d Q4 2024</div>
                                <div class="goal-meta">Rozpoczƒôty: 1 pa≈∫dziernika 2024 ‚Ä¢ Termin: 31 grudnia 2024</div>
                            </div>
                            <span class="goal-badge liczbowy">Liczbowy</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 78%"></div>
                        </div>
                        <div class="progress-label">234,500 PLN / 300,000 PLN (78%) ‚Ä¢ Pozosta≈Ço: 65,500 PLN</div>
                        <div class="goal-actions">
                            <div class="goal-action-item">
                                <span class="goal-action-text">Skontaktuj siƒô z potencjalnymi klientami z listy lead√≥w</span>
                                <button class="goal-action-button" onclick="event.stopPropagation(); alert('Przekierowanie do lead√≥w')">Zobacz leady</button>
                            </div>
                            <div class="goal-action-item">
                                <span class="goal-action-text">Zaplanuj wizyty u klient√≥w Premium</span>
                                <button class="goal-action-button" onclick="event.stopPropagation(); alert('Dodawanie wizyt')">Dodaj wizyty</button>
                            </div>
                        </div>
                    </div>

                    <div class="goal-item" onclick="toggleGoalActions(this)" data-type="numeric" data-status="in-progress">
                        <div class="goal-header">
                            <div>
                                <div class="goal-title">Nowe rejestracje Q4 2024</div>
                                <div class="goal-meta">Rozpoczƒôty: 1 pa≈∫dziernika 2024 ‚Ä¢ Termin: 31 grudnia 2024</div>
                            </div>
                            <span class="goal-badge liczbowy">Liczbowy</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 56%"></div>
                        </div>
                        <div class="progress-label">14 / 25 rejestracji (56%) ‚Ä¢ Pozosta≈Ço: 11 rejestracji</div>
                        <div class="goal-actions">
                            <div class="goal-action-item">
                                <span class="goal-action-text">Zweryfikuj ruch na stronie i znajd≈∫ kontakty do rejestracji</span>
                                <button class="goal-action-button" onclick="event.stopPropagation(); alert('Przekierowanie do lead√≥w')">Znajd≈∫ kontakty</button>
                            </div>
                            <div class="goal-action-item">
                                <span class="goal-action-text">Wy≈õlij newsletter do nieaktywnych klient√≥w</span>
                                <button class="goal-action-button" onclick="event.stopPropagation(); alert('Tworzenie newslettera')">Utw√≥rz</button>
                            </div>
                        </div>
                    </div>

                    <div class="goal-item" onclick="toggleGoalActions(this)" data-type="numeric" data-status="in-progress">
                        <div class="goal-header">
                            <div>
                                <div class="goal-title">Wizyty u klient√≥w Q4 2024</div>
                                <div class="goal-meta">Rozpoczƒôty: 1 pa≈∫dziernika 2024 ‚Ä¢ Termin: 31 grudnia 2024</div>
                            </div>
                            <span class="goal-badge liczbowy">Liczbowy</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 45%"></div>
                        </div>
                        <div class="progress-label">27 / 60 wizyt (45%) ‚Ä¢ Pozosta≈Ço: 33 wizyty</div>
                        <div class="goal-actions">
                            <div class="goal-action-item">
                                <span class="goal-action-text">Zaplanuj wizyty u klient√≥w Premium</span>
                                <button class="goal-action-button" onclick="event.stopPropagation(); alert('Dodawanie wizyt')">Dodaj wizyty</button>
                            </div>
                        </div>
                    </div>

                    <div class="goal-item" onclick="toggleGoalActions(this)" data-type="numeric" data-status="in-progress">
                        <div class="goal-header">
                            <div>
                                <div class="goal-title">Przych√≥d listopad 2024</div>
                                <div class="goal-meta">Rozpoczƒôty: 1 listopada 2024 ‚Ä¢ Termin: 30 listopada 2024</div>
                            </div>
                            <span class="goal-badge liczbowy">Liczbowy</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 34%"></div>
                        </div>
                        <div class="progress-label">34,200 PLN / 100,000 PLN (34%) ‚Ä¢ Pozosta≈Ço: 65,800 PLN</div>
                        <div class="goal-actions">
                            <div class="goal-action-item">
                                <span class="goal-action-text">Skontaktuj siƒô z potencjalnymi klientami z listy lead√≥w</span>
                                <button class="goal-action-button" onclick="event.stopPropagation(); alert('Przekierowanie do lead√≥w')">Zobacz leady</button>
                            </div>
                            <div class="goal-action-item">
                                <span class="goal-action-text">Zaplanuj wizyty u klient√≥w Premium</span>
                                <button class="goal-action-button" onclick="event.stopPropagation(); alert('Dodawanie wizyt')">Dodaj wizyty</button>
                            </div>
                        </div>
                    </div>

                    <!-- Jako≈õciowe -->
                    <div class="goal-item" onclick="toggleGoalActions(this)" data-type="qualitative" data-status="completed">
                        <div class="goal-header">
                            <div>
                                <div class="goal-title">Retencja klient√≥w Premium</div>
                                <div class="goal-meta">Cel ciƒÖg≈Çy ‚Ä¢ Monitorowany codziennie</div>
                            </div>
                            <span class="goal-badge jakosciowy">Jako≈õciowy</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill complete" style="width: 92%"></div>
                        </div>
                        <div class="progress-label">92% retencja (cel: >85%) ‚Ä¢ +7% powy≈ºej celu</div>
                        <div class="goal-actions">
                            <div class="goal-action-item">
                                <span class="goal-action-text">Skontaktuj siƒô z klientami, kt√≥rzy porzucili koszyki w ostatnich 7 dniach</span>
                                <button class="goal-action-button" onclick="event.stopPropagation(); alert('Przekierowanie do kontakt√≥w')">Zobacz kontakty</button>
                            </div>
                        </div>
                    </div>

                    <div class="goal-item" onclick="toggleGoalActions(this)" data-type="qualitative" data-status="completed">
                        <div class="goal-header">
                            <div>
                                <div class="goal-title">Standardy pracy - Procedury ofertowania</div>
                                <div class="goal-meta">Cel ciƒÖg≈Çy ‚Ä¢ Ostatnia weryfikacja: 2 dni temu</div>
                            </div>
                            <span class="goal-badge jakosciowy">Jako≈õciowy</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill complete" style="width: 100%"></div>
                        </div>
                        <div class="progress-label">100% zgodno≈õci (12/12 ofert zgodnych z procedurƒÖ)</div>
                        <div class="goal-actions">
                            <div class="goal-action-item">
                                <span class="goal-action-text">Przejrzyj i zaktualizuj procedury ofertowania</span>
                                <button class="goal-action-button" onclick="event.stopPropagation(); alert('Przekierowanie do procedur')">Zobacz procedury</button>
                            </div>
                        </div>
                    </div>

                    <div class="goal-item" onclick="toggleGoalActions(this)" data-type="qualitative" data-status="in-progress">
                        <div class="goal-header">
                            <div>
                                <div class="goal-title">Jako≈õƒá prowadzenia CRM</div>
                                <div class="goal-meta">Cel ciƒÖg≈Çy ‚Ä¢ Ostatnia ocena: wczoraj</div>
                            </div>
                            <span class="goal-badge jakosciowy">Jako≈õciowy</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 88%"></div>
                        </div>
                        <div class="progress-label">88% (notatki aktualne, kontakty udokumentowane)</div>
                        <div class="goal-actions">
                            <div class="goal-action-item">
                                <span class="goal-action-text">Zaktualizuj notatki i udokumentuj kontakty</span>
                                <button class="goal-action-button" onclick="event.stopPropagation(); alert('Przekierowanie do CRM')">Zaktualizuj CRM</button>
                            </div>
                        </div>
                    </div>

                    <div class="goal-item" onclick="toggleGoalActions(this)" data-type="qualitative" data-status="completed">
                        <div class="goal-header">
                            <div>
                                <div class="goal-title">Raportowanie - reakcja w 24h</div>
                                <div class="goal-meta">Cel ciƒÖg≈Çy ‚Ä¢ Monitorowany codziennie</div>
                            </div>
                            <span class="goal-badge jakosciowy">Jako≈õciowy</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill complete" style="width: 95%"></div>
                        </div>
                        <div class="progress-label">95% zg≈Çosze≈Ñ w terminie (19/20 w tym tygodniu)</div>
                        <div class="goal-actions">
                            <div class="goal-action-item">
                                <span class="goal-action-text">Przejrzyj raporty i zoptymalizuj procesy</span>
                                <button class="goal-action-button" onclick="event.stopPropagation(); alert('Przekierowanie do raport√≥w')">Zobacz raporty</button>
                            </div>
                        </div>
                    </div>

                    <div class="goal-item" onclick="toggleGoalActions(this)" data-type="qualitative" data-status="completed">
                        <div class="goal-header">
                            <div>
                                <div class="goal-title">Przygotowanie wizyt - Checklista</div>
                                <div class="goal-meta">Cel ciƒÖg≈Çy ‚Ä¢ Ostatnia weryfikacja: dzi≈õ</div>
                            </div>
                            <span class="goal-badge jakosciowy">Jako≈õciowy</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill complete" style="width: 100%"></div>
                        </div>
                        <div class="progress-label">100% wizyt z checklistƒÖ (27/27 wizyt w Q4)</div>
                        <div class="goal-actions">
                            <div class="goal-action-item">
                                <span class="goal-action-text">Przejrzyj i zaktualizuj checklistƒô wizyt</span>
                                <button class="goal-action-button" onclick="event.stopPropagation(); alert('Przekierowanie do checklisty')">Zobacz checklistƒô</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Customers Tab -->
        <div id="customers" class="tab-content">
            <div class="ecme-card">
                <div class="card-header">
                    <h3 class="card-title">Lista klient√≥w</h3>
                    <div style="display: flex; gap: 1rem;">
                        <input type="text" class="form-input" placeholder="Szukaj klienta..." style="width: 300px;">
                        <select class="form-select" style="width: 200px;">
                            <option>Wszyscy klienci</option>
                            <option>Premium</option>
                            <option>Standard</option>
                            <option>Nieaktywni >30 dni</option>
                        </select>
                    </div>
                </div>

                <table class="customers-table">
                    <thead>
                        <tr>
                            <th>Klient</th>
                            <th>Tag</th>
                            <th>Ostatnia aktywno≈õƒá</th>
                            <th>LTV</th>
                            <th>Notatki</th>
                            <th>Cele</th>
                            <th>Akcje</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <div class="customer-name">Mateusz Wiktorowicz</div>
                                <div class="customer-company">Restauracja Italiana</div>
                            </td>
                            <td><span class="tag">Premium</span></td>
                            <td>2 godz. temu</td>
                            <td>24,750 PLN</td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerNotes('Mateusz Wiktorowicz')">3 notatki</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerGoals('Mateusz Wiktorowicz')">2 cele</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerProfile('Mateusz Wiktorowicz')">Zobacz profil</button>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="customer-name">Anna Kowalska</div>
                                <div class="customer-company">Bistro Central</div>
                            </td>
                            <td><span class="tag">Premium</span></td>
                            <td>1 dzie≈Ñ temu</td>
                            <td>18,940 PLN</td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerNotes('Anna Kowalska')">5 notatek</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerGoals('Anna Kowalska')">1 cel</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerProfile('Anna Kowalska')">Zobacz profil</button>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="customer-name">Piotr Nowak</div>
                                <div class="customer-company">Catering Plus</div>
                            </td>
                            <td><span class="tag" style="background: #fef3c7; color: #92400e;">Standard</span></td>
                            <td style="color: #ef4444;">35 dni temu</td>
                            <td>12,340 PLN</td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerNotes('Piotr Nowak')">2 notatki</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerGoals('Piotr Nowak')">3 cele</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerProfile('Piotr Nowak')">Zobacz profil</button>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="customer-name">Katarzyna Lewandowska</div>
                                <div class="customer-company">Cafe Aroma</div>
                            </td>
                            <td><span class="tag" style="background: #fef3c7; color: #92400e;">Standard</span></td>
                            <td>5 godz. temu</td>
                            <td>8,920 PLN</td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerNotes('Katarzyna Lewandowska')">1 notatka</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerGoals('Katarzyna Lewandowska')">1 cel</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerProfile('Katarzyna Lewandowska')">Zobacz profil</button>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="customer-name">Tomasz Zieli≈Ñski</div>
                                <div class="customer-company">Hotel Grand</div>
                            </td>
                            <td><span class="tag">Premium</span></td>
                            <td>3 dni temu</td>
                            <td>31,560 PLN</td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerNotes('Tomasz Zieli≈Ñski')">4 notatki</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerGoals('Tomasz Zieli≈Ñski')">2 cele</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerProfile('Tomasz Zieli≈Ñski')">Zobacz profil</button>
                            </td>
                        </tr>
                        <!-- Dodatkowi klienci -->
                        <tr>
                            <td>
                                <div class="customer-name">Micha≈Ç Krawczyk</div>
                                <div class="customer-company">Pizzeria Bella</div>
                            </td>
                            <td><span class="tag">Premium</span></td>
                            <td>2 godz. temu</td>
                            <td>15,230 PLN</td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerNotes('Micha≈Ç Krawczyk')">2 notatki</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerGoals('Micha≈Ç Krawczyk')">1 cel</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerProfile('Micha≈Ç Krawczyk')">Zobacz profil</button>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="customer-name">Agnieszka W√≥jcik</div>
                                <div class="customer-company">Sushi Bar Tokyo</div>
                            </td>
                            <td><span class="tag" style="background: #fef3c7; color: #92400e;">Standard</span></td>
                            <td>1 dzie≈Ñ temu</td>
                            <td>9,450 PLN</td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerNotes('Agnieszka W√≥jcik')">3 notatki</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerGoals('Agnieszka W√≥jcik')">2 cele</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerProfile('Agnieszka W√≥jcik')">Zobacz profil</button>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="customer-name">Pawe≈Ç DƒÖbrowski</div>
                                <div class="customer-company">Kawiarnia Retro</div>
                            </td>
                            <td><span class="tag" style="background: #fef3c7; color: #92400e;">Standard</span></td>
                            <td style="color: #ef4444;">42 dni temu</td>
                            <td>6,780 PLN</td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerNotes('Pawe≈Ç DƒÖbrowski')">1 notatka</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerGoals('Pawe≈Ç DƒÖbrowski')">1 cel</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerProfile('Pawe≈Ç DƒÖbrowski')">Zobacz profil</button>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="customer-name">Magdalena Szyma≈Ñska</div>
                                <div class="customer-company">Restauracja Pod Kogutem</div>
                            </td>
                            <td><span class="tag">Premium</span></td>
                            <td>4 godz. temu</td>
                            <td>28,900 PLN</td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerNotes('Magdalena Szyma≈Ñska')">6 notatek</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerGoals('Magdalena Szyma≈Ñska')">3 cele</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerProfile('Magdalena Szyma≈Ñska')">Zobacz profil</button>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="customer-name">Robert Koz≈Çowski</div>
                                <div class="customer-company">Bar Mleczny</div>
                            </td>
                            <td><span class="tag" style="background: #fef3c7; color: #92400e;">Standard</span></td>
                            <td>6 godz. temu</td>
                            <td>11,200 PLN</td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerNotes('Robert Koz≈Çowski')">2 notatki</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerGoals('Robert Koz≈Çowski')">1 cel</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerProfile('Robert Koz≈Çowski')">Zobacz profil</button>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="customer-name">Ewa Nowakowska</div>
                                <div class="customer-company">Cafe & Bakery</div>
                            </td>
                            <td><span class="tag">Premium</span></td>
                            <td>1 dzie≈Ñ temu</td>
                            <td>22,150 PLN</td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerNotes('Ewa Nowakowska')">4 notatki</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerGoals('Ewa Nowakowska')">2 cele</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerProfile('Ewa Nowakowska')">Zobacz profil</button>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="customer-name">Krzysztof Jankowski</div>
                                <div class="customer-company">Steakhouse Prime</div>
                            </td>
                            <td><span class="tag">Premium</span></td>
                            <td>3 dni temu</td>
                            <td>35,780 PLN</td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerNotes('Krzysztof Jankowski')">5 notatek</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerGoals('Krzysztof Jankowski')">3 cele</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerProfile('Krzysztof Jankowski')">Zobacz profil</button>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="customer-name">Joanna Wi≈õniewska</div>
                                <div class="customer-company">Food Truck Smaki</div>
                            </td>
                            <td><span class="tag" style="background: #fef3c7; color: #92400e;">Standard</span></td>
                            <td style="color: #ef4444;">28 dni temu</td>
                            <td>7,890 PLN</td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerNotes('Joanna Wi≈õniewska')">1 notatka</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerGoals('Joanna Wi≈õniewska')">1 cel</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerProfile('Joanna Wi≈õniewska')">Zobacz profil</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Calendar Tab -->
        <div id="calendar" class="tab-content">
            <div class="ecme-card">
                <div class="calendar-header">
                    <h3 class="card-title">Listopad 2024</h3>
                    <div class="calendar-nav">
                        <button class="btn btn-secondary">‚Üê Poprzedni</button>
                        <button class="btn btn-secondary">Dzi≈õ</button>
                        <button class="btn btn-secondary">Nastƒôpny ‚Üí</button>
                        <button class="btn btn-primary" onclick="showModal('eventModal')">+ Nowe zdarzenie</button>
                    </div>
                </div>

                <div class="calendar-grid">
                    <div class="calendar-day-header">Pon</div>
                    <div class="calendar-day-header">Wt</div>
                    <div class="calendar-day-header">≈ör</div>
                    <div class="calendar-day-header">Czw</div>
                    <div class="calendar-day-header">Pt</div>
                    <div class="calendar-day-header">Sob</div>
                    <div class="calendar-day-header">Nie</div>

                    <div class="calendar-day other-month">
                        <div class="calendar-day-number">28</div>
                    </div>
                    <div class="calendar-day other-month">
                        <div class="calendar-day-number">29</div>
                    </div>
                    <div class="calendar-day other-month">
                        <div class="calendar-day-number">30</div>
                    </div>
                    <div class="calendar-day other-month">
                        <div class="calendar-day-number">31</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">1</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">2</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">3</div>
                    </div>

                    <div class="calendar-day">
                        <div class="calendar-day-number">4</div>
                        <div class="calendar-event">üìû 10:00 Tel. Bistro Central</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">5</div>
                        <div class="calendar-event visit">üöó 10:00 Wizyta - R. Italiana</div>
                        <div class="calendar-event visit">üöó 14:30 Wizyta - Hotel Grand</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">6</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">7</div>
                        <div class="calendar-event">üìû 15:00 Tel. Catering Plus</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">8</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">9</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">10</div>
                    </div>

                    <div class="calendar-day">
                        <div class="calendar-day-number">11</div>
                        <div class="calendar-event">üìß Wys≈Çaƒá ofertƒô - Cafe Aroma</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">12</div>
                        <div class="calendar-event visit">üöó 11:00 Wizyta - Bistro Central</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">13</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">14</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">15</div>
                        <div class="calendar-event">üìû 09:00 Tel. follow-up R. Italiana</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">16</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">17</div>
                    </div>

                    <div class="calendar-day">
                        <div class="calendar-day-number">18</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">19</div>
                        <div class="calendar-event visit">üöó 10:00 Wizyta - Catering Plus</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">20</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">21</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">22</div>
                        <div class="calendar-event">üìû 14:00 Tel. Hotel Grand</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">23</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">24</div>
                    </div>

                    <div class="calendar-day">
                        <div class="calendar-day-number">25</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">26</div>
                        <div class="calendar-event visit">üöó Trasa: 3 klient√≥w</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">27</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">28</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">29</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">30</div>
                    </div>
                    <div class="calendar-day other-month">
                        <div class="calendar-day-number">1</div>
                    </div>
                </div>
            </div>

            <!-- Upcoming Events -->
            <div class="ecme-card">
                <div class="card-header">
                    <h3 class="card-title">NadchodzƒÖce zdarzenia</h3>
                </div>
                <div class="activity-feed">
                    <div class="activity-item">
                        <div class="activity-icon">üöó</div>
                        <div class="activity-content">
                            <div class="activity-title">Wizyta u klienta - Restauracja Italiana</div>
                            <div class="activity-meta">ul. Marsza≈Çkowska 45, Warszawa ‚Ä¢ Cel: Prezentacja nowych produkt√≥w CN</div>
                        </div>
                        <div class="activity-time">Dzi≈õ, 10:00</div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon">üöó</div>
                        <div class="activity-content">
                            <div class="activity-title">Wizyta u klienta - Hotel Grand</div>
                            <div class="activity-meta">Al. Jerozolimskie 123, Warszawa ‚Ä¢ Cel: Om√≥wienie umowy rocznej</div>
                        </div>
                        <div class="activity-time">Dzi≈õ, 14:30</div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon">üìû</div>
                        <div class="activity-content">
                            <div class="activity-title">Telefon - Catering Plus</div>
                            <div class="activity-meta">Kontakt reaktywacyjny (brak aktywno≈õci 35 dni)</div>
                        </div>
                        <div class="activity-time">7 listopada, 15:00</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Routes Tab -->
        <div id="routes" class="tab-content">
            <div class="ecme-card">
                <div class="card-header">
                    <h3 class="card-title">Planowanie trasy wizyt</h3>
                    <div style="display: flex; gap: 1rem;">
                        <button class="btn btn-secondary" onclick="showModal('visitModal')">+ Zaplanuj wizytƒô</button>
                        <button class="btn btn-primary" onclick="showModal('routeModal')">+ Zaplanuj trasƒô</button>
                    </div>
                </div>

                <!-- Calendar and Map Section -->
                <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 2rem; margin-bottom: 2rem;">
                    <!-- Calendar -->
                    <div>
                        <h4 style="margin-bottom: 1rem; color: #1f2937;">Kalendarz wizyt</h4>
                        <div id="visit-calendar" style="background: white; border: 1px solid #e5e7eb; border-radius: 8px; padding: 1rem;">
                            <!-- Calendar will be loaded here -->
                        </div>
                    </div>
                    
                    <!-- Map -->
                    <div>
                        <h4 style="margin-bottom: 1rem; color: #1f2937;">Mapa trasy</h4>
                        <div id="route-map" style="height: 300px; border-radius: 8px; border: 1px solid #e5e7eb;"></div>
                    </div>
                </div>

                <!-- Route Details -->
                <div class="route-list">
                    <h4 style="font-weight: 600; margin-bottom: 1rem;">Trasa na 5 listopada 2024</h4>
                    
                    <div class="route-item">
                        <div class="route-number">1</div>
                        <div class="route-info">
                            <div class="route-customer">Restauracja Italiana</div>
                            <div class="route-address">ul. Marsza≈Çkowska 45, 00-001 Warszawa</div>
                        </div>
                        <div class="route-time">
                            <div>10:00 - 11:00</div>
                            <div style="color: #9ca3af;">15 min. jazdy</div>
                        </div>
                    </div>

                    <div class="route-item">
                        <div class="route-number">2</div>
                        <div class="route-info">
                            <div class="route-customer">Cafe Aroma</div>
                            <div class="route-address">ul. Nowy ≈öwiat 28, 00-373 Warszawa</div>
                        </div>
                        <div class="route-time">
                            <div>11:30 - 12:15</div>
                            <div style="color: #9ca3af;">8 min. jazdy</div>
                        </div>
                    </div>

                    <div class="route-item">
                        <div class="route-number">3</div>
                        <div class="route-info">
                            <div class="route-customer">Hotel Grand</div>
                            <div class="route-address">Al. Jerozolimskie 123, 02-017 Warszawa</div>
                        </div>
                        <div class="route-time">
                            <div>14:30 - 15:30</div>
                            <div style="color: #9ca3af;">22 min. jazdy</div>
                        </div>
                    </div>
                </div>

                <div style="margin-top: 1rem; padding: 1rem; background: #f9fafb; border-radius: 6px; border: 1px solid #e5e7eb;">
                    <div style="font-weight: 500; margin-bottom: 0.5rem;">üìä Podsumowanie trasy</div>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;">
                        <div>
                            <div style="font-size: 0.813rem; color: #6b7280;">≈ÅƒÖczny dystans</div>
                            <div style="font-weight: 600;">45 km</div>
                        </div>
                        <div>
                            <div style="font-size: 0.813rem; color: #6b7280;">Czas jazdy</div>
                            <div style="font-weight: 600;">45 min.</div>
                        </div>
                        <div>
                            <div style="font-size: 0.813rem; color: #6b7280;">Liczba wizyt</div>
                            <div style="font-weight: 600;">3 klient√≥w</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings" class="tab-content">
            <!-- Scoring Configuration Section -->
            <div class="ecme-card" style="margin-bottom: 2rem;">
                <div class="card-header">
                    <h3 class="card-title">Konfiguracja scoringu za zachowania</h3>
                    <button class="btn btn-secondary" onclick="showScoringConfigModal()">
                        <i class='bx bx-cog'></i> Konfiguruj scoring
                    </button>
                </div>

                <div class="scoring-config-grid">
                    <div class="scoring-category">
                        <h4>Odwiedzona strona</h4>
                        <div class="scoring-items">
                            <div class="scoring-item">
                                <span>Strona g≈Ç√≥wna</span>
                                <input type="number" class="form-input scoring-points" value="1" min="0">
                            </div>
                            <div class="scoring-item">
                                <span>Strona produktu</span>
                                <input type="number" class="form-input scoring-points" value="3" min="0">
                            </div>
                            <div class="scoring-item">
                                <span>Logowanie/rejestracji</span>
                                <input type="number" class="form-input scoring-points" value="7" min="0">
                            </div>
                            <div class="scoring-item">
                                <span>Strona kategorii</span>
                                <input type="number" class="form-input scoring-points" value="2" min="0">
                            </div>
                            <div class="scoring-item">
                                <span>Strona koszyka</span>
                                <input type="number" class="form-input scoring-points" value="5" min="0">
                            </div>
                            <div class="scoring-item">
                                <span>Strony na koncie klienta</span>
                                <input type="number" class="form-input scoring-points" value="6" min="0">
                            </div>
                        </div>
                    </div>

                    <div class="scoring-category">
                        <h4>Akcje u≈ºytkownika</h4>
                        <div class="scoring-items">
                            <div class="scoring-item">
                                <span>Dodanie do koszyka</span>
                                <input type="number" class="form-input scoring-points" value="4" min="0">
                            </div>
                            <div class="scoring-item">
                                <span>Wyszukanie produktu</span>
                                <input type="number" class="form-input scoring-points" value="8" min="0">
                            </div>
                            <div class="scoring-item">
                                <span>Finalizacja zam√≥wienia</span>
                                <input type="number" class="form-input scoring-points" value="15" min="0">
                            </div>
                            <div class="scoring-item">
                                <span>Dodanie do ulubionych</span>
                                <input type="number" class="form-input scoring-points" value="3" min="0">
                            </div>
                            <div class="scoring-item">
                                <span>Udostƒôpnienie produktu</span>
                                <input type="number" class="form-input scoring-points" value="5" min="0">
                            </div>
                            <div class="scoring-item">
                                <span>Kontakt z obs≈ÇugƒÖ</span>
                                <input type="number" class="form-input scoring-points" value="10" min="0">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="scoring-actions">
                    <button class="btn btn-primary" onclick="saveScoringConfig()">
                        <i class='bx bx-save'></i> Zapisz konfiguracjƒô
                    </button>
                    <button class="btn btn-outline" onclick="resetScoringConfig()">
                        <i class='bx bx-reset'></i> Resetuj do domy≈õlnych
                    </button>
                </div>
            </div>

            <!-- Business Rules Section -->
            <div class="ecme-card" style="margin-bottom: 2rem;">
                <div class="card-header">
                    <h3 class="card-title">Regu≈Çy biznesowe</h3>
                    <button class="btn btn-primary" onclick="showAddRuleModal()">
                        <i class='bx bx-plus'></i> Dodaj nowƒÖ regu≈Çƒô
                    </button>
                </div>

                <div class="business-rules-list">
                    <!-- Rule 1: Porzucony koszyk - scoring -->
                    <div class="rule-item">
                        <div class="rule-header">
                            <div class="rule-info">
                                <h4>Porzucony koszyk - wysoki scoring</h4>
                                <p class="rule-description">Wykrywa klient√≥w z wysokim scoringiem za dodawanie do koszyka, ale bez finalizacji zam√≥wienia</p>
                            </div>
                            <div class="rule-controls">
                                <label class="toggle-switch">
                                    <input type="checkbox" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                                <button class="btn btn-secondary" onclick="editRule(1)">Edytuj</button>
                            </div>
                        </div>
                        <div class="rule-details">
                            <div class="rule-triggers">
                                <strong>Triggery (AND):</strong>
                                <ul>
                                    <li>Dodanie do koszyka: 4+ punkty w ciƒÖgu 7 dni</li>
                                    <li>Finalizacja zam√≥wienia: 0 punkt√≥w w ciƒÖgu 7 dni</li>
                                </ul>
                            </div>
                            <div class="rule-actions">
                                <strong>Akcje (OR):</strong>
                                <ul>
                                    <li>Wy≈õlij email z kodem rabatowym 10% (wykonaj w ciƒÖgu 30 min)</li>
                                    <li>Utw√≥rz zadanie dla handlowca: "Kontakt z klientem - porzucony koszyk"</li>
                                </ul>
                            </div>
                            <div class="rule-parameters">
                                <strong>Harmonogram:</strong>
                                <span>Poniedzia≈Çek-PiƒÖtek, 09:00 | Scheduler: Codziennie</span>
                            </div>
                        </div>
                    </div>

                    <!-- Rule 2: Spadek zaanga≈ºowania -->
                    <div class="rule-item">
                        <div class="rule-header">
                            <div class="rule-info">
                                <h4>Spadek zaanga≈ºowania w czasie rzeczywistym</h4>
                                <p class="rule-description">Monitoruje nag≈Çy spadek aktywno≈õci klienta i sugeruje dzia≈Çania prewencyjne</p>
                            </div>
                            <div class="rule-controls">
                                <label class="toggle-switch">
                                    <input type="checkbox" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                                <button class="btn btn-secondary" onclick="editRule(2)">Edytuj</button>
                            </div>
                        </div>
                        <div class="rule-details">
                            <div class="rule-triggers">
                                <strong>Triggery:</strong>
                                <ul>
                                    <li>Klient aktywny ostatnie 7 dni nagle nie logowa≈Ç siƒô 48h</li>
                                    <li>Lub: otwar≈Ç 3+ produkty ale nie doda≈Ç do koszyka</li>
                                </ul>
                            </div>
                            <div class="rule-actions">
                                <strong>Akcje:</strong>
                                <ul>
                                    <li>Alert do opiekuna z sugestiƒÖ kontaktu</li>
                                    <li>AI sugeruje tematykƒô rozmowy na bazie przeglƒÖdanych produkt√≥w</li>
                                </ul>
                            </div>
                            <div class="rule-parameters">
                                <strong>Parametry:</strong>
                                <span>Pr√≥g aktywno≈õci: 3+ sesje/tydzie≈Ñ | Czas reakcji: 48h</span>
                            </div>
                        </div>
                    </div>

                    <!-- Rule 3: Analiza zachowania konkurencyjnego -->
                    <div class="rule-item">
                        <div class="rule-header">
                            <div class="rule-info">
                                <h4>Analiza zachowania konkurencyjnego</h4>
                                <p class="rule-description">Wykrywa klient√≥w por√≥wnujƒÖcych ceny i sugeruje strategie cenowe</p>
                            </div>
                            <div class="rule-controls">
                                <label class="toggle-switch">
                                    <input type="checkbox" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                                <button class="btn btn-secondary" onclick="editRule(3)">Edytuj</button>
                            </div>
                        </div>
                        <div class="rule-details">
                            <div class="rule-triggers">
                                <strong>Triggery:</strong>
                                <ul>
                                    <li>Klient przeglƒÖda produkt >3 razy dziennie bez zakupu</li>
                                </ul>
                            </div>
                            <div class="rule-actions">
                                <strong>Akcje:</strong>
                                <ul>
                                    <li>Powiadomienie handlowca z insightem</li>
                                    <li>Historia oglƒÖdanych produkt√≥w i ich ceny</li>
                                    <li>≈öredni czas decyzji podobnych klient√≥w</li>
                                    <li>Sugerowany pr√≥g rabatu (price history i AI recommendation)</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Rule 3: Cross-sell/Up-sell -->
                    <div class="rule-item">
                        <div class="rule-header">
                            <div class="rule-info">
                                <h4>Szansa Cross-sell/Up-sell</h4>
                                <p class="rule-description">Wykorzystuje AI do wykrywania wzorc√≥w zakupowych i proponowania dodatkowych produkt√≥w</p>
                            </div>
                            <div class="rule-controls">
                                <label class="toggle-switch">
                                    <input type="checkbox" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                                <button class="btn btn-secondary" onclick="editRule(4)">Edytuj</button>
                            </div>
                        </div>
                        <div class="rule-details">
                            <div class="rule-triggers">
                                <strong>Triggery:</strong>
                                <ul>
                                    <li>Klient kupi≈Ç produkt kategorii X</li>
                                    <li>AI wykry≈Ço pattern zakupowy (np. zawsze dokupuje Y w ciƒÖgu 14 dni)</li>
                                </ul>
                            </div>
                            <div class="rule-actions">
                                <strong>Akcje:</strong>
                                <ul>
                                    <li>Zadanie dla handlowca: "Zaproponuj produkt Y"</li>
                                    <li>Auto-email z rekomendacjƒÖ (opcjonalnie)</li>
                                </ul>
                            </div>
                            <div class="rule-parameters">
                                <strong>Dane:</strong>
                                <span>Machine learning na historii wszystkich klient√≥w</span>
                            </div>
                        </div>
                    </div>

                    <!-- Rule 5: Ryzyko utraty klienta -->
                    <div class="rule-item">
                        <div class="rule-header">
                            <div class="rule-info">
                                <h4>Ryzyko utraty klienta</h4>
                                <p class="rule-description">Identyfikuje klient√≥w zagro≈ºonych odej≈õciem i uruchamia dzia≈Çania retencyjne</p>
                            </div>
                            <div class="rule-controls">
                                <label class="toggle-switch">
                                    <input type="checkbox" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                                <button class="btn btn-secondary" onclick="editRule(5)">Edytuj</button>
                            </div>
                        </div>
                        <div class="rule-details">
                            <div class="rule-triggers">
                                <strong>Triggery (jeden z):</strong>
                                <ul>
                                    <li>Warto≈õƒá zam√≥wie≈Ñ spad≈Ça >40% vs poprzedni kwarta≈Ç</li>
                                    <li>Czƒôstotliwo≈õƒá logowa≈Ñ spad≈Ça >60%</li>
                                </ul>
                            </div>
                            <div class="rule-actions">
                                <strong>Akcje:</strong>
                                <ul>
                                    <li>Czerwony alert dla handlowca</li>
                                    <li>Auto-generowanie propozycji retencyjnej</li>
                                    <li>Szybki prewencyjny telefon do klienta</li>
                                </ul>
                            </div>
                            <div class="rule-parameters">
                                <strong>Metryka:</strong>
                                <span>CLV i Retention Rate vs segment klient√≥w z tym samym tagiem</span>
                            </div>
                        </div>
                    </div>

                    <!-- Rule 6: Przekroczenie limitu kredytowego -->
                    <div class="rule-item">
                        <div class="rule-header">
                            <div class="rule-info">
                                <h4>Przekroczenie limitu kredytowego</h4>
                                <p class="rule-description">Monitoruje wykorzystanie limitu kredytowego i uruchamia wielopoziomowe akcje</p>
                            </div>
                            <div class="rule-controls">
                                <label class="toggle-switch">
                                    <input type="checkbox" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                                <button class="btn btn-secondary" onclick="editRule(6)">Edytuj</button>
                            </div>
                        </div>
                        <div class="rule-details">
                            <div class="rule-triggers">
                                <strong>Triggery:</strong>
                                <ul>
                                    <li>Koszyk + nieop≈Çacone faktury > 90% limitu</li>
                                </ul>
                            </div>
                            <div class="rule-actions">
                                <strong>Akcje wielopoziomowe:</strong>
                                <ul>
                                    <li><strong>90%:</strong> Info dla handlowca</li>
                                    <li><strong>95%:</strong> Alert do handlowca o potrzebie interwencji</li>
                                    <li><strong>100%:</strong> Auto-email do klienta + handlowca i dzia≈Ç finansowy</li>
                                </ul>
                            </div>
                            <div class="rule-parameters">
                                <strong>Integracja:</strong>
                                <span>ERP (faktury) + Platforma</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Original Settings -->
            <div class="ecme-card">
                <div class="card-header">
                    <h3 class="card-title">Ustawienia powiadomie≈Ñ</h3>
                </div>

                <div class="form-group">
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: #f9fafb; border-radius: 6px; margin-bottom: 0.75rem;">
                        <div>
                            <div style="font-weight: 500;">Brak aktywno≈õci klienta</div>
                            <div style="font-size: 0.813rem; color: #6b7280;">Powiadom, gdy klient nie ma aktywno≈õci przez okre≈õlony czas</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div style="display: flex; gap: 1rem; padding-left: 1rem;">
                        <div class="form-group" style="flex: 1;">
                            <label class="form-label">Czas bez aktywno≈õci (dni)</label>
                            <input type="number" class="form-input" value="30">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: #f9fafb; border-radius: 6px; margin-bottom: 0.75rem;">
                        <div>
                            <div style="font-weight: 500;">Porzucony koszyk</div>
                            <div style="font-size: 0.813rem; color: #6b7280;">Powiadom, gdy koszyk o wysokiej warto≈õci zostanie porzucony</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div style="display: flex; gap: 1rem; padding-left: 1rem;">
                        <div class="form-group" style="flex: 1;">
                            <label class="form-label">Minimalna warto≈õƒá koszyka (PLN)</label>
                            <input type="number" class="form-input" value="500">
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label class="form-label">Czas od porzucenia (godziny)</label>
                            <input type="number" class="form-input" value="24">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: #f9fafb; border-radius: 6px; margin-bottom: 0.75rem;">
                        <div>
                            <div style="font-weight: 500;">Niskie zaanga≈ºowanie klienta Premium</div>
                            <div style="font-size: 0.813rem; color: #6b7280;">Powiadom, gdy klient Premium zmniejsza czƒôstotliwo≈õƒá zakup√≥w</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div style="display: flex; gap: 1rem; padding-left: 1rem;">
                        <div class="form-group" style="flex: 1;">
                            <label class="form-label">Spadek czƒôstotliwo≈õci (%)</label>
                            <input type="number" class="form-input" value="30">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: #f9fafb; border-radius: 6px; margin-bottom: 0.75rem;">
                        <div>
                            <div style="font-weight: 500;">Przypomnienie o wizycie</div>
                            <div style="font-size: 0.813rem; color: #6b7280;">Przypominaj o nadchodzƒÖcej wizycie u klienta</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div style="display: flex; gap: 1rem; padding-left: 1rem;">
                        <div class="form-group" style="flex: 1;">
                            <label class="form-label">Przypominaj przed (godziny)</label>
                            <input type="number" class="form-input" value="1">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: #f9fafb; border-radius: 6px;">
                        <div>
                            <div style="font-weight: 500;">Raport tygodniowy</div>
                            <div style="font-size: 0.813rem; color: #6b7280;">Otrzymuj podsumowanie tygodniowej aktywno≈õci</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid #e5e7eb;">
                    <button class="btn btn-primary">Zapisz ustawienia</button>
                </div>
            </div>

            <div class="ecme-card">
                <div class="card-header">
                    <h3 class="card-title">Preferencje wy≈õwietlania</h3>
                </div>

                <div class="form-group">
                    <label class="form-label">Domy≈õlny widok startowy</label>
                    <select class="form-select">
                        <option>Dashboard</option>
                        <option>Cele handlowe</option>
                        <option>Klienci</option>
                        <option>Kalendarz</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Liczba rekord√≥w na stronƒô</label>
                    <select class="form-select">
                        <option>10</option>
                        <option>25</option>
                        <option selected>50</option>
                        <option>100</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Format daty</label>
                    <select class="form-select">
                        <option selected>DD.MM.YYYY</option>
                        <option>YYYY-MM-DD</option>
                        <option>MM/DD/YYYY</option>
                    </select>
                </div>

                <div style="margin-top: 2rem;">
                    <button class="btn btn-primary">Zapisz preferencje</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Add (Zadanie/Wizyta/Cel) -->
    <div id="addModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Dodaj nowƒÖ akcjƒô</h3>
                <button class="modal-close" onclick="hideModal('addModal')">√ó</button>
            </div>

            <!-- Action Type Selector -->
            <div id="actionTypeSelector" class="action-type-selector">
                <div class="action-type-option" onclick="selectActionType('task')">
                    <div class="action-type-icon"><i class='bx bx-check'></i></div>
                    <div class="action-type-label">Zadanie</div>
                </div>
                <div class="action-type-option" onclick="selectActionType('visit')">
                    <div class="action-type-icon"><i class='bx bx-car'></i></div>
                    <div class="action-type-label">Wizyta</div>
                </div>
                <div class="action-type-option" onclick="selectActionType('goal')">
                    <div class="action-type-icon"><i class='bx bx-target-lock'></i></div>
                    <div class="action-type-label">Cel</div>
                </div>
                <div class="action-type-option" onclick="selectActionType('note')">
                    <div class="action-type-icon"><i class='bx bx-edit'></i></div>
                    <div class="action-type-label">Notatka</div>
                </div>
                <div class="action-type-option" onclick="selectActionType('call')">
                    <div class="action-type-icon"><i class='bx bx-phone-call'></i></div>
                    <div class="action-type-label">Rozmowa</div>
                </div>
                <div class="action-type-option" onclick="selectActionType('email')">
                    <div class="action-type-icon"><i class='bx bx-envelope'></i></div>
                    <div class="action-type-label">Email</div>
                </div>
            </div>

            <!-- Task Form -->
            <div id="taskForm" style="display: none;">
                <div class="form-group">
                    <label class="form-label">Tytu≈Ç zadania</label>
                    <input type="text" class="form-input" placeholder="Np. Kontakt z klientem">
                </div>
                <div class="form-group">
                    <label class="form-label">Opis</label>
                    <textarea class="form-textarea" placeholder="Szczeg√≥≈Çy zadania"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Klient</label>
                    <select class="form-select">
                        <option>Wybierz klienta</option>
                        <option>Restauracja Italiana</option>
                        <option>Bistro Central</option>
                        <option>Catering Plus</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Termin</label>
                    <input type="date" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">Priorytet</label>
                    <select class="form-select">
                        <option>Wysoki</option>
                        <option>≈öredni</option>
                        <option>Niski</option>
                    </select>
                </div>
            </div>

            <!-- Visit Form -->
            <div id="visitForm" style="display: none;">
                <div class="form-group">
                    <label class="form-label">Klient</label>
                    <select class="form-select">
                        <option>Wybierz klienta</option>
                        <option>Restauracja Italiana</option>
                        <option>Bistro Central</option>
                        <option>Catering Plus</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Data wizyty</label>
                    <input type="date" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">Godzina</label>
                    <input type="time" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">Cel wizyty</label>
                    <textarea class="form-textarea" placeholder="Np. Om√≥wienie nowej oferty, prezentacja produkt√≥w"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Adres</label>
                    <input type="text" class="form-input" placeholder="ul. Marsza≈Çkowska 15, Warszawa">
                </div>
            </div>

            <!-- Goal Form -->
            <div id="goalForm" style="display: none;">
                <div class="form-group">
                    <label class="form-label">Nazwa celu</label>
                    <input type="text" class="form-input" placeholder="Np. Przych√≥d Q1 2025">
                </div>
                <div class="form-group">
                    <label class="form-label">Typ celu</label>
                    <select class="form-select">
                        <option>Liczbowy</option>
                        <option>Jako≈õciowy</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Warto≈õƒá docelowa</label>
                    <input type="number" class="form-input" placeholder="Np. 300000">
                </div>
                <div class="form-group">
                    <label class="form-label">Jednostka</label>
                    <input type="text" class="form-input" placeholder="Np. PLN, sztuki, %">
                </div>
                <div class="form-group">
                    <label class="form-label">Termin realizacji</label>
                    <input type="date" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">Opis</label>
                    <textarea class="form-textarea" placeholder="Szczeg√≥≈Çy celu"></textarea>
                </div>
            </div>

            <!-- Note Form -->
            <div id="noteForm" style="display: none;">
                <div class="form-group">
                    <label class="form-label">Klient</label>
                    <select class="form-select">
                        <option>Wybierz klienta</option>
                        <option>Restauracja Italiana</option>
                        <option>Bistro Central</option>
                        <option>Catering Plus</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Typ notatki</label>
                    <select class="form-select">
                        <option>Rozmowa telefoniczna</option>
                        <option>Wizyta</option>
                        <option>Email</option>
                        <option>Inne</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Tre≈õƒá notatki</label>
                    <textarea class="form-textarea" placeholder="Wpisz tre≈õƒá notatki"></textarea>
                </div>
            </div>

            <!-- Call Form -->
            <div id="callForm" style="display: none;">
                <div class="form-group">
                    <label class="form-label">Klient</label>
                    <select class="form-select">
                        <option>Wybierz klienta</option>
                        <option>Restauracja Italiana</option>
                        <option>Bistro Central</option>
                        <option>Catering Plus</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Data rozmowy</label>
                    <input type="date" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">Godzina</label>
                    <input type="time" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">Cel rozmowy</label>
                    <textarea class="form-textarea" placeholder="Np. Follow-up, prezentacja oferty"></textarea>
                </div>
            </div>

            <!-- Email Form -->
            <div id="emailForm" style="display: none;">
                <div class="form-group">
                    <label class="form-label">Klient</label>
                    <select class="form-select">
                        <option>Wybierz klienta</option>
                        <option>Restauracja Italiana</option>
                        <option>Bistro Central</option>
                        <option>Catering Plus</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Temat</label>
                    <input type="text" class="form-input" placeholder="Temat wiadomo≈õci">
                </div>
                <div class="form-group">
                    <label class="form-label">Tre≈õƒá</label>
                    <textarea class="form-textarea" placeholder="Tre≈õƒá wiadomo≈õci email"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Data wys≈Çania</label>
                    <input type="date" class="form-input">
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal('addModal')">Anuluj</button>
                <button class="btn btn-primary" onclick="saveAction()">Zapisz</button>
            </div>
        </div>
    </div>

    <!-- Goal Modal -->
    <div id="goalModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Dodaj nowy cel handlowy</h3>
                <button class="modal-close" onclick="hideModal('goalModal')">&times;</button>
            </div>

            <form>
                <div class="form-group">
                    <label class="form-label">Nazwa celu</label>
                    <input type="text" class="form-input" placeholder="np. Przych√≥d Q4 2024">
                </div>

                <div class="form-group">
                    <label class="form-label">Typ celu</label>
                    <select class="form-select">
                        <option>Liczbowy</option>
                        <option>Jako≈õciowy</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Kategoria</label>
                    <select class="form-select">
                        <option>Przychody/Sprzeda≈º</option>
                        <option>Rejestracje</option>
                        <option>Wizyty u klient√≥w</option>
                        <option>Retencja klient√≥w</option>
                        <option>Standardy pracy</option>
                        <option>Jako≈õƒá CRM</option>
                        <option>Raportowanie</option>
                        <option>Inne</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Warto≈õƒá docelowa</label>
                    <input type="text" class="form-input" placeholder="np. 300000 PLN lub 25 rejestracji">
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label class="form-label">Data rozpoczƒôcia</label>
                        <input type="date" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Termin realizacji</label>
                        <input type="date" class="form-input">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Opis</label>
                    <textarea class="form-textarea" placeholder="Opcjonalny opis celu..."></textarea>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="hideModal('goalModal')">Anuluj</button>
                    <button type="submit" class="btn btn-primary">Dodaj cel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Note Modal -->
    <div id="noteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Dodaj notatkƒô</h3>
                <button class="modal-close" onclick="hideModal('noteModal')">&times;</button>
            </div>
            <div class="form-group">
                <label class="form-label">Klient</label>
                <input type="text" id="noteClient" class="form-input" readonly>
            </div>
            <div class="form-group">
                <label class="form-label">Typ notatki</label>
                <select class="form-select">
                    <option>Rozmowa telefoniczna</option>
                    <option>Wizyta</option>
                    <option>Email</option>
                    <option>Inne</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Tre≈õƒá notatki</label>
                <textarea class="form-textarea" placeholder="Wpisz tre≈õƒá notatki"></textarea>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal('noteModal')">Anuluj</button>
                <button class="btn btn-primary" onclick="saveNote()">Zapisz</button>
            </div>
        </div>
    </div>

    <!-- Task Modal -->
    <div id="taskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Dodaj zadanie</h3>
                <button class="modal-close" onclick="hideModal('taskModal')">&times;</button>
            </div>
            <div class="form-group">
                <label class="form-label">Klient</label>
                <input type="text" id="taskClient" class="form-input" readonly>
            </div>
            <div class="form-group">
                <label class="form-label">Tytu≈Ç zadania</label>
                <input type="text" class="form-input" placeholder="Np. Kontakt z klientem">
            </div>
            <div class="form-group">
                <label class="form-label">Opis</label>
                <textarea class="form-textarea" placeholder="Szczeg√≥≈Çy zadania"></textarea>
            </div>
            <div class="form-group">
                <label class="form-label">Termin</label>
                <input type="date" class="form-input">
            </div>
            <div class="form-group">
                <label class="form-label">Priorytet</label>
                <select class="form-select">
                    <option>Wysoki</option>
                    <option>≈öredni</option>
                    <option>Niski</option>
                </select>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal('taskModal')">Anuluj</button>
                <button class="btn btn-primary" onclick="saveTask()">Zapisz</button>
            </div>
        </div>
    </div>

    <!-- Note Modal (Original) -->
    <div id="noteModalOriginal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Notatki - Restauracja Italiana</h3>
                <button class="modal-close" onclick="hideModal('noteModalOriginal')">&times;</button>
            </div>

            <div style="max-height: 400px; overflow-y: auto; margin-bottom: 1.5rem;">
                <div class="note-item">
                    <div class="note-header">
                        <span class="note-type">üìù Notatka og√≥lna</span>
                        <span class="note-date">2 listopada 2024</span>
                    </div>
                    <div class="note-content">
                        Klient zainteresowany nowymi pojemnikami CN 1/3. Poproszono o przygotowanie oferty cenowej dla zam√≥wienia >500 szt. Termin: do 10 listopada.
                    </div>
                </div>

                <div class="note-item">
                    <div class="note-header">
                        <span class="note-type">üöó Po wizycie</span>
                        <span class="note-date">28 pa≈∫dziernika 2024</span>
                    </div>
                    <div class="note-content">
                        Wizyta przebieg≈Ça pomy≈õlnie. Om√≥wiono wsp√≥≈Çpracƒô na 2025 rok. Klient planuje rozbudowƒô lokalu - potencjalne zwiƒôkszenie zam√≥wie≈Ñ o 30%.
                    </div>
                </div>

                <div class="note-item">
                    <div class="note-header">
                        <span class="note-type">üõí Po zam√≥wieniu</span>
                        <span class="note-date">15 pa≈∫dziernika 2024</span>
                    </div>
                    <div class="note-content">
                        Zam√≥wienie #8911 zrealizowane terminowo. Klient bardzo zadowolony z szybko≈õci dostawy. Zapyta≈Ç o mo≈ºliwo≈õƒá wyd≈Çu≈ºenia terminu p≈Çatno≈õci do 21 dni.
                    </div>
                </div>
            </div>

            <form>
                <div class="form-group">
                    <label class="form-label">Typ notatki</label>
                    <select class="form-select">
                        <option>Notatka og√≥lna</option>
                        <option>Po rejestracji</option>
                        <option>Po zam√≥wieniu</option>
                        <option>Po reklamacji</option>
                        <option>Po zapytaniu</option>
                        <option>Po wizycie</option>
                        <option>Przy odwiedzonym produkcie</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Tre≈õƒá notatki</label>
                    <textarea class="form-textarea" placeholder="Wpisz tre≈õƒá notatki..."></textarea>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="hideModal('noteModal')">Anuluj</button>
                    <button type="submit" class="btn btn-primary">Dodaj notatkƒô</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Customer Goal Modal -->
    <div id="customerGoalModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Cele przy kliencie - Restauracja Italiana</h3>
                <button class="modal-close" onclick="hideModal('customerGoalModal')">&times;</button>
            </div>

            <div style="margin-bottom: 1.5rem;">
                <div class="goal-item">
                    <div class="goal-header">
                        <div>
                            <div class="goal-title">Wizyta u klienta</div>
                            <div class="goal-meta">Zaplanowano: 5 listopada 2024, 10:00</div>
                        </div>
                        <span class="goal-badge liczbowy" style="background: #dcfce7; color: #166534;">Zaplanowane</span>
                    </div>
                    <div style="font-size: 0.875rem; color: #6b7280; margin-top: 0.5rem;">
                        Cel: Prezentacja nowych produkt√≥w CN i om√≥wienie oferty na Q1 2025
                    </div>
                </div>

                <div class="goal-item">
                    <div class="goal-header">
                        <div>
                            <div class="goal-title">Przygotowanie oferty</div>
                            <div class="goal-meta">Termin: 10 listopada 2024</div>
                        </div>
                        <span class="goal-badge liczbowy" style="background: #fef3c7; color: #92400e;">W trakcie</span>
                    </div>
                    <div style="font-size: 0.875rem; color: #6b7280; margin-top: 0.5rem;">
                        Oferta cenowa dla zam√≥wienia pojemnik√≥w CN 1/3 >500 szt.
                    </div>
                </div>
            </div>

            <form>
                <div class="form-group">
                    <label class="form-label">Typ celu</label>
                    <select class="form-select">
                        <option>Wizyta u klienta</option>
                        <option>Kontakt telefoniczny</option>
                        <option>Przygotowanie oferty</option>
                        <option>Wys≈Çanie maila</option>
                        <option>W≈Çasny cel</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Termin realizacji</label>
                    <input type="datetime-local" class="form-input">
                </div>

                <div class="form-group">
                    <label class="form-label">Opis celu</label>
                    <textarea class="form-textarea" placeholder="Opcjonalny opis..."></textarea>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="hideModal('customerGoalModal')">Anuluj</button>
                    <button type="submit" class="btn btn-primary">Dodaj cel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Event Modal -->
    <div id="eventModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Dodaj nowe zdarzenie</h3>
                <button class="modal-close" onclick="hideModal('eventModal')">&times;</button>
            </div>

            <form>
                <div class="form-group">
                    <label class="form-label">Typ zdarzenia</label>
                    <select class="form-select">
                        <option>Wizyta u klienta</option>
                        <option>Rozmowa telefoniczna</option>
                        <option>Wys≈Çanie oferty</option>
                        <option>Spotkanie</option>
                        <option>Inne</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Klient</label>
                    <select class="form-select">
                        <option>Restauracja Italiana</option>
                        <option>Bistro Central</option>
                        <option>Catering Plus</option>
                        <option>Cafe Aroma</option>
                        <option>Hotel Grand</option>
                    </select>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label class="form-label">Data</label>
                        <input type="date" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Godzina</label>
                        <input type="time" class="form-input">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Opis/Cel</label>
                    <textarea class="form-textarea" placeholder="Cel wizyty, tematy do om√≥wienia..."></textarea>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="hideModal('eventModal')">Anuluj</button>
                    <button type="submit" class="btn btn-primary">Dodaj zdarzenie</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Route Modal -->
    <div id="routeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Zaplanuj trasƒô wizyt</h3>
                <button class="modal-close" onclick="hideModal('routeModal')">&times;</button>
            </div>

            <form>
                <div class="form-group">
                    <label class="form-label">Data trasy</label>
                    <input type="date" class="form-input">
                </div>

                <div class="form-group">
                    <label class="form-label">Wybierz klient√≥w do odwiedzenia</label>
                    <div style="display: flex; flex-direction: column; gap: 0.5rem; max-height: 200px; overflow-y: auto; padding: 0.5rem; background: #f9fafb; border-radius: 6px;">
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox"> Restauracja Italiana (ul. Marsza≈Çkowska 45)
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox"> Bistro Central (ul. Nowy ≈öwiat 67)
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox"> Catering Plus (ul. Pu≈Çawska 234)
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox"> Cafe Aroma (ul. Nowy ≈öwiat 28)
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox"> Hotel Grand (Al. Jerozolimskie 123)
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Godzina rozpoczƒôcia</label>
                    <input type="time" class="form-input" value="09:00">
                </div>

                <div class="form-group">
                    <label class="form-label">≈öredni czas wizyty (minuty)</label>
                    <input type="number" class="form-input" value="45">
                </div>

                <div class="alert alert-info" style="margin-top: 1rem;">
                    <div class="alert-icon">‚ÑπÔ∏è</div>
                    <div style="font-size: 0.813rem;">System automatycznie zoptymalizuje trasƒô, aby zminimalizowaƒá czas jazdy miƒôdzy klientami</div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="hideModal('routeModal')">Anuluj</button>
                    <button type="submit" class="btn btn-primary">Generuj trasƒô</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Customer Notes Modal -->
    <div id="customerNotesModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3>Notatki - <span id="customerNotesName"></span></h3>
                <button class="modal-close" onclick="hideModal('customerNotesModal')">√ó</button>
            </div>
            <div class="modal-body">
                <!-- Add Note Form -->
                <div style="background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 8px; padding: 1.5rem; margin-bottom: 2rem;">
                    <h4 style="margin: 0 0 1rem 0; color: #1f2937;">Dodaj nowƒÖ notatkƒô</h4>
                    <form id="customerNoteForm">
                        <div class="form-group">
                            <label for="customerNoteTitle">Tytu≈Ç notatki</label>
                            <input type="text" id="customerNoteTitle" class="form-input" placeholder="Wprowad≈∫ tytu≈Ç notatki..." required>
                        </div>
                        <div class="form-group">
                            <label for="customerNoteContent">Tre≈õƒá notatki</label>
                            <textarea id="customerNoteContent" class="form-input" rows="4" placeholder="Wprowad≈∫ tre≈õƒá notatki..." required></textarea>
                        </div>
                        <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                            <button type="button" class="btn btn-secondary" onclick="clearNoteForm()">Wyczy≈õƒá</button>
                            <button type="submit" class="btn btn-primary">Dodaj notatkƒô</button>
                        </div>
                    </form>
                </div>

                <!-- Search and History -->
                <div>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h4 style="margin: 0; color: #1f2937;">Historia notatek</h4>
                        <div style="display: flex; gap: 1rem; align-items: center;">
                            <input type="text" id="noteSearchInput" class="form-input" placeholder="Szukaj w notatkach..." style="width: 250px;" onkeyup="searchNotes()">
                            <button class="btn btn-secondary" onclick="clearSearch()">
                                <i class='bx bx-x'></i> Wyczy≈õƒá
                            </button>
                        </div>
                    </div>
                    <div id="customerNotesList">
                        <!-- Notes will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Customer Goals Modal -->
    <div id="customerGoalsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Cele powiƒÖzane z klientem: <span id="customerGoalsName"></span></h3>
                <button class="modal-close" onclick="hideModal('customerGoalsModal')">√ó</button>
            </div>
            <div class="modal-body">
                <div id="customerGoalsList">
                    <!-- Goals will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Customer Profile Modal -->
    <div id="customerProfileModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3>Profil klienta - <span id="customerProfileName"></span></h3>
                <button class="modal-close" onclick="hideModal('customerProfileModal')">√ó</button>
            </div>
            <div class="modal-body">
                <!-- Aktywno≈õci na stronie internetowej - na g√≥rze -->
                <div style="margin-bottom: 2rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h4 style="margin: 0; color: #1f2937;">Aktywno≈õci na stronie internetowej</h4>
                        <input type="text" id="webActivitiesSearchInput" class="form-input" placeholder="Szukaj aktywno≈õci..." style="width: 250px;" onkeyup="searchWebActivities()">
                    </div>
                    <div id="customerWebActivitiesList" style="max-height: 200px; overflow-y: auto; background: #f9fafb; border-radius: 8px; padding: 1rem;">
                        <!-- Web activities will be loaded here -->
                    </div>
                </div>
                
                <!-- Ostatnie aktywno≈õci - na ca≈Çy wiersz -->
                <div style="margin-bottom: 2rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h4 style="margin: 0; color: #1f2937;">Ostatnie aktywno≈õci wzglƒôdem klienta</h4>
                        <input type="text" id="activitiesSearchInput" class="form-input" placeholder="Szukaj aktywno≈õci..." style="width: 250px;" onkeyup="searchActivities()">
                    </div>
                    <div id="customerActivitiesList" style="max-height: 200px; overflow-y: auto;">
                        <!-- Activities will be loaded here -->
                    </div>
                </div>
                
                <!-- Notatki i cele - na ca≈Çy wiersz -->
                <div style="margin-bottom: 2rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h4 style="margin: 0; color: #1f2937;">Notatki i cele</h4>
                        <input type="text" id="notesGoalsSearchInput" class="form-input" placeholder="Szukaj..." style="width: 250px;" onkeyup="searchNotesGoals()">
                    </div>
                    <div id="customerNotesGoalsList" style="max-height: 200px; overflow-y: auto;">
                        <!-- Notes and goals will be loaded here -->
                    </div>
                </div>
                
                <!-- Przyciski akcji -->
                <div style="margin-top: 2rem; padding-top: 1rem; border-top: 1px solid #e5e7eb;">
                    <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                        <button class="btn btn-secondary" onclick="showAddNoteModal()" style="flex: 1;">
                            <i class='bx bx-edit'></i> Dodaj notatkƒô
                        </button>
                        <button class="btn btn-secondary" onclick="showAddTaskModal()" style="flex: 1;">
                            <i class='bx bx-check'></i> Dodaj zadanie
                        </button>
                    </div>
                    <button class="btn btn-primary" onclick="openCustomerProfile()" style="width: 100%;">
                        <i class='bx bx-user'></i> Przejd≈∫ do pe≈Çnego profilu klienta
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Visit Planning Modal -->
    <div id="visitModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Zaplanuj wizytƒô</h3>
                <button class="modal-close" onclick="hideModal('visitModal')">√ó</button>
            </div>
            <form id="visitForm">
                <div class="modal-body">
                    <div class="form-group">
                        <label for="visitCustomer">Klient</label>
                        <select id="visitCustomer" class="form-select" required>
                            <option value="">Wybierz klienta</option>
                            <option value="Mateusz Wiktorowicz">Mateusz Wiktorowicz - Restauracja Italiana</option>
                            <option value="Anna Kowalska">Anna Kowalska - Bistro Central</option>
                            <option value="Piotr Nowak">Piotr Nowak - Catering Plus</option>
                            <option value="Katarzyna Lewandowska">Katarzyna Lewandowska - Cafe Aroma</option>
                            <option value="Tomasz Zieli≈Ñski">Tomasz Zieli≈Ñski - Hotel Grand</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="visitDate">Data wizyty</label>
                        <input type="date" id="visitDate" class="form-input" required>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label for="visitStartTime">Godzina rozpoczƒôcia</label>
                            <input type="time" id="visitStartTime" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label for="visitEndTime">Godzina zako≈Ñczenia</label>
                            <input type="time" id="visitEndTime" class="form-input" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="visitPurpose">Cel wizyty</label>
                        <select id="visitPurpose" class="form-select" required>
                            <option value="">Wybierz cel</option>
                            <option value="prezentacja">Prezentacja produkt√≥w</option>
                            <option value="negocjacje">Negocjacje cenowe</option>
                            <option value="podpisanie">Podpisanie umowy</option>
                            <option value="konsultacje">Konsultacje techniczne</option>
                            <option value="odbi√≥r">Odbi√≥r zam√≥wienia</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="visitNotes">Notatki</label>
                        <textarea id="visitNotes" class="form-input" rows="3" placeholder="Dodatkowe informacje o wizycie..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="hideModal('visitModal')">Anuluj</button>
                    <button type="submit" class="btn btn-primary">Zaplanuj wizytƒô</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Rule Modal -->
    <div id="addRuleModal" class="modal">
        <div class="modal-content" style="max-width: 1000px;">
            <div class="modal-header">
                <h3>Dodaj nowƒÖ regu≈Çƒô biznesowƒÖ</h3>
                <button class="modal-close" onclick="hideModal('addRuleModal')">√ó</button>
            </div>
            <form id="addRuleForm">
                <div class="modal-body">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="ruleName">Nazwa regu≈Çy</label>
                            <input type="text" id="ruleName" class="form-input" placeholder="np. Porzucony koszyk - wysoki scoring" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="ruleType">Typ regu≈Çy</label>
                            <select id="ruleType" class="form-select" required>
                                <option value="">Wybierz typ regu≈Çy</option>
                                <option value="scoring">Regu≈Ça oparta na scoringu</option>
                                <option value="engagement">Spadek zaanga≈ºowania</option>
                                <option value="competitive">Analiza zachowania konkurencyjnego</option>
                                <option value="crosssell">Cross-sell/Up-sell</option>
                                <option value="retention">Ryzyko utraty klienta</option>
                                <option value="credit">Przekroczenie limitu kredytowego</option>
                                <option value="custom">Niestandardowa</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="ruleDescription">Opis regu≈Çy</label>
                        <textarea id="ruleDescription" class="form-input" rows="2" placeholder="Kr√≥tki opis dzia≈Çania regu≈Çy..."></textarea>
                    </div>

                    <!-- Scheduler Configuration -->
                    <div class="form-section">
                        <h4><i class='bx bx-time'></i> Scheduler - Harmonogram wykonania</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="scheduleDays">Dni tygodnia</label>
                                <div class="checkbox-group">
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="scheduleDays" value="monday">
                                        <span>Poniedzia≈Çek</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="scheduleDays" value="tuesday">
                                        <span>Wtorek</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="scheduleDays" value="wednesday">
                                        <span>≈öroda</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="scheduleDays" value="thursday">
                                        <span>Czwartek</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="scheduleDays" value="friday">
                                        <span>PiƒÖtek</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="scheduleDays" value="saturday">
                                        <span>Sobota</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="scheduleDays" value="sunday">
                                        <span>Niedziela</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="scheduleTime">Godzina wykonania</label>
                                <input type="time" id="scheduleTime" class="form-input" value="09:00">
                            </div>
                        </div>
                    </div>

                    <!-- Trigger Configuration -->
                    <div class="form-section">
                        <h4><i class='bx bx-target-lock'></i> Triggery - Warunki uruchomienia</h4>
                        <div class="form-group">
                            <label for="triggerLogic">Logika ≈ÇƒÖczenia trigger√≥w</label>
                            <select id="triggerLogic" class="form-select">
                                <option value="AND">AND (wszystkie warunki muszƒÖ byƒá spe≈Çnione)</option>
                                <option value="OR">OR (jeden z warunk√≥w musi byƒá spe≈Çniony)</option>
                            </select>
                        </div>
                        
                        <div id="triggersList">
                            <div class="trigger-item">
                                <div class="trigger-config">
                                    <div class="form-group">
                                        <label>Typ triggera</label>
                                        <select class="form-select" onchange="updateTriggerType(this)">
                                            <option value="scoring">Punkty scoringowe</option>
                                            <option value="custom">Niestandardowy</option>
                                        </select>
                                    </div>
                                    
                                    <div class="scoring-trigger-config" style="display: block;">
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label>Dzia≈Çanie</label>
                                                <select class="form-select">
                                                    <option value="add_to_cart">Dodanie do koszyka</option>
                                                    <option value="product_view">Strona produktu</option>
                                                    <option value="search">Wyszukanie produktu</option>
                                                    <option value="login">Logowanie/rejestracji</option>
                                                    <option value="checkout">Finalizacja zam√≥wienia</option>
                                                    <option value="favorite">Dodanie do ulubionych</span>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label>Ilo≈õƒá punkt√≥w</label>
                                                <input type="number" class="form-input scoring-points-input" placeholder="np. 4" min="0">
                                            </div>
                                            <div class="form-group">
                                                <label>Czas na osiƒÖgniƒôcie (dni)</label>
                                                <input type="number" class="form-input scoring-time-input" placeholder="np. 7" min="1">
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="custom-trigger-config" style="display: none;">
                                        <input type="text" class="form-input" placeholder="Opis niestandardowego triggera...">
                                    </div>
                                </div>
                                <button type="button" class="btn btn-secondary" onclick="removeTrigger(this)">Usu≈Ñ</button>
                            </div>
                        </div>
                        <button type="button" class="btn btn-outline" onclick="addTrigger()">+ Dodaj trigger</button>
                    </div>

                    <!-- Action Configuration -->
                    <div class="form-section">
                        <h4><i class='bx bx-play'></i> Akcje - Co ma zostaƒá wykonane</h4>
                        <div class="form-group">
                            <label for="actionLogic">Logika ≈ÇƒÖczenia akcji</label>
                            <select id="actionLogic" class="form-select">
                                <option value="AND">AND (wszystkie akcje muszƒÖ byƒá wykonane)</option>
                                <option value="OR">OR (jedna z akcji musi byƒá wykonana)</option>
                            </select>
                        </div>
                        
                        <div id="actionsList">
                            <div class="action-item">
                                <div class="action-config">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label>Typ akcji</label>
                                            <select class="form-select">
                                                <option value="email">Wy≈õlij email</option>
                                                <option value="task">Utw√≥rz zadanie</option>
                                                <option value="notification">Powiadomienie w dashboard</option>
                                                <option value="call">Zadzwo≈Ñ do klienta</option>
                                                <option value="discount">Wy≈õlij kod rabatowy</option>
                                                <option value="custom">Niestandardowa akcja</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label>Czas wykonania (minuty)</label>
                                            <input type="number" class="form-input action-time-input" placeholder="np. 30" min="1">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label>Opis akcji</label>
                                        <input type="text" class="form-input action-description-input" placeholder="Szczeg√≥≈Çowy opis akcji...">
                                    </div>
                                </div>
                                <button type="button" class="btn btn-secondary" onclick="removeAction(this)">Usu≈Ñ</button>
                            </div>
                        </div>
                        <button type="button" class="btn btn-outline" onclick="addAction()">+ Dodaj akcjƒô</button>
                    </div>

                    <div class="form-group">
                        <label class="toggle-switch">
                            <input type="checkbox" id="ruleEnabled" checked>
                            <span class="toggle-slider"></span>
                            <span style="margin-left: 0.5rem;">Regu≈Ça aktywna</span>
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="hideModal('addRuleModal')">Anuluj</button>
                    <button type="submit" class="btn btn-primary">Dodaj regu≈Çƒô</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Rule Modal -->
    <div id="editRuleModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3>Edytuj regu≈Çƒô biznesowƒÖ</h3>
                <button class="modal-close" onclick="hideModal('editRuleModal')">√ó</button>
            </div>
            <form id="editRuleForm">
                <div class="modal-body">
                    <div class="form-group">
                        <label for="editRuleName">Nazwa regu≈Çy</label>
                        <input type="text" id="editRuleName" class="form-input" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="editRuleDescription">Opis regu≈Çy</label>
                        <textarea id="editRuleDescription" class="form-input" rows="2"></textarea>
                    </div>

                    <div class="form-group">
                        <label for="editRuleType">Typ regu≈Çy</label>
                        <select id="editRuleType" class="form-select" required>
                            <option value="engagement">Spadek zaanga≈ºowania</option>
                            <option value="competitive">Analiza zachowania konkurencyjnego</option>
                            <option value="crosssell">Cross-sell/Up-sell</option>
                            <option value="retention">Ryzyko utraty klienta</option>
                            <option value="credit">Przekroczenie limitu kredytowego</option>
                            <option value="custom">Niestandardowa</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Triggery</label>
                        <div id="editTriggersList">
                            <!-- Will be populated dynamically -->
                        </div>
                        <button type="button" class="btn btn-outline" onclick="addEditTrigger()">+ Dodaj trigger</button>
                    </div>

                    <div class="form-group">
                        <label>Akcje</label>
                        <div id="editActionsList">
                            <!-- Will be populated dynamically -->
                        </div>
                        <button type="button" class="btn btn-outline" onclick="addEditAction()">+ Dodaj akcjƒô</button>
                    </div>

                    <div class="form-group">
                        <label for="editRuleParameters">Parametry</label>
                        <textarea id="editRuleParameters" class="form-input" rows="2"></textarea>
                    </div>

                    <div class="form-group">
                        <label class="toggle-switch">
                            <input type="checkbox" id="editRuleEnabled">
                            <span class="toggle-slider"></span>
                            <span style="margin-left: 0.5rem;">Regu≈Ça aktywna</span>
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="hideModal('editRuleModal')">Anuluj</button>
                    <button type="submit" class="btn btn-primary">Zapisz zmiany</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Tab switching
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active from all nav tabs
            document.querySelectorAll('.nav-tab').forEach(navTab => {
                navTab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            
            // Add active to clicked nav tab
            event.target.classList.add('active');

            // Initialize map and calendar if routes tab is selected
            if (tabName === 'routes') {
                setTimeout(initMap, 100);
                setTimeout(initializeVisitCalendar, 100);
            }
        }

        // Modal functions
        function showModal(modalId) {
            document.getElementById(modalId).classList.add('active');
            if (modalId === 'addModal') {
                // Reset to action type selector
                document.getElementById('actionTypeSelector').style.display = 'grid';
                document.getElementById('taskForm').style.display = 'none';
                document.getElementById('visitForm').style.display = 'none';
                document.getElementById('goalForm').style.display = 'none';
                document.getElementById('noteForm').style.display = 'none';
                document.getElementById('callForm').style.display = 'none';
                document.getElementById('emailForm').style.display = 'none';
            }
        }

        function hideModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Action type selection
        function selectActionType(type) {
            document.getElementById('actionTypeSelector').style.display = 'none';
            
            // Remove all selected states
            document.querySelectorAll('.action-type-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            if (type === 'task') {
                document.getElementById('taskForm').style.display = 'block';
                document.querySelector('.modal-title').textContent = 'Dodaj zadanie';
            } else if (type === 'visit') {
                document.getElementById('visitForm').style.display = 'block';
                document.querySelector('.modal-title').textContent = 'Dodaj wizytƒô';
            } else if (type === 'goal') {
                document.getElementById('goalForm').style.display = 'block';
                document.querySelector('.modal-title').textContent = 'Dodaj cel';
            } else if (type === 'note') {
                document.getElementById('noteForm').style.display = 'block';
                document.querySelector('.modal-title').textContent = 'Dodaj notatkƒô';
            } else if (type === 'call') {
                document.getElementById('callForm').style.display = 'block';
                document.querySelector('.modal-title').textContent = 'Dodaj rozmowƒô';
            } else if (type === 'email') {
                document.getElementById('emailForm').style.display = 'block';
                document.querySelector('.modal-title').textContent = 'Dodaj email';
            }
        }

        function saveAction() {
            alert('Akcja zapisana!');
            hideModal('addModal');
        }

        // Activity actions
        function showActivityActions(element) {
            // Hide all other action buttons
            document.querySelectorAll('.activity-actions').forEach(actions => {
                actions.style.display = 'none';
            });
            
            // Show this activity's actions
            const actions = element.querySelector('.activity-actions');
            actions.style.display = 'flex';
        }

        function showNoteModal(clientName) {
            document.getElementById('noteClient').value = clientName;
            showModal('noteModal');
        }

        function showTaskModal(clientName) {
            document.getElementById('taskClient').value = clientName;
            showModal('taskModal');
        }

        function saveNote() {
            alert('Notatka zapisana!');
            hideModal('noteModal');
        }

        function saveTask() {
            alert('Zadanie zapisane!');
            hideModal('taskModal');
        }

        // Task management functions
        function toggleTask(checkbox) {
            const taskItem = checkbox.closest('.task-item');
            if (checkbox.checked) {
                taskItem.classList.add('completed');
            } else {
                taskItem.classList.remove('completed');
            }
        }

        function editTask(button) {
            const taskItem = button.closest('.task-item');
            const taskTitle = taskItem.querySelector('.task-title').textContent.split(' - ')[0];
            alert('Edytowanie zadania: ' + taskTitle);
        }

        function toggleGoalActions(goalItem) {
            // Hide all other goal actions
            document.querySelectorAll('.goal-actions').forEach(actions => {
                actions.classList.remove('show');
            });
            
            // Toggle this goal's actions
            const actions = goalItem.querySelector('.goal-actions');
            actions.classList.toggle('show');
        }

        function filterGoals(filter) {
            // Update active tab
            document.querySelectorAll('.goal-filter-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.style.borderBottom = '2px solid transparent';
            });
            
            event.target.classList.add('active');
            event.target.style.borderBottom = '2px solid #3b82f6';
            
            // Filter goals
            const goals = document.querySelectorAll('.goal-item');
            goals.forEach(goal => {
                const type = goal.getAttribute('data-type');
                const status = goal.getAttribute('data-status');
                
                let show = false;
                
                switch(filter) {
                    case 'all':
                        show = true;
                        break;
                    case 'numeric':
                        show = type === 'numeric';
                        break;
                    case 'qualitative':
                        show = type === 'qualitative';
                        break;
                    case 'in-progress':
                        show = status === 'in-progress';
                        break;
                    case 'completed':
                        show = status === 'completed';
                        break;
                }
                
                goal.style.display = show ? 'block' : 'none';
            });
        }

        // Drag and drop functionality
        function initializeDragAndDrop() {
            const taskList = document.getElementById('taskList');
            let draggedElement = null;

            taskList.addEventListener('dragstart', function(e) {
                draggedElement = e.target;
                e.target.classList.add('dragging');
            });

            taskList.addEventListener('dragend', function(e) {
                e.target.classList.remove('dragging');
                draggedElement = null;
            });

            taskList.addEventListener('dragover', function(e) {
                e.preventDefault();
                const afterElement = getDragAfterElement(taskList, e.clientY);
                if (afterElement == null) {
                    taskList.appendChild(draggedElement);
                } else {
                    taskList.insertBefore(draggedElement, afterElement);
                }
            });
        }

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.task-item:not(.dragging)')];
            
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        // Initialize drag and drop when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeDragAndDrop();
        });

        // Customer functions
        function showCustomerNotes(customerName) {
            document.getElementById('customerNotesName').textContent = customerName;
            
            // Pre-fill the note form with customer name
            const noteTitleInput = document.getElementById('customerNoteTitle');
            const noteContentInput = document.getElementById('customerNoteContent');
            
            if (noteTitleInput) {
                noteTitleInput.value = `Notatka - ${customerName}`;
            }
            if (noteContentInput) {
                noteContentInput.value = `Notatka dotyczƒÖca klienta: ${customerName}\n\n`;
            }
            
            // Load notes
            loadCustomerNotes(customerName);
            
            showModal('customerNotesModal');
        }

        function loadCustomerNotes(customerName) {
            // Sample notes data
            const notesData = {
                'Mateusz Wiktorowicz': [
                    { id: 1, date: '2024-01-15', title: 'Nowa linia produkt√≥w', content: 'Klient zainteresowany nowƒÖ liniƒÖ produkt√≥w. Wys≈Çaƒá ofertƒô do ko≈Ñca tygodnia.', author: 'Jan Kowalski' },
                    { id: 2, date: '2024-01-10', title: 'Spotkanie biznesowe', content: 'Spotkanie przebieg≈Ço bardzo dobrze. Klient rozwa≈ºa zwiƒôkszenie zam√≥wienia o 30%.', author: 'Anna Nowak' },
                    { id: 3, date: '2024-01-05', title: 'Pierwszy kontakt', content: 'Pierwszy kontakt telefoniczny. Klient bardzo pozytywnie nastawiony.', author: 'Jan Kowalski' }
                ],
                'Anna Kowalska': [
                    { id: 4, date: '2024-01-14', title: 'Jako≈õƒá produkt√≥w', content: 'Klient zadowolony z jako≈õci produkt√≥w. Rozwa≈ºa d≈ÇugoterminowƒÖ wsp√≥≈Çpracƒô.', author: 'Anna Nowak' },
                    { id: 5, date: '2024-01-08', title: 'Dostawa', content: 'Dostawa przebieg≈Ça bez problem√≥w. Klient potwierdzi≈Ç kolejne zam√≥wienie.', author: 'Jan Kowalski' },
                    { id: 6, date: '2024-01-03', title: 'Negocjacje cenowe', content: 'Klient pyta≈Ç o mo≈ºliwo≈õƒá negocjacji cen. Przekaza≈Çem informacje do dzia≈Çu handlowego.', author: 'Anna Nowak' },
                    { id: 7, date: '2023-12-28', title: 'Pierwsze zam√≥wienie', content: 'Pierwsze zam√≥wienie zrealizowane. Klient bardzo zadowolony.', author: 'Jan Kowalski' },
                    { id: 8, date: '2023-12-20', title: 'Kontakt telefoniczny', content: 'Kontakt telefoniczny - klient zainteresowany naszƒÖ ofertƒÖ.', author: 'Anna Nowak' }
                ]
            };
            
            const notes = notesData[customerName] || [
                { id: 0, date: '2024-01-15', title: 'Brak notatek', content: 'Brak notatek dla tego klienta.', author: 'System' }
            ];
            
            // Store notes for search functionality
            window.currentCustomerNotes = notes;
            
            const notesList = document.getElementById('customerNotesList');
            notesList.innerHTML = notes.map(note => `
                <div class="note-item" data-note-id="${note.id}" style="padding: 1rem; border: 1px solid #e5e7eb; border-radius: 8px; margin-bottom: 1rem;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <div>
                            <span style="font-weight: 600; color: #1f2937;">${note.title}</span>
                            <span style="color: #6b7280; font-size: 0.875rem; margin-left: 1rem;">${note.date}</span>
                        </div>
                        <span style="color: #6b7280; font-size: 0.875rem;">${note.author}</span>
                    </div>
                    <p style="margin: 0; color: #374151;">${note.content}</p>
                </div>
            `).join('');
        }

        function showCustomerGoals(customerName) {
            document.getElementById('customerGoalsName').textContent = customerName;
            
            // Sample goals data
            const goalsData = {
                'Mateusz Wiktorowicz': [
                    { title: 'Zwiƒôkszenie sprzeda≈ºy o 20%', progress: 65, deadline: '2024-03-31' },
                    { title: 'NawiƒÖzanie d≈Çugoterminowej wsp√≥≈Çpracy', progress: 80, deadline: '2024-02-28' }
                ],
                'Anna Kowalska': [
                    { title: 'Realizacja zam√≥wienia na 50,000 PLN', progress: 45, deadline: '2024-04-30' }
                ]
            };
            
            const goals = goalsData[customerName] || [
                { title: 'Brak cel√≥w dla tego klienta', progress: 0, deadline: '-' }
            ];
            
            const goalsList = document.getElementById('customerGoalsList');
            goalsList.innerHTML = goals.map(goal => `
                <div style="padding: 1rem; border: 1px solid #e5e7eb; border-radius: 8px; margin-bottom: 1rem;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <h4 style="margin: 0; color: #1f2937;">${goal.title}</h4>
                        <span style="color: #6b7280; font-size: 0.875rem;">${goal.deadline}</span>
                    </div>
                    <div style="background: #f3f4f6; border-radius: 4px; height: 8px; margin-bottom: 0.5rem;">
                        <div style="background: #3b82f6; height: 100%; border-radius: 4px; width: ${goal.progress}%;"></div>
                    </div>
                    <span style="color: #6b7280; font-size: 0.875rem;">${goal.progress}% uko≈Ñczone</span>
                </div>
            `).join('');
            
            showModal('customerGoalsModal');
        }

        function showCustomerProfile(customerName) {
            document.getElementById('customerProfileName').textContent = customerName;
            
            // Load activities
            const activitiesList = document.getElementById('customerActivitiesList');
            activitiesList.innerHTML = `
                <div style="padding: 0.75rem; border: 1px solid #e5e7eb; border-radius: 6px; margin-bottom: 0.5rem;">
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <div style="width: 8px; height: 8px; background: #10b981; border-radius: 50%;"></div>
                        <div>
                            <div style="font-weight: 500; color: #1f2937;">Rozmowa telefoniczna</div>
                            <div style="font-size: 0.875rem; color: #6b7280;">2 godz. temu</div>
                        </div>
                    </div>
                </div>
                <div style="padding: 0.75rem; border: 1px solid #e5e7eb; border-radius: 6px; margin-bottom: 0.5rem;">
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <div style="width: 8px; height: 8px; background: #3b82f6; border-radius: 50%;"></div>
                        <div>
                            <div style="font-weight: 500; color: #1f2937;">Wizyta u klienta</div>
                            <div style="font-size: 0.875rem; color: #6b7280;">1 dzie≈Ñ temu</div>
                        </div>
                    </div>
                </div>
                <div style="padding: 0.75rem; border: 1px solid #e5e7eb; border-radius: 6px; margin-bottom: 0.5rem;">
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <div style="width: 8px; height: 8px; background: #f59e0b; border-radius: 50%;"></div>
                        <div>
                            <div style="font-weight: 500; color: #1f2937;">Wys≈Çanie oferty</div>
                            <div style="font-size: 0.875rem; color: #6b7280;">3 dni temu</div>
                        </div>
                    </div>
                </div>
            `;
            
            // Load notes and goals
            const notesGoalsList = document.getElementById('customerNotesGoalsList');
            notesGoalsList.innerHTML = `
                <div style="margin-bottom: 1rem;">
                    <h5 style="margin: 0 0 0.5rem 0; color: #1f2937;">Ostatnie notatki</h5>
                    <div style="padding: 0.75rem; background: #f9fafb; border-radius: 6px; margin-bottom: 0.5rem;">
                        <div style="font-size: 0.875rem; color: #6b7280;">2 godz. temu</div>
                        <div style="color: #374151;">Klient zainteresowany nowƒÖ liniƒÖ produkt√≥w...</div>
                    </div>
                </div>
                <div>
                    <h5 style="margin: 0 0 0.5rem 0; color: #1f2937;">Aktywne cele</h5>
                    <div style="padding: 0.75rem; background: #f9fafb; border-radius: 6px;">
                        <div style="font-weight: 500; color: #1f2937;">Zwiƒôkszenie sprzeda≈ºy o 20%</div>
                        <div style="font-size: 0.875rem; color: #6b7280;">65% uko≈Ñczone</div>
                    </div>
                </div>
            `;
            
            // Load web activities
            const webActivitiesList = document.getElementById('customerWebActivitiesList');
            webActivitiesList.innerHTML = `
                <div style="padding: 0.75rem; border: 1px solid #e5e7eb; border-radius: 6px; margin-bottom: 0.5rem; background: white;">
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <div style="width: 8px; height: 8px; background: #8b5cf6; border-radius: 50%;"></div>
                        <div>
                            <div style="font-weight: 500; color: #1f2937;">PrzeglƒÖdanie kategorii "Sztuƒáce"</div>
                            <div style="font-size: 0.875rem; color: #6b7280;">1 godz. temu ‚Ä¢ 15 min</div>
                        </div>
                    </div>
                </div>
                <div style="padding: 0.75rem; border: 1px solid #e5e7eb; border-radius: 6px; margin-bottom: 0.5rem; background: white;">
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <div style="width: 8px; height: 8px; background: #ef4444; border-radius: 50%;"></div>
                        <div>
                            <div style="font-weight: 500; color: #1f2937;">Dodanie do koszyka - Zestaw sztuƒác√≥w Premium</div>
                            <div style="font-size: 0.875rem; color: #6b7280;">2 godz. temu</div>
                        </div>
                    </div>
                </div>
                <div style="padding: 0.75rem; border: 1px solid #e5e7eb; border-radius: 6px; margin-bottom: 0.5rem; background: white;">
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <div style="width: 8px; height: 8px; background: #06b6d4; border-radius: 50%;"></div>
                        <div>
                            <div style="font-weight: 500; color: #1f2937;">Wyszukiwanie "talerze ceramiczne"</div>
                            <div style="font-size: 0.875rem; color: #6b7280;">3 godz. temu</div>
                        </div>
                    </div>
                </div>
                <div style="padding: 0.75rem; border: 1px solid #e5e7eb; border-radius: 6px; margin-bottom: 0.5rem; background: white;">
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <div style="width: 8px; height: 8px; background: #10b981; border-radius: 50%;"></div>
                        <div>
                            <div style="font-weight: 500; color: #1f2937;">Otwarcie strony produktu</div>
                            <div style="font-size: 0.875rem; color: #6b7280;">1 dzie≈Ñ temu ‚Ä¢ 5 min</div>
                        </div>
                    </div>
                </div>
                <div style="padding: 0.75rem; border: 1px solid #e5e7eb; border-radius: 6px; background: white;">
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <div style="width: 8px; height: 8px; background: #f59e0b; border-radius: 50%;"></div>
                        <div>
                            <div style="font-weight: 500; color: #1f2937;">Porzucenie koszyka z warto≈õciƒÖ 1,250 PLN</div>
                            <div style="font-size: 0.875rem; color: #6b7280;">2 dni temu</div>
                        </div>
                    </div>
                </div>
            `;
            
            showModal('customerProfileModal');
        }

        function openCustomerProfile() {
            alert('Przekierowanie do pe≈Çnego profilu klienta w systemie CRM');
        }

        // Search functions for customer profile sections
        function searchActivities() {
            const searchTerm = document.getElementById('activitiesSearchInput').value.toLowerCase();
            const activityItems = document.querySelectorAll('#customerActivitiesList > div');
            
            activityItems.forEach(item => {
                const text = item.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        function searchNotesGoals() {
            const searchTerm = document.getElementById('notesGoalsSearchInput').value.toLowerCase();
            const noteGoalItems = document.querySelectorAll('#customerNotesGoalsList > div');
            
            noteGoalItems.forEach(item => {
                const text = item.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        function searchWebActivities() {
            const searchTerm = document.getElementById('webActivitiesSearchInput').value.toLowerCase();
            const webActivityItems = document.querySelectorAll('#customerWebActivitiesList > div');
            
            webActivityItems.forEach(item => {
                const text = item.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        function showAddNoteModal() {
            // Hide current modal
            hideModal('customerNotesModal');
            hideModal('customerProfileModal');
            
            // Pre-fill the note form with customer name if available
            const customerName = document.getElementById('customerNotesName')?.textContent || 
                                document.getElementById('customerProfileName')?.textContent || '';
            
            if (customerName) {
                const noteTitleInput = document.getElementById('noteTitle');
                const noteContentInput = document.getElementById('noteContent');
                
                if (noteTitleInput) {
                    noteTitleInput.value = `Notatka - ${customerName}`;
                }
                if (noteContentInput) {
                    noteContentInput.value = `Notatka dotyczƒÖca klienta: ${customerName}\n\n`;
                }
            }
            
            // Show note modal
            showModal('noteModal');
        }

        // Note management functions
        function clearNoteForm() {
            document.getElementById('customerNoteTitle').value = '';
            document.getElementById('customerNoteContent').value = '';
        }

        function searchNotes() {
            const searchTerm = document.getElementById('noteSearchInput').value.toLowerCase();
            const noteItems = document.querySelectorAll('.note-item');
            
            noteItems.forEach(item => {
                const title = item.querySelector('span[style*="font-weight: 600"]').textContent.toLowerCase();
                const content = item.querySelector('p').textContent.toLowerCase();
                const author = item.querySelector('span[style*="color: #6b7280"]').textContent.toLowerCase();
                
                if (title.includes(searchTerm) || content.includes(searchTerm) || author.includes(searchTerm)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        function clearSearch() {
            document.getElementById('noteSearchInput').value = '';
            const noteItems = document.querySelectorAll('.note-item');
            noteItems.forEach(item => {
                item.style.display = 'block';
            });
        }

        // Customer note form submission
        document.addEventListener('DOMContentLoaded', function() {
            const customerNoteForm = document.getElementById('customerNoteForm');
            if (customerNoteForm) {
                customerNoteForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const title = document.getElementById('customerNoteTitle').value;
                    const content = document.getElementById('customerNoteContent').value;
                    const customerName = document.getElementById('customerNotesName').textContent;
                    
                    if (!title || !content) {
                        alert('Proszƒô wype≈Çniƒá wszystkie pola');
                        return;
                    }
                    
                    // Add new note to the list
                    const newNote = {
                        id: Date.now(),
                        date: new Date().toISOString().split('T')[0],
                        title: title,
                        content: content,
                        author: 'Aktualny u≈ºytkownik'
                    };
                    
                    // Add to current notes array
                    if (window.currentCustomerNotes) {
                        window.currentCustomerNotes.unshift(newNote);
                    }
                    
                    // Refresh the notes list
                    loadCustomerNotes(customerName);
                    
                    // Clear the form
                    clearNoteForm();
                    
                    // Show success message
                    alert('Notatka zosta≈Ça dodana pomy≈õlnie!');
                });
            }
        });

        function showAddGoalModal() {
            // Hide current modal
            hideModal('customerGoalsModal');
            hideModal('customerProfileModal');
            
            // Show goal modal
            showModal('goalModal');
        }

        function showAddTaskModal() {
            // Hide current modal
            hideModal('customerProfileModal');
            
            // Show task modal
            showModal('taskModal');
        }

        // Visit planning functions
        function initializeVisitCalendar() {
            const calendar = document.getElementById('visit-calendar');
            if (!calendar) return;

            const today = new Date();
            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();
            
            // Generate calendar HTML
            const monthNames = [
                'Stycze≈Ñ', 'Luty', 'Marzec', 'Kwiecie≈Ñ', 'Maj', 'Czerwiec',
                'Lipiec', 'Sierpie≈Ñ', 'Wrzesie≈Ñ', 'Pa≈∫dziernik', 'Listopad', 'Grudzie≈Ñ'
            ];
            
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            
            let calendarHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h5 style="margin: 0; color: #1f2937;">${monthNames[currentMonth]} ${currentYear}</h5>
                    <div style="display: flex; gap: 0.5rem;">
                        <button onclick="changeMonth(-1)" style="padding: 0.25rem 0.5rem; border: 1px solid #d1d5db; background: white; border-radius: 4px; cursor: pointer;">‚Äπ</button>
                        <button onclick="changeMonth(1)" style="padding: 0.25rem 0.5rem; border: 1px solid #d1d5db; background: white; border-radius: 4px; cursor: pointer;">‚Ä∫</button>
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; margin-bottom: 1rem;">
                    <div style="text-align: center; font-weight: 600; color: #6b7280; padding: 0.5rem; font-size: 0.875rem;">P</div>
                    <div style="text-align: center; font-weight: 600; color: #6b7280; padding: 0.5rem; font-size: 0.875rem;">W</div>
                    <div style="text-align: center; font-weight: 600; color: #6b7280; padding: 0.5rem; font-size: 0.875rem;">≈ö</div>
                    <div style="text-align: center; font-weight: 600; color: #6b7280; padding: 0.5rem; font-size: 0.875rem;">C</div>
                    <div style="text-align: center; font-weight: 600; color: #6b7280; padding: 0.5rem; font-size: 0.875rem;">P</div>
                    <div style="text-align: center; font-weight: 600; color: #6b7280; padding: 0.5rem; font-size: 0.875rem;">S</div>
                    <div style="text-align: center; font-weight: 600; color: #6b7280; padding: 0.5rem; font-size: 0.875rem;">N</div>
                </div>
                <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px;">
            `;
            
            // Add empty cells for days before month starts
            for (let i = 0; i < firstDay; i++) {
                calendarHTML += `<div style="height: 40px;"></div>`;
            }
            
            // Add days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const isToday = day === today.getDate();
                const hasVisits = [5, 12, 18, 25].includes(day); // Sample days with visits
                
                calendarHTML += `
                    <div onclick="selectDate(${day})" style="
                        height: 40px; 
                        display: flex; 
                        align-items: center; 
                        justify-content: center; 
                        cursor: pointer; 
                        border-radius: 4px;
                        background: ${isToday ? '#dbeafe' : hasVisits ? '#fef3c7' : 'transparent'};
                        color: ${isToday ? '#1e40af' : hasVisits ? '#92400e' : '#374151'};
                        font-weight: ${isToday ? '600' : 'normal'};
                        position: relative;
                    ">
                        ${day}
                        ${hasVisits ? '<div style="position: absolute; bottom: 2px; width: 4px; height: 4px; background: #f59e0b; border-radius: 50%;"></div>' : ''}
                    </div>
                `;
            }
            
            calendarHTML += '</div>';
            calendar.innerHTML = calendarHTML;
        }

        function changeMonth(direction) {
            // This would update the calendar month
            // For now, just reinitialize
            initializeVisitCalendar();
        }

        function selectDate(day) {
            // Set the selected date in the visit form
            const visitDateInput = document.getElementById('visitDate');
            if (visitDateInput) {
                const today = new Date();
                const selectedDate = new Date(today.getFullYear(), today.getMonth(), day);
                const dateString = selectedDate.toISOString().split('T')[0];
                visitDateInput.value = dateString;
            }
            
            // Show visit modal
            showModal('visitModal');
        }

        // Visit form submission
        document.addEventListener('DOMContentLoaded', function() {
            const visitForm = document.getElementById('visitForm');
            if (visitForm) {
                visitForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const formData = {
                        customer: document.getElementById('visitCustomer').value,
                        date: document.getElementById('visitDate').value,
                        startTime: document.getElementById('visitStartTime').value,
                        endTime: document.getElementById('visitEndTime').value,
                        purpose: document.getElementById('visitPurpose').value,
                        notes: document.getElementById('visitNotes').value
                    };
                    
                    // Here you would typically save the visit
                    alert('Wizyta zosta≈Ça zaplanowana!\n\nKlient: ' + formData.customer + '\nData: ' + formData.date + '\nGodzina: ' + formData.startTime + ' - ' + formData.endTime);
                    
                    // Reset form and close modal
                    visitForm.reset();
                    hideModal('visitModal');
                    
                    // Refresh calendar
                    initializeVisitCalendar();
                });
            }
        });

        // Close modal on outside click
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('active');
                }
            });
        });

        // Initialize map
        let map = null;
        function initMap() {
            if (map) return; // Map already initialized

            map = L.map('route-map').setView([52.2297, 21.0122], 12);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(map);

            // Add markers for customers
            const customers = [
                { name: 'Restauracja Italiana', coords: [52.2297, 21.0122], number: 1 },
                { name: 'Cafe Aroma', coords: [52.2335, 21.0188], number: 2 },
                { name: 'Hotel Grand', coords: [52.2237, 21.0044], number: 3 }
            ];

            customers.forEach(customer => {
                const marker = L.marker(customer.coords).addTo(map);
                marker.bindPopup(`<b>${customer.number}. ${customer.name}</b>`);
            });

            // Draw route line
            const routeCoords = customers.map(c => c.coords);
            L.polyline(routeCoords, { color: '#3b82f6', weight: 3 }).addTo(map);
        }

        // Scoring Configuration Functions
        function showScoringConfigModal() {
            alert('Demo: Otwieranie zaawansowanej konfiguracji scoringu...');
        }

        function saveScoringConfig() {
            const scoringData = {};
            document.querySelectorAll('.scoring-points').forEach(input => {
                const label = input.parentElement.querySelector('span').textContent;
                scoringData[label] = parseInt(input.value) || 0;
            });
            
            console.log('Zapisano konfiguracjƒô scoringu:', scoringData);
            alert('Konfiguracja scoringu zosta≈Ça zapisana!');
        }

        function resetScoringConfig() {
            const defaultValues = {
                'Strona g≈Ç√≥wna': 1,
                'Strona produktu': 3,
                'Logowanie/rejestracji': 7,
                'Strona kategorii': 2,
                'Strona koszyka': 5,
                'Strony na koncie klienta': 6,
                'Dodanie do koszyka': 4,
                'Wyszukanie produktu': 8,
                'Finalizacja zam√≥wienia': 15,
                'Dodanie do ulubionych': 3,
                'Udostƒôpnienie produktu': 5,
                'Kontakt z obs≈ÇugƒÖ': 10
            };
            
            document.querySelectorAll('.scoring-points').forEach(input => {
                const label = input.parentElement.querySelector('span').textContent;
                input.value = defaultValues[label] || 0;
            });
            
            alert('Konfiguracja scoringu zosta≈Ça zresetowana do domy≈õlnych warto≈õci!');
        }

        // Business Rules Functions
        function showAddRuleModal() {
            showModal('addRuleModal');
        }

        function updateTriggerType(selectElement) {
            const triggerItem = selectElement.closest('.trigger-item');
            const scoringConfig = triggerItem.querySelector('.scoring-trigger-config');
            const customConfig = triggerItem.querySelector('.custom-trigger-config');
            
            if (selectElement.value === 'scoring') {
                scoringConfig.style.display = 'block';
                customConfig.style.display = 'none';
            } else {
                scoringConfig.style.display = 'none';
                customConfig.style.display = 'block';
            }
        }

        function editRule(ruleId) {
            // Pre-fill edit form with rule data
            const ruleData = getRuleData(ruleId);
            
            document.getElementById('editRuleName').value = ruleData.name;
            document.getElementById('editRuleDescription').value = ruleData.description;
            document.getElementById('editRuleType').value = ruleData.type;
            document.getElementById('editRuleParameters').value = ruleData.parameters;
            document.getElementById('editRuleEnabled').checked = ruleData.enabled;
            
            // Populate triggers
            const editTriggersList = document.getElementById('editTriggersList');
            editTriggersList.innerHTML = '';
            ruleData.triggers.forEach(trigger => {
                addEditTrigger(trigger);
            });
            
            // Populate actions
            const editActionsList = document.getElementById('editActionsList');
            editActionsList.innerHTML = '';
            ruleData.actions.forEach(action => {
                addEditAction(action);
            });
            
            showModal('editRuleModal');
        }

        function getRuleData(ruleId) {
            // Mock data for existing rules
            const rules = {
                1: {
                    name: "Porzucony koszyk - wysoki scoring",
                    description: "Wykrywa klient√≥w z wysokim scoringiem za dodawanie do koszyka, ale bez finalizacji zam√≥wienia",
                    type: "scoring",
                    parameters: "Harmonogram: Poniedzia≈Çek-PiƒÖtek, 09:00 | Scheduler: Codziennie",
                    enabled: true,
                    triggers: [
                        "Dodanie do koszyka: 4+ punkty w ciƒÖgu 7 dni",
                        "Finalizacja zam√≥wienia: 0 punkt√≥w w ciƒÖgu 7 dni"
                    ],
                    actions: [
                        "Wy≈õlij email z kodem rabatowym 10% (wykonaj w ciƒÖgu 30 min)",
                        "Utw√≥rz zadanie dla handlowca: \"Kontakt z klientem - porzucony koszyk\""
                    ]
                },
                2: {
                    name: "Spadek zaanga≈ºowania w czasie rzeczywistym",
                    description: "Monitoruje nag≈Çy spadek aktywno≈õci klienta i sugeruje dzia≈Çania prewencyjne",
                    type: "engagement",
                    parameters: "Pr√≥g aktywno≈õci: 3+ sesje/tydzie≈Ñ | Czas reakcji: 48h",
                    enabled: true,
                    triggers: [
                        "Klient aktywny ostatnie 7 dni nagle nie logowa≈Ç siƒô 48h",
                        "Lub: otwar≈Ç 3+ produkty ale nie doda≈Ç do koszyka"
                    ],
                    actions: [
                        "Alert do opiekuna z sugestiƒÖ kontaktu",
                        "AI sugeruje tematykƒô rozmowy na bazie przeglƒÖdanych produkt√≥w"
                    ]
                },
                3: {
                    name: "Analiza zachowania konkurencyjnego",
                    description: "Wykrywa klient√≥w por√≥wnujƒÖcych ceny i sugeruje strategie cenowe",
                    type: "competitive",
                    parameters: "",
                    enabled: true,
                    triggers: [
                        "Klient przeglƒÖda produkt >3 razy dziennie bez zakupu"
                    ],
                    actions: [
                        "Powiadomienie handlowca z insightem",
                        "Historia oglƒÖdanych produkt√≥w i ich ceny",
                        "≈öredni czas decyzji podobnych klient√≥w",
                        "Sugerowany pr√≥g rabatu (price history i AI recommendation)"
                    ]
                },
                4: {
                    name: "Szansa Cross-sell/Up-sell",
                    description: "Wykorzystuje AI do wykrywania wzorc√≥w zakupowych i proponowania dodatkowych produkt√≥w",
                    type: "crosssell",
                    parameters: "Machine learning na historii wszystkich klient√≥w",
                    enabled: true,
                    triggers: [
                        "Klient kupi≈Ç produkt kategorii X",
                        "AI wykry≈Ço pattern zakupowy (np. zawsze dokupuje Y w ciƒÖgu 14 dni)"
                    ],
                    actions: [
                        "Zadanie dla handlowca: \"Zaproponuj produkt Y\"",
                        "Auto-email z rekomendacjƒÖ (opcjonalnie)"
                    ]
                },
                5: {
                    name: "Ryzyko utraty klienta",
                    description: "Identyfikuje klient√≥w zagro≈ºonych odej≈õciem i uruchamia dzia≈Çania retencyjne",
                    type: "retention",
                    parameters: "CLV i Retention Rate vs segment klient√≥w z tym samym tagiem",
                    enabled: true,
                    triggers: [
                        "Warto≈õƒá zam√≥wie≈Ñ spad≈Ça >40% vs poprzedni kwarta≈Ç",
                        "Czƒôstotliwo≈õƒá logowa≈Ñ spad≈Ça >60%"
                    ],
                    actions: [
                        "Czerwony alert dla handlowca",
                        "Auto-generowanie propozycji retencyjnej",
                        "Szybki prewencyjny telefon do klienta"
                    ]
                },
                6: {
                    name: "Przekroczenie limitu kredytowego",
                    description: "Monitoruje wykorzystanie limitu kredytowego i uruchamia wielopoziomowe akcje",
                    type: "credit",
                    parameters: "ERP (faktury) + Platforma",
                    enabled: true,
                    triggers: [
                        "Koszyk + nieop≈Çacone faktury > 90% limitu"
                    ],
                    actions: [
                        "90%: Info dla handlowca",
                        "95%: Alert do handlowca o potrzebie interwencji",
                        "100%: Auto-email do klienta + handlowca i dzia≈Ç finansowy"
                    ]
                }
            };
            
            return rules[ruleId] || {};
        }

        function addTrigger() {
            const triggersList = document.getElementById('triggersList');
            const triggerItem = document.createElement('div');
            triggerItem.className = 'trigger-item';
            triggerItem.innerHTML = `
                <input type="text" class="form-input" placeholder="Opis triggera...">
                <button type="button" class="btn btn-secondary" onclick="removeTrigger(this)">Usu≈Ñ</button>
            `;
            triggersList.appendChild(triggerItem);
        }

        function removeTrigger(button) {
            button.parentElement.remove();
        }

        function addAction() {
            const actionsList = document.getElementById('actionsList');
            const actionItem = document.createElement('div');
            actionItem.className = 'action-item';
            actionItem.innerHTML = `
                <input type="text" class="form-input" placeholder="Opis akcji...">
                <button type="button" class="btn btn-secondary" onclick="removeAction(this)">Usu≈Ñ</button>
            `;
            actionsList.appendChild(actionItem);
        }

        function removeAction(button) {
            button.parentElement.remove();
        }

        function addEditTrigger(text = '') {
            const editTriggersList = document.getElementById('editTriggersList');
            const triggerItem = document.createElement('div');
            triggerItem.className = 'trigger-item';
            triggerItem.innerHTML = `
                <input type="text" class="form-input" placeholder="Opis triggera..." value="${text}">
                <button type="button" class="btn btn-secondary" onclick="removeTrigger(this)">Usu≈Ñ</button>
            `;
            editTriggersList.appendChild(triggerItem);
        }

        function addEditAction(text = '') {
            const editActionsList = document.getElementById('editActionsList');
            const actionItem = document.createElement('div');
            actionItem.className = 'action-item';
            actionItem.innerHTML = `
                <input type="text" class="form-input" placeholder="Opis akcji..." value="${text}">
                <button type="button" class="btn btn-secondary" onclick="removeAction(this)">Usu≈Ñ</button>
            `;
            editActionsList.appendChild(actionItem);
        }

        // Prevent form submissions (for demo)
        document.querySelectorAll('form').forEach(form => {
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                alert('Demo: Formularz zosta≈Ç przes≈Çany pomy≈õlnie!');
                // Close modal if form is in modal
                const modal = this.closest('.modal');
                if (modal) {
                    modal.classList.remove('active');
                }
            });
        });
    </script>
</body>
</html>