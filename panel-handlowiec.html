<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Handlowca | SOHOsoft B2B Portal</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="https://cdn-uicons.flaticon.com/2.1.0/uicons-regular-rounded/css/uicons-regular-rounded.css">
    <link rel="stylesheet" href="https://cdn-uicons.flaticon.com/2.1.0/uicons-bold-rounded/css/uicons-bold-rounded.css">
    <link rel="stylesheet" href="https://cdn-uicons.flaticon.com/2.1.0/uicons-solid-rounded/css/uicons-solid-rounded.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --color-black: #000;
            --color-white: #fff;
            --color-gray: #ccc;
            --color-action: #ef7d05;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--color-white);
            color: var(--color-black);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }

        /* Top Navigation */
        .top-nav {
            background: var(--color-white);
            border-bottom: 1px solid var(--color-gray);
            padding: 0 30px;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .nav-left {
            display: flex;
            align-items: center;
            gap: 30px;
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            color: var(--color-black);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo i {
            font-size: 24px;
            color: var(--color-action);
        }

        .nav-menu {
            display: flex;
            gap: 5px;
            list-style: none;
        }

        .nav-menu a {
            text-decoration: none;
            color: var(--color-black);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .nav-menu a:hover {
            background: var(--color-gray);
            color: var(--color-black);
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .notification-btn {
            position: relative;
            background: none;
            border: none;
            font-size: 22px;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: background 0.2s;
        }

        .notification-btn:hover {
            background: var(--color-gray);
        }

        .notification-badge {
            position: absolute;
            top: 5px;
            right: 5px;
            background: var(--color-action);
            color: var(--color-white);
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 10px;
            font-weight: 600;
        }

        .notification-dropdown {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 8px;
            background: var(--color-white);
            border: 1px solid var(--color-gray);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            min-width: 320px;
            max-width: 400px;
            z-index: 1000;
            overflow: hidden;
        }

        .notification-dropdown.active {
            display: block;
        }

        .notification-header {
            padding: 16px;
            border-bottom: 1px solid var(--color-gray);
            font-weight: 600;
            color: var(--color-black);
            font-size: 14px;
        }

        .notification-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .notification-item {
            padding: 16px;
            border-bottom: 1px solid var(--color-gray);
            cursor: pointer;
            transition: background 0.2s;
        }

        .notification-item:hover {
            background: var(--color-gray);
        }

        .notification-item:last-child {
            border-bottom: none;
        }

        .notification-item-title {
            font-weight: 600;
            color: var(--color-black);
            font-size: 14px;
            margin-bottom: 4px;
        }

        .notification-item-desc {
            font-size: 13px;
            color: #666;
            margin-bottom: 8px;
        }

        .notification-item-time {
            font-size: 12px;
            color: #666;
        }

        .notification-item-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            margin-top: 4px;
        }

        .notification-item-status.new {
            background: rgba(239, 125, 5, 0.1);
            color: var(--color-action);
        }

        .notification-item-status.updated {
            background: rgba(0, 0, 0, 0.1);
            color: var(--color-black);
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 16px;
            border-radius: 10px;
            cursor: pointer;
            transition: background 0.2s;
            position: relative;
        }

        .user-menu:hover {
            background: var(--color-gray);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--color-black);
            color: var(--color-white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
        }

        .user-info {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 600;
            color: var(--color-black);
            font-size: 14px;
        }

        .user-role {
            font-size: 12px;
            color: var(--color-gray);
        }

        .user-menu-dropdown {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 8px;
            background: var(--color-white);
            border: 1px solid var(--color-gray);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            min-width: 180px;
            z-index: 1000;
            overflow: hidden;
        }

        .user-menu-dropdown.active {
            display: block;
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 16px;
            width: 100%;
            border: none;
            background: none;
            text-align: left;
            cursor: pointer;
            font-size: 14px;
            color: var(--color-black);
            transition: background 0.2s;
        }

        .dropdown-item:hover {
            background: var(--color-gray);
        }

        .dropdown-divider {
            height: 1px;
            background: var(--color-gray);
            margin: 4px 0;
        }

        /* Navigation Tabs */
        .nav-tabs {
            background: white;
            border-bottom: 1px solid #ccc;
            padding: 0 2rem;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 2rem;
            position: relative;
        }

        .nav-tab {
            padding: 1rem 0;
            color: var(--color-black);
            text-decoration: none;
            border-bottom: 2px solid transparent;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .nav-tab:hover {
            color: #ef7d05;
        }

        .nav-tab.active {
            color: #ef7d05;
            border-bottom-color: #ef7d05;
        }

        .nav-tabs .btn {
            position: absolute;
            right: 2rem;
            top: 50%;
            transform: translateY(-50%);
        }

        /* BoxIcons styling */
        .bx {
            color: #ef7d05;
            font-size: 1.2rem;
        }

        .task-icon .bx {
            font-size: 1.5rem;
        }

        .activity-icon .bx {
            font-size: 1.5rem;
        }

        .goal-action-button .bx {
            color: white;
            font-size: 0.875rem;
        }

        /* Business Rules Styles */
        .business-rules-list {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .rule-item {
            background: #fff;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 1.5rem;
            transition: all 0.2s;
        }

        .rule-item:hover {
            background: #fff;
            border-color: #d1d5db;
        }

        .rule-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .rule-info h4 {
            margin: 0 0 0.5rem 0;
            color: #000;
            font-size: 1.125rem;
            font-weight: 600;
        }

        .rule-description {
            margin: 0;
            color: #666;
            font-size: 0.875rem;
            line-height: 1.4;
        }

        .rule-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .rule-details {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 1.5rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #ccc;
        }

        .rule-triggers,
        .rule-actions,
        .rule-parameters {
            background: white;
            padding: 1rem;
            border-radius: 6px;
            border: 1px solid #ccc;
        }

        .rule-triggers strong,
        .rule-actions strong,
        .rule-parameters strong {
            color: #000;
            font-size: 0.875rem;
            display: block;
            margin-bottom: 0.5rem;
        }

        .rule-triggers ul,
        .rule-actions ul {
            margin: 0;
            padding-left: 1rem;
            color: #666;
            font-size: 0.813rem;
            line-height: 1.4;
        }

        .rule-triggers li,
        .rule-actions li {
            margin-bottom: 0.25rem;
        }

        .rule-parameters span {
            color: #666;
            font-size: 0.813rem;
            line-height: 1.4;
        }

        .rule-actions ul li strong {
            color: #dc2626;
            font-weight: 600;
            display: inline;
            margin: 0;
        }

        @media (max-width: 768px) {
            .rule-details {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .rule-header {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }
            
            .rule-controls {
                justify-content: space-between;
            }
        }

        /* Rule Form Styles */
        .trigger-item,
        .action-item {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
            align-items: center;
        }

        .trigger-item input,
        .action-item input {
            flex: 1;
        }

        .trigger-item button,
        .action-item button {
            flex-shrink: 0;
            padding: 0.5rem 0.75rem;
            font-size: 0.813rem;
        }

        /* Scoring Configuration Styles */
        .scoring-config-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .scoring-category h4 {
            margin: 0 0 1rem 0;
            color: #000;
            font-size: 1.125rem;
            font-weight: 600;
        }

        .scoring-items {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .scoring-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background: white;
            border: 1px solid #ccc;
            border-radius: 6px;
        }

        .scoring-item span {
            font-weight: 500;
            color: #000;
        }

        .scoring-points {
            width: 25% !important;
            text-align: center;
        }

        .scoring-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        /* Form Section Styles */
        .form-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: #fff;
            border-radius: 8px;
            border: 1px solid #ccc;
        }

        .form-section h4 {
            margin: 0 0 1.5rem 0;
            color: #000;
            font-size: 1.125rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .form-row.three-cols {
            grid-template-columns: 1fr 1fr 1fr;
        }

        /* Checkbox Group Styles */
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 0.75rem;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }

        .checkbox-item input[type="checkbox"] {
            margin: 0;
        }

        .checkbox-item span {
            font-size: 0.875rem;
            color: #000;
        }

        /* Trigger and Action Config Styles */
        .trigger-config,
        .action-config {
            flex: 1;
            margin-right: 1rem;
        }

        .scoring-trigger-config,
        .custom-trigger-config {
            margin-top: 1rem;
        }

        .trigger-item,
        .action-item {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            margin-bottom: 1rem;
            padding: 1rem;
            background: white;
            border: 1px solid #ccc;
            border-radius: 6px;
        }


        .scoring-points-input,
        .scoring-time-input,
        .action-time-input {
            width: 100%;
        }

        @media (max-width: 768px) {
            .scoring-config-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .checkbox-group {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .trigger-item,
            .action-item {
                flex-direction: column;
                align-items: stretch;
            }
            
            .trigger-config,
            .action-config {
                margin-right: 0;
                margin-bottom: 1rem;
            }
        }

        /* Main Container */
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Cards */
        .ecme-card {
            background: white;
            border-radius: 8px;
            border: 1px solid #ccc;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #000;
        }

        /* Metrics Grid */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .metric-card {
            background: white;
            border-radius: 8px;
            border: 1px solid #ccc;
            padding: 1.5rem;
        }

        .metric-label {
            font-size: 0.875rem;
            color: #666;
            margin-bottom: 0.5rem;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: 600;
            color: #000;
            margin-bottom: 0.5rem;
        }

        .metric-change {
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .metric-change.positive {
            color: #10b981;
        }

        .metric-change.negative {
            color: #ef4444;
        }

        .metric-change.neutral {
            color: #666;
        }

        /* Buttons */
        .btn {
            padding: 0.625rem 1.25rem;
            border-radius: 6px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.875rem;
        }

        .btn-primary {
            background: #ef7d05;
            color: white;
        }

        .btn-primary:hover {
            background: #d66a04;
        }

        .btn-secondary {
            background: #fff;
            color: #000;
        }

        .btn-secondary:hover {
            background: #ccc;
        }

        /* Goals Section */
        .goals-grid {
            display: grid;
            gap: 1rem;
        }

        .goal-item {
            background: #fff;
            border: 1px solid #ccc;
            border-radius: 6px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .goal-item:hover {
            background: #fff;
        }

        .goal-actions {
            display: none;
            flex-direction: column;
            gap: 0.5rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #ccc;
        }

        .goal-actions.show {
            display: flex;
        }

        .goal-action-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem;
            background: white;
            border-radius: 6px;
            border: 1px solid #ccc;
        }

        .goal-action-text {
            font-size: 0.875rem;
            color: #000;
        }

        .goal-action-button {
            background: #ef7d05;
            color: white;
            border: none;
            padding: 0.375rem 0.75rem;
            border-radius: 4px;
            font-size: 0.75rem;
            cursor: pointer;
        }

        .goal-action-button:hover {
            background: #d66a04;
        }

        .goal-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 0.75rem;
        }

        .goal-title {
            font-weight: 600;
            color: #000;
            margin-bottom: 0.25rem;
        }

        .goal-meta {
            font-size: 0.813rem;
            color: #666;
        }

        .goal-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .goal-badge.liczbowy {
            background: rgba(239, 125, 5, 0.1);
            color: #d66a04;
        }

        .goal-badge.jakosciowy {
            background: #f3e8ff;
            color: #6b21a8;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #ccc;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }

        .progress-fill {
            height: 100%;
            background: #ef7d05;
            transition: width 0.3s ease;
        }

        .progress-fill.complete {
            background: #10b981;
        }

        .progress-label {
            font-size: 0.813rem;
            color: #666;
        }

        /* Tasks Section */
        .task-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .task-item {
            background: #fff;
            border: 1px solid #ccc;
            border-radius: 6px;
            padding: 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.2s;
        }

        .task-item:hover {
            border-color: #ef7d05;
            background: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .task-content {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex: 1;
        }

        .task-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(239, 125, 5, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            flex-shrink: 0;
        }

        .task-details {
            flex: 1;
        }

        .task-title {
            font-weight: 500;
            color: #000;
            margin-bottom: 0.25rem;
        }

        .task-meta {
            font-size: 0.813rem;
            color: #666;
        }

        .task-priority {
            display: inline-block;
            padding: 0.25rem 0.625rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
            margin-left: 0.5rem;
        }

        .task-priority.high {
            background: #fee2e2;
            color: #991b1b;
        }

        .task-priority.medium {
            background: #fef3c7;
            color: #92400e;
        }

        .task-priority.low {
            background: rgba(239, 125, 5, 0.1);
            color: #d66a04;
        }

        .task-action {
            margin-left: 1rem;
        }

        .btn-success {
            background: #ef7d05;
            color: white;
            border: 1px solid #ef7d05;
        }

        .btn-success:hover {
            background: #d66a04;
            border-color: #d66a04;
        }

        .btn-warning {
            background: #ccc;
            color: white;
            border: 1px solid #ccc;
        }

        .btn-warning:hover {
            background: #4b5563;
            border-color: #4b5563;
        }

        .btn-outline {
            background: white;
            border: 1px solid #ef7d05;
            color: #ef7d05;
        }

        .btn-outline:hover {
            background: #f0f9ff;
            color: #d66a04;
            border-color: #d66a04;
        }

        .task-item {
            cursor: move;
            transition: all 0.2s;
            position: relative;
        }

        .task-drag-handle {
            position: absolute;
            left: 0.5rem;
            top: 50%;
            transform: translateY(-50%);
            color: #9ca3af;
            font-size: 1.2rem;
            cursor: grab;
        }

        .task-drag-handle:active {
            cursor: grabbing;
        }

        .task-item:hover {
            background: #fff;
        }

        .task-item.dragging {
            opacity: 0.5;
        }

        .task-item.completed {
            opacity: 0.6;
            text-decoration: line-through;
        }

        .task-checkbox {
            margin-right: 0.75rem;
            margin-left: 2rem;
        }

        .task-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* Activity Feed */
        .activity-feed {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .activity-item {
            display: flex;
            gap: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #ccc;
            cursor: pointer;
            transition: all 0.2s;
        }

        .activity-item:hover {
            background: #fff;
            margin: 0 -0.5rem;
            padding-left: 0.5rem;
            padding-right: 0.5rem;
            border-radius: 6px;
        }

        .activity-item:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-weight: 500;
            color: #000;
            margin-bottom: 0.25rem;
        }

        .activity-meta {
            font-size: 0.813rem;
            color: #666;
        }

        .activity-time {
            font-size: 0.813rem;
            color: #9ca3af;
            white-space: nowrap;
        }

        .activity-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .activity-actions .btn {
            font-size: 0.75rem;
            padding: 0.375rem 0.75rem;
        }

        /* Customers Table */
        .customers-table {
            width: 100%;
            border-collapse: collapse;
        }

        .customers-table thead {
            background: #fff;
        }

        .customers-table th {
            text-align: left;
            padding: 0.75rem;
            font-size: 0.813rem;
            font-weight: 600;
            color: #666;
            border-bottom: 1px solid #ccc;
        }

        .customers-table td {
            padding: 1rem 0.75rem;
            border-bottom: 1px solid #ccc;
            font-size: 0.875rem;
        }

        .customers-table tbody tr:hover {
            background: #fff;
        }

        .customer-name {
            font-weight: 500;
            color: #000;
        }

        .customer-company {
            font-size: 0.813rem;
            color: #666;
        }

        .tag {
            display: inline-block;
            padding: 0.25rem 0.625rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
            background: rgba(239, 125, 5, 0.1);
            color: #d66a04;
        }

        /* Notes Section */
        .note-item {
            background: #fffbeb;
            border: 1px solid #fef3c7;
            border-radius: 6px;
            padding: 1rem;
            margin-bottom: 0.75rem;
        }

        .note-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .note-type {
            font-size: 0.75rem;
            font-weight: 500;
            color: #92400e;
        }

        .note-date {
            font-size: 0.75rem;
            color: #92400e;
        }

        .note-content {
            font-size: 0.875rem;
            color: #000;
        }

        /* Calendar */
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .calendar-nav {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: #ccc;
            border: 1px solid #ccc;
        }

        .calendar-day-header {
            background: #fff;
            padding: 0.5rem;
            text-align: center;
            font-size: 0.813rem;
            font-weight: 600;
            color: #666;
        }

        .calendar-day {
            background: white;
            min-height: 100px;
            padding: 0.5rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        .calendar-day:hover {
            background: #fff;
        }

        .calendar-day-number {
            font-size: 0.875rem;
            font-weight: 500;
            color: #000;
            margin-bottom: 0.5rem;
        }

        .calendar-day.other-month {
            background: #fff;
        }

        .calendar-day.other-month .calendar-day-number {
            color: #9ca3af;
        }

        .calendar-event {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            margin-bottom: 0.25rem;
            background: rgba(239, 125, 5, 0.1);
            color: #d66a04;
        }

        .calendar-event.visit {
            background: #dcfce7;
            color: #166534;
        }

        /* Map */
        #route-map {
            height: 500px;
            border-radius: 6px;
            border: 1px solid #ccc;
        }

        .route-list {
            margin-top: 1rem;
        }

        .route-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: #fff;
            border: 1px solid #ccc;
            border-radius: 6px;
            margin-bottom: 0.75rem;
        }

        .route-number {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #ef7d05;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            flex-shrink: 0;
        }

        .route-info {
            flex: 1;
        }

        .route-customer {
            font-weight: 500;
            color: #000;
        }

        .route-address {
            font-size: 0.813rem;
            color: #666;
        }

        .route-time {
            font-size: 0.813rem;
            color: #666;
            text-align: right;
        }

        /* Forms */
        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: #000;
            margin-bottom: 0.5rem;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 0.625rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.875rem;
            background: #fff;
            transition: all 0.2s;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: #ef7d05;
            background: white;
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 8px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #000;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #666;
            cursor: pointer;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 44px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #d1d5db;
            transition: 0.3s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: #ef7d05;
        }

        input:checked + .toggle-slider:before {
            transform: translateX(20px);
        }

        /* Alert Box */
        .alert {
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
            display: flex;
            align-items: start;
            gap: 0.75rem;
        }

        .alert-info {
            background: rgba(239, 125, 5, 0.1);
            border: 1px solid #93c5fd;
            color: #d66a04;
        }

        .alert-warning {
            background: #fef3c7;
            border: 1px solid #fde68a;
            color: #92400e;
        }

        .alert-icon {
            flex-shrink: 0;
        }

        /* Action Type Selector */
        .action-type-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .action-type-option {
            padding: 1.5rem;
            border: 2px solid #ccc;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .action-type-option:hover {
            border-color: #ef7d05;
            background: #f0f9ff;
        }

        .action-type-option.selected {
            border-color: #ef7d05;
            background: rgba(239, 125, 5, 0.1);
        }

        .action-type-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .action-type-label {
            font-weight: 500;
            color: #000;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .main-nav {
                gap: 1rem;
            }
            
            .nav-item {
                padding: 0.5rem 0.75rem;
                font-size: 0.875rem;
            }
        }

        @media (max-width: 1200px) {
            .metrics-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .metrics-grid {
                grid-template-columns: 1fr;
            }

            .nav-tabs {
                overflow-x: auto;
            }

            .action-type-selector {
                grid-template-columns: 1fr;
            }

            .header-top {
                display: none;
            }

            .main-nav {
                display: none;
            }

        }
    </style>
</head>
<body>
    <!-- Top Navigation -->
    <nav class="top-nav">
        <div class="nav-left">
            <div class="logo">
                <i class="fi fi-rr-factory"></i>
                <span>SOHOsoft</span>
            </div>
        </div>
        <div class="nav-right">
            <div style="position: relative;">
                <button class="notification-btn" onclick="toggleNotificationMenu(event)">
                    <i class="fi fi-rr-bell"></i>
                    <span class="notification-badge">3</span>
                </button>
                <div class="notification-dropdown" id="notificationDropdown">
                    <div class="notification-header">
                        <i class="fi fi-rr-bell"></i> Powiadomienia
                    </div>
                    <div class="notification-list">
                        <div class="notification-item">
                            <div class="notification-item-title">Nowy klient - Mateusz Wiktorowicz</div>
                            <div class="notification-item-desc">Wysoka wartość potencjalna</div>
                            <div class="notification-item-time">2 godziny temu</div>
                            <span class="notification-item-status new">Nowe</span>
                        </div>
                        <div class="notification-item">
                            <div class="notification-item-title">Cel handlowy - 85% realizacji</div>
                            <div class="notification-item-desc">Brakuje 15% do osiągnięcia celu</div>
                            <div class="notification-item-time">5 godzin temu</div>
                            <span class="notification-item-status updated">W toku</span>
                        </div>
                        <div class="notification-item">
                            <div class="notification-item-title">Zaplanowana wizyta - jutro</div>
                            <div class="notification-item-desc">Firma Budowlana Budowa, 10:00</div>
                            <div class="notification-item-time">Wczoraj, 14:30</div>
                            <span class="notification-item-status updated">Zaplanowane</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="user-menu" onclick="toggleUserMenu(event)">
                <div class="user-avatar">JK</div>
                <div class="user-info">
                    <div class="user-name">Jan Kowalski</div>
                    <div class="user-role">Handlowiec</div>
                </div>
                <div class="user-menu-dropdown" id="userMenuDropdown">
                    <div class="dropdown-divider"></div>
                    <button class="dropdown-item" onclick="window.location.href='index.html'">
                        <i class="fi fi-rr-sign-out"></i>
                        <span>Wyloguj</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>


    <!-- Navigation Tabs -->
    <div class="nav-tabs">
        <a class="nav-tab active" onclick="switchTab('dashboard')">Dashboard</a>
        <a class="nav-tab" onclick="switchTab('goals')">Cele handlowe</a>
        <a class="nav-tab" onclick="switchTab('customers')">Klienci</a>
        <a class="nav-tab" onclick="switchTab('calendar')">Kalendarz</a>
        <a class="nav-tab" onclick="switchTab('routes')">Trasy wizyt</a>
        <a class="nav-tab" onclick="switchTab('settings')">Ustawienia</a>
        <button class="btn btn-primary" onclick="showModal('addModal')">+ Dodaj</button>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <!-- Metrics Grid - 8 wskaźników -->
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-label">Przychody</div>
                    <div class="metric-value">124 890 PLN</div>
                    <div class="metric-change positive">
                        <span>↑</span> +12% vs poprzedni
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Transakcje</div>
                    <div class="metric-value">342</div>
                    <div class="metric-change positive">
                        <span>↑</span> +8% w tym okresie
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Średni koszyk</div>
                    <div class="metric-value">365 PLN</div>
                    <div class="metric-change positive">
                        <span>↑</span> +4% vs poprzedni
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Konwersja</div>
                    <div class="metric-value">3.7%</div>
                    <div class="metric-change neutral">
                        <span>→</span> Bez zmian
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Liczba klientów</div>
                    <div class="metric-value">47</div>
                    <div class="metric-change positive">
                        <span>↑</span> +5 w tym miesiącu
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">LTV klienta</div>
                    <div class="metric-value">24 750 PLN</div>
                    <div class="metric-change positive">
                        <span>↑</span> +15% wzrost
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Częstotliwość zakupów</div>
                    <div class="metric-value">2.3 / mies.</div>
                    <div class="metric-change negative">
                        <span>↓</span> -7% vs poprzedni
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Realizacja celów</div>
                    <div class="metric-value">73%</div>
                    <div class="metric-change negative">
                        <span>↓</span> 5 celów w opóźnieniu
                    </div>
                </div>
            </div>


            <!-- Tasks for Today -->
            <div class="ecme-card">
                <div class="card-header">
                    <h3 class="card-title">Zadania na dziś</h3>
                    <button class="btn btn-primary" onclick="showModal('addModal')">+ Nowe zadanie</button>
                </div>
                <div class="task-list" id="taskList">
                    <div class="task-item" draggable="true">
                        <div class="task-drag-handle">⋮⋮</div>
                        <input type="checkbox" class="task-checkbox" onchange="toggleTask(this)">
                        <div class="task-content">
                            <div class="task-icon"><i class='bx bx-car'></i></div>
                            <div class="task-details">
                                <div class="task-title">Wizyta u klienta - Firma Budowlana Budowa
                                    <span class="task-priority high">Wysoki</span>
                                </div>
                                <div class="task-meta">10:00 • ul. Marszałkowska 15, Warszawa • Omówienie zamówienia cementu</div>
                            </div>
                        </div>
                        <div class="task-actions">
                            <button class="btn btn-secondary" onclick="editTask(this)">Edytuj</button>
                            <button class="btn btn-success">Rozpocznij</button>
                        </div>
                    </div>

                    <div class="task-item" draggable="true">
                        <div class="task-drag-handle">⋮⋮</div>
                        <input type="checkbox" class="task-checkbox" onchange="toggleTask(this)">
                        <div class="task-content">
                            <div class="task-icon"><i class='bx bx-car'></i></div>
                            <div class="task-details">
                                <div class="task-title">Wizyta u klienta - Przykładowa Firma Budowlana Sp. z o.o.
                                    <span class="task-priority high">Wysoki</span>
                                </div>
                                <div class="task-meta">14:30 • ul. Nowy Świat 45, Warszawa • Prezentacja nowych produktów cementowych</div>
                            </div>
                        </div>
                        <div class="task-actions">
                            <button class="btn btn-secondary" onclick="editTask(this)">Edytuj</button>
                            <button class="btn btn-success">Szczegóły</button>
                        </div>
                    </div>

                    <div class="task-item" draggable="true">
                        <div class="task-drag-handle">⋮⋮</div>
                        <input type="checkbox" class="task-checkbox" onchange="toggleTask(this)">
                        <div class="task-content">
                            <div class="task-icon"><i class='bx bx-user-plus'></i></div>
                            <div class="task-details">
                                <div class="task-title">Pozyskaj 2 nowe rejestracje
                                    <span class="task-priority medium">Średni</span>
                                </div>
                                <div class="task-meta">Cel Styczeń 2026 • Pozostało: 11 rejestracji do końca kwartału</div>
                            </div>
                        </div>
                        <div class="task-actions">
                            <button class="btn btn-secondary" onclick="editTask(this)">Edytuj</button>
                            <button class="btn btn-success">Zobacz leady</button>
                        </div>
                    </div>

                    <div class="task-item" draggable="true">
                        <div class="task-drag-handle">⋮⋮</div>
                        <input type="checkbox" class="task-checkbox" onchange="toggleTask(this)">
                        <div class="task-content">
                            <div class="task-icon"><i class='bx bx-phone-call'></i></div>
                            <div class="task-details">
                                <div class="task-title">Rozmowa telefoniczna - Budowa Plus Sp. z o.o.
                                    <span class="task-priority medium">Średni</span>
                                </div>
                                <div class="task-meta">16:00 • Potwierdzenie zamówienia cementu</div>
                            </div>
                        </div>
                        <div class="task-actions">
                            <button class="btn btn-secondary" onclick="editTask(this)">Edytuj</button>
                            <button class="btn btn-success">Rozpocznij</button>
                        </div>
                    </div>

                    <div class="task-item" draggable="true">
                        <div class="task-drag-handle">⋮⋮</div>
                        <input type="checkbox" class="task-checkbox" onchange="toggleTask(this)">
                        <div class="task-content">
                            <div class="task-icon"><i class='bx bx-envelope'></i></div>
                            <div class="task-details">
                                <div class="task-title">Wysłanie oferty - Auto-All Magazynowa
                                    <span class="task-priority low">Niski</span>
                                </div>
                                <div class="task-meta">18:00 • Nowa oferta produktów cementowych</div>
                            </div>
                        </div>
                        <div class="task-actions">
                            <button class="btn btn-secondary" onclick="editTask(this)">Edytuj</button>
                            <button class="btn btn-success">Rozpocznij</button>
                        </div>
                    </div>

                    
                </div>
            </div>

            <!-- Two Column Layout -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                <!-- Recent Activity -->
                <div class="ecme-card">
                    <div class="card-header">
                        <h3 class="card-title">Ostatnie aktywności klientów</h3>
                    </div>
                    <div class="activity-feed">
                        <div class="activity-item" onclick="showActivityActions(this)">
                            <div class="activity-icon"><i class='bx bx-shopping-bag'></i></div>
                            <div class="activity-content">
                                <div class="activity-title">Nowe zamówienie #8915</div>
                                <div class="activity-meta">Firma Budowlana Budowa • 2,450 PLN</div>
                                <div class="activity-actions" style="display: none;">
                                    <button class="btn btn-secondary" onclick="event.stopPropagation(); showNoteModal('Firma Budowlana Budowa')">+ Notatka</button>
                                    <button class="btn btn-primary" onclick="event.stopPropagation(); showTaskModal('Firma Budowlana Budowa')">+ Zadanie</button>
                                </div>
                            </div>
                            <div class="activity-time">2 godz. temu</div>
                        </div>
                        <div class="activity-item" onclick="showActivityActions(this)">
                            <div class="activity-icon"><i class='bx bx-user-plus'></i></div>
                            <div class="activity-content">
                                <div class="activity-title">Nowa rejestracja</div>
                                <div class="activity-meta">Elmas Pawlak S.J. • Warszawa</div>
                                <div class="activity-actions" style="display: none;">
                                    <button class="btn btn-secondary" onclick="event.stopPropagation(); showNoteModal('Elmas Pawlak S.J.')">+ Notatka</button>
                                    <button class="btn btn-primary" onclick="event.stopPropagation(); showTaskModal('Elmas Pawlak S.J.')">+ Zadanie</button>
                                </div>
                            </div>
                            <div class="activity-time">5 godz. temu</div>
                        </div>
                        <div class="activity-item" onclick="showActivityActions(this)">
                            <div class="activity-icon"><i class='bx bx-search'></i></div>
                            <div class="activity-content">
                                <div class="activity-title">Przeglądał produkty</div>
                                <div class="activity-meta">Budowa Plus Sp. z o.o. • CEM I 42,5R</div>
                                <div class="activity-actions" style="display: none;">
                                    <button class="btn btn-secondary" onclick="event.stopPropagation(); showNoteModal('Budowa Plus Sp. z o.o.')">+ Notatka</button>
                                    <button class="btn btn-primary" onclick="event.stopPropagation(); showTaskModal('Budowa Plus Sp. z o.o.')">+ Zadanie</button>
                                </div>
                            </div>
                            <div class="activity-time">1 dzień temu</div>
                        </div>
                        <div class="activity-item" onclick="showActivityActions(this)">
                            <div class="activity-icon"><i class='bx bx-x-circle'></i></div>
                            <div class="activity-content">
                                <div class="activity-title">Porzucony koszyk</div>
                                <div class="activity-meta">Auto-All Magazynowa • 850 PLN wartości</div>
                                <div class="activity-actions" style="display: none;">
                                    <button class="btn btn-secondary" onclick="event.stopPropagation(); showNoteModal('Auto-All Magazynowa')">+ Notatka</button>
                                    <button class="btn btn-primary" onclick="event.stopPropagation(); showTaskModal('Auto-All Magazynowa')">+ Zadanie</button>
                                </div>
                            </div>
                            <div class="activity-time">2 dni temu</div>
                        </div>
                        <div class="activity-item" onclick="showActivityActions(this)">
                            <div class="activity-icon"><i class='bx bx-envelope'></i></div>
                            <div class="activity-content">
                                <div class="activity-title">Zapytanie ofertowe</div>
                                <div class="activity-meta">Przykładowa Firma Budowlana Sp. z o.o. • CEM II/B-S 42,5N</div>
                                <div class="activity-actions" style="display: none;">
                                    <button class="btn btn-secondary" onclick="event.stopPropagation(); showNoteModal('Przykładowa Firma Budowlana Sp. z o.o.')">+ Notatka</button>
                                    <button class="btn btn-primary" onclick="event.stopPropagation(); showTaskModal('Przykładowa Firma Budowlana Sp. z o.o.')">+ Zadanie</button>
                                </div>
                            </div>
                            <div class="activity-time">3 dni temu</div>
                        </div>
                    </div>
                </div>

                <!-- Active Goals Summary -->
                <div class="ecme-card">
                    <div class="card-header">
                        <h3 class="card-title">Aktywne cele</h3>
                        <button class="btn btn-secondary" onclick="switchTab('goals')">Zobacz wszystkie</button>
                    </div>
                    <div class="goals-grid">
                        <div class="goal-item" onclick="toggleGoalActions(this)">
                            <div class="goal-header">
                                <div>
                                    <div class="goal-title">Przychód Styczeń 2026</div>
                                    <div class="goal-meta">Do 31 grudnia 2024</div>
                                </div>
                                <span class="goal-badge liczbowy">Liczbowy</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 78%"></div>
                            </div>
                            <div class="progress-label">234,500 PLN / 300,000 PLN (78%)</div>
                            <div class="goal-actions">
                                <div class="goal-action-item">
                                    <span class="goal-action-text">Skontaktuj się z potencjalnymi klientami z listy leadów</span>
                                    <button class="goal-action-button" onclick="event.stopPropagation(); alert('Przekierowanie do leadów')">Zobacz leady</button>
                                </div>
                                <div class="goal-action-item">
                                    <span class="goal-action-text">Zaplanuj wizyty u klientów Premium</span>
                                    <button class="goal-action-button" onclick="event.stopPropagation(); alert('Dodawanie wizyt')">Dodaj wizyty</button>
                                </div>
                                <div class="goal-action-item">
                                    <span class="goal-action-text">Wyślij newsletter do nieaktywnych klientów</span>
                                    <button class="goal-action-button" onclick="event.stopPropagation(); alert('Tworzenie newslettera')">Utwórz</button>
                                </div>
                            </div>
                        </div>
                        <div class="goal-item" onclick="toggleGoalActions(this)">
                            <div class="goal-header">
                                <div>
                                    <div class="goal-title">Nowe rejestracje</div>
                                    <div class="goal-meta">Do 31 grudnia 2024</div>
                                </div>
                                <span class="goal-badge liczbowy">Liczbowy</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 56%"></div>
                            </div>
                            <div class="progress-label">14 / 25 rejestracji (56%)</div>
                            <div class="goal-actions">
                                <div class="goal-action-item">
                                    <span class="goal-action-text">Zweryfikuj ruch na stronie i znajdź kontakty do rejestracji</span>
                                    <button class="goal-action-button" onclick="event.stopPropagation(); alert('Przekierowanie do leadów')">Znajdź kontakty</button>
                                </div>
                            </div>
                        </div>
                        <div class="goal-item" onclick="toggleGoalActions(this)">
                            <div class="goal-header">
                                <div>
                                    <div class="goal-title">Wizyty u klientów</div>
                                    <div class="goal-meta">Do 31 grudnia 2024</div>
                                </div>
                                <span class="goal-badge liczbowy">Liczbowy</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 45%"></div>
                            </div>
                            <div class="progress-label">27 / 60 wizyt (45%)</div>
                            <div class="goal-actions">
                                <div class="goal-action-item">
                                    <span class="goal-action-text">Zaplanuj wizyty u klientów Premium</span>
                                    <button class="goal-action-button" onclick="event.stopPropagation(); alert('Dodawanie wizyt')">Dodaj wizyty</button>
                                </div>
                            </div>
                        </div>
                        <div class="goal-item">
                            <div class="goal-header">
                                <div>
                                    <div class="goal-title">Retencja klientów Premium</div>
                                    <div class="goal-meta">Cel ciągły</div>
                                </div>
                                <span class="goal-badge jakosciowy">Jakościowy</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill complete" style="width: 92%"></div>
                            </div>
                            <div class="progress-label">92% retencja (cel: >85%)</div>
                            <div class="goal-actions">
                                <div class="goal-action-item">
                                <span class="goal-action-text">Skontaktuj się z klientami, którzy porzucili koszyki w ostatnich 7 dniach</span>
                                <button class="goal-action-button" onclick="event.stopPropagation(); alert('Przekierowanie do kontaktów')">Zobacz kontakty</button>
                                </div>
                            </div>
                            </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="ecme-card">
                <div class="card-header">
                    <h3 class="card-title">Sugerowane działania</h3>
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                    <div style="padding: 1.5rem; background: #fff; border-radius: 8px; border: 1px solid #ccc; display: flex; align-items: flex-start; gap: 1rem;">
                        <div style="width: 40px; height: 40px; background: rgba(239, 125, 5, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            <i class='bx bx-phone-call' style="color: #ef7d05; font-size: 1.2rem;"></i>
                        </div>
                        <div style="flex: 1;">
                            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                                <h4 style="font-weight: 600; color: #000; margin: 0;">Kontakt z nieaktywnymi klientami</h4>
                                <span style="background: #dc2626; color: white; padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.75rem; font-weight: 500;">Wysoki</span>
                            </div>
                            <p style="font-size: 0.875rem; color: #666; margin: 0 0 1rem 0;">3 klientów bez zamówienia >30 dni • Budowa Plus Sp. z o.o., Auto-All Magazynowa, Elmas Pawlak S.J.</p>
                            <button class="btn btn-outline" style="width: 100%;">Zadzwoń</button>
                        </div>
                    </div>
                    <div style="padding: 1.5rem; background: #fff; border-radius: 8px; border: 1px solid #ccc; display: flex; align-items: flex-start; gap: 1rem;">
                        <div style="width: 40px; height: 40px; background: rgba(239, 125, 5, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            <i class='bx bx-target-lock' style="color: #ef7d05; font-size: 1.2rem;"></i>
                        </div>
                        <div style="flex: 1;">
                            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                                <h4 style="font-weight: 600; color: #000; margin: 0;">Oferta dla porzuconych koszyków</h4>
                                <span style="background: #f59e0b; color: white; padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.75rem; font-weight: 500;">Średni</span>
                            </div>
                            <p style="font-size: 0.875rem; color: #666; margin: 0 0 1rem 0;">2 klientów z wartością >800 PLN • Auto-All Magazynowa, Skład Regionalny</p>
                            <button class="btn btn-outline" style="width: 100%;">Przygotuj ofertę</button>
                        </div>
                    </div>
                    <div style="padding: 1.5rem; background: #fff; border-radius: 8px; border: 1px solid #ccc; display: flex; align-items: flex-start; gap: 1rem;">
                        <div style="width: 40px; height: 40px; background: rgba(239, 125, 5, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            <i class='bx bx-envelope' style="color: #ef7d05; font-size: 1.2rem;"></i>
                        </div>
                        <div style="flex: 1;">
                            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                                <h4 style="font-weight: 600; color: #000; margin: 0;">Odpowiedź na zapytanie - Przykładowa Firma Budowlana Sp. z o.o.</h4>
                                <span style="background: #ef7d05; color: white; padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.75rem; font-weight: 500;">Niski</span>
                            </div>
                            <p style="font-size: 0.875rem; color: #666; margin: 0 0 1rem 0;">Zapytanie o CEM II/B-S 42,5N • Otrzymane 3 dni temu</p>
                            <button class="btn btn-outline" style="width: 100%;">Odpowiedz</button>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!-- Goals Tab -->
        <div id="goals" class="tab-content">
            <div class="ecme-card">
                <div class="card-header">
                    <h3 class="card-title">Cele handlowe</h3>
                    <button class="btn btn-primary" onclick="showModal('goalModal')">+ Nowy cel</button>
                </div>

                <!-- Filter Tabs -->
                <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; border-bottom: 1px solid #ccc;">
                    <button class="btn btn-secondary goal-filter-btn active" onclick="filterGoals('all')" style="border-radius: 0; border-bottom: 2px solid #ef7d05;">Wszystkie (12)</button>
                    <button class="btn btn-secondary goal-filter-btn" onclick="filterGoals('numeric')" style="border-radius: 0; border-bottom: 2px solid transparent;">Liczbowe (8)</button>
                    <button class="btn btn-secondary goal-filter-btn" onclick="filterGoals('qualitative')" style="border-radius: 0; border-bottom: 2px solid transparent;">Jakościowe (4)</button>
                    <button class="btn btn-secondary goal-filter-btn" onclick="filterGoals('in-progress')" style="border-radius: 0; border-bottom: 2px solid transparent;">W realizacji (9)</button>
                    <button class="btn btn-secondary goal-filter-btn" onclick="filterGoals('completed')" style="border-radius: 0; border-bottom: 2px solid transparent;">Zakończone (3)</button>
                </div>

                <!-- Goals List -->
                <div class="goals-grid">
                    <!-- Liczbowe -->
                    <div class="goal-item" onclick="toggleGoalActions(this)" data-type="numeric" data-status="in-progress">
                        <div class="goal-header">
                            <div>
                                <div class="goal-title">Przychód Styczeń 2026</div>
                                <div class="goal-meta">Rozpoczęty: 1 października 2024 • Termin: 31 grudnia 2024</div>
                            </div>
                            <span class="goal-badge liczbowy">Liczbowy</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 78%"></div>
                        </div>
                        <div class="progress-label">234,500 PLN / 300,000 PLN (78%) • Pozostało: 65,500 PLN</div>
                        <div class="goal-actions">
                            <div class="goal-action-item">
                                <span class="goal-action-text">Skontaktuj się z potencjalnymi klientami z listy leadów</span>
                                <button class="goal-action-button" onclick="event.stopPropagation(); alert('Przekierowanie do leadów')">Zobacz leady</button>
                            </div>
                            <div class="goal-action-item">
                                <span class="goal-action-text">Zaplanuj wizyty u klientów Premium</span>
                                <button class="goal-action-button" onclick="event.stopPropagation(); alert('Dodawanie wizyt')">Dodaj wizyty</button>
                            </div>
                        </div>
                    </div>

                    <div class="goal-item" onclick="toggleGoalActions(this)" data-type="numeric" data-status="in-progress">
                        <div class="goal-header">
                            <div>
                                <div class="goal-title">Nowe rejestracje Styczeń 2026</div>
                                <div class="goal-meta">Rozpoczęty: 1 października 2024 • Termin: 31 grudnia 2024</div>
                            </div>
                            <span class="goal-badge liczbowy">Liczbowy</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 56%"></div>
                        </div>
                        <div class="progress-label">14 / 25 rejestracji (56%) • Pozostało: 11 rejestracji</div>
                        <div class="goal-actions">
                            <div class="goal-action-item">
                                <span class="goal-action-text">Zweryfikuj ruch na stronie i znajdź kontakty do rejestracji</span>
                                <button class="goal-action-button" onclick="event.stopPropagation(); alert('Przekierowanie do leadów')">Znajdź kontakty</button>
                            </div>
                            <div class="goal-action-item">
                                <span class="goal-action-text">Wyślij newsletter do nieaktywnych klientów</span>
                                <button class="goal-action-button" onclick="event.stopPropagation(); alert('Tworzenie newslettera')">Utwórz</button>
                            </div>
                        </div>
                    </div>

                    <div class="goal-item" onclick="toggleGoalActions(this)" data-type="numeric" data-status="in-progress">
                        <div class="goal-header">
                            <div>
                                <div class="goal-title">Wizyty u klientów Styczeń 2026</div>
                                <div class="goal-meta">Rozpoczęty: 1 października 2024 • Termin: 31 grudnia 2024</div>
                            </div>
                            <span class="goal-badge liczbowy">Liczbowy</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 45%"></div>
                        </div>
                        <div class="progress-label">27 / 60 wizyt (45%) • Pozostało: 33 wizyty</div>
                        <div class="goal-actions">
                            <div class="goal-action-item">
                                <span class="goal-action-text">Zaplanuj wizyty u klientów Premium</span>
                                <button class="goal-action-button" onclick="event.stopPropagation(); alert('Dodawanie wizyt')">Dodaj wizyty</button>
                            </div>
                        </div>
                    </div>

                    <div class="goal-item" onclick="toggleGoalActions(this)" data-type="numeric" data-status="in-progress">
                        <div class="goal-header">
                            <div>
                                <div class="goal-title">Przychód styczeń 2026</div>
                                <div class="goal-meta">Rozpoczęty: 1 stycznia 2026 • Termin: 31 stycznia 2026</div>
                            </div>
                            <span class="goal-badge liczbowy">Liczbowy</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 34%"></div>
                        </div>
                        <div class="progress-label">34,200 PLN / 100,000 PLN (34%) • Pozostało: 65,800 PLN</div>
                        <div class="goal-actions">
                            <div class="goal-action-item">
                                <span class="goal-action-text">Skontaktuj się z potencjalnymi klientami z listy leadów</span>
                                <button class="goal-action-button" onclick="event.stopPropagation(); alert('Przekierowanie do leadów')">Zobacz leady</button>
                            </div>
                            <div class="goal-action-item">
                                <span class="goal-action-text">Zaplanuj wizyty u klientów Premium</span>
                                <button class="goal-action-button" onclick="event.stopPropagation(); alert('Dodawanie wizyt')">Dodaj wizyty</button>
                            </div>
                        </div>
                    </div>

                    <!-- Jakościowe -->
                    <div class="goal-item" onclick="toggleGoalActions(this)" data-type="qualitative" data-status="completed">
                        <div class="goal-header">
                            <div>
                                <div class="goal-title">Retencja klientów Premium</div>
                                <div class="goal-meta">Cel ciągły • Monitorowany codziennie</div>
                            </div>
                            <span class="goal-badge jakosciowy">Jakościowy</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill complete" style="width: 92%"></div>
                        </div>
                        <div class="progress-label">92% retencja (cel: >85%) • +7% powyżej celu</div>
                        <div class="goal-actions">
                            <div class="goal-action-item">
                                <span class="goal-action-text">Skontaktuj się z klientami, którzy porzucili koszyki w ostatnich 7 dniach</span>
                                <button class="goal-action-button" onclick="event.stopPropagation(); alert('Przekierowanie do kontaktów')">Zobacz kontakty</button>
                            </div>
                        </div>
                    </div>

                    <div class="goal-item" onclick="toggleGoalActions(this)" data-type="qualitative" data-status="completed">
                        <div class="goal-header">
                            <div>
                                <div class="goal-title">Standardy pracy - Procedury ofertowania</div>
                                <div class="goal-meta">Cel ciągły • Ostatnia weryfikacja: 2 dni temu</div>
                            </div>
                            <span class="goal-badge jakosciowy">Jakościowy</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill complete" style="width: 100%"></div>
                        </div>
                        <div class="progress-label">100% zgodności (12/12 ofert zgodnych z procedurą)</div>
                        <div class="goal-actions">
                            <div class="goal-action-item">
                                <span class="goal-action-text">Przejrzyj i zaktualizuj procedury ofertowania</span>
                                <button class="goal-action-button" onclick="event.stopPropagation(); alert('Przekierowanie do procedur')">Zobacz procedury</button>
                            </div>
                        </div>
                    </div>

                    <div class="goal-item" onclick="toggleGoalActions(this)" data-type="qualitative" data-status="in-progress">
                        <div class="goal-header">
                            <div>
                                <div class="goal-title">Jakość prowadzenia CRM</div>
                                <div class="goal-meta">Cel ciągły • Ostatnia ocena: wczoraj</div>
                            </div>
                            <span class="goal-badge jakosciowy">Jakościowy</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 88%"></div>
                        </div>
                        <div class="progress-label">88% (notatki aktualne, kontakty udokumentowane)</div>
                        <div class="goal-actions">
                            <div class="goal-action-item">
                                <span class="goal-action-text">Zaktualizuj notatki i udokumentuj kontakty</span>
                                <button class="goal-action-button" onclick="event.stopPropagation(); alert('Przekierowanie do CRM')">Zaktualizuj CRM</button>
                            </div>
                        </div>
                    </div>

                    <div class="goal-item" onclick="toggleGoalActions(this)" data-type="qualitative" data-status="completed">
                        <div class="goal-header">
                            <div>
                                <div class="goal-title">Raportowanie - reakcja w 24h</div>
                                <div class="goal-meta">Cel ciągły • Monitorowany codziennie</div>
                            </div>
                            <span class="goal-badge jakosciowy">Jakościowy</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill complete" style="width: 95%"></div>
                        </div>
                        <div class="progress-label">95% zgłoszeń w terminie (19/20 w tym tygodniu)</div>
                        <div class="goal-actions">
                            <div class="goal-action-item">
                                <span class="goal-action-text">Przejrzyj raporty i zoptymalizuj procesy</span>
                                <button class="goal-action-button" onclick="event.stopPropagation(); alert('Przekierowanie do raportów')">Zobacz raporty</button>
                            </div>
                        </div>
                    </div>

                    <div class="goal-item" onclick="toggleGoalActions(this)" data-type="qualitative" data-status="completed">
                        <div class="goal-header">
                            <div>
                                <div class="goal-title">Przygotowanie wizyt - Checklista</div>
                                <div class="goal-meta">Cel ciągły • Ostatnia weryfikacja: dziś</div>
                            </div>
                            <span class="goal-badge jakosciowy">Jakościowy</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill complete" style="width: 100%"></div>
                        </div>
                        <div class="progress-label">100% wizyt z checklistą (27/27 wizyt w Q4)</div>
                        <div class="goal-actions">
                            <div class="goal-action-item">
                                <span class="goal-action-text">Przejrzyj i zaktualizuj checklistę wizyt</span>
                                <button class="goal-action-button" onclick="event.stopPropagation(); alert('Przekierowanie do checklisty')">Zobacz checklistę</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Customers Tab -->
        <div id="customers" class="tab-content">
            <div class="ecme-card">
                <div class="card-header">
                    <h3 class="card-title">Lista klientów</h3>
                    <div style="display: flex; gap: 1rem;">
                        <input type="text" class="form-input" placeholder="Szukaj klienta..." style="width: 300px;">
                        <select class="form-select" style="width: 200px;">
                            <option>Wszyscy klienci</option>
                            <option>Premium</option>
                            <option>Standard</option>
                            <option>Nieaktywni >30 dni</option>
                        </select>
                    </div>
                </div>

                <table class="customers-table">
                    <thead>
                        <tr>
                            <th>Klient</th>
                            <th>Tag</th>
                            <th>Ostatnia aktywność</th>
                            <th>LTV</th>
                            <th>Notatki</th>
                            <th>Cele</th>
                            <th>Akcje</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <div class="customer-name">Mateusz Wiktorowicz</div>
                                <div class="customer-company">Firma Budowlana Budowa</div>
                            </td>
                            <td><span class="tag">Premium</span></td>
                            <td>2 godz. temu</td>
                            <td>24,750 PLN</td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerNotes('Mateusz Wiktorowicz')">3 notatki</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerGoals('Mateusz Wiktorowicz')">2 cele</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerProfile('Mateusz Wiktorowicz')">Zobacz profil</button>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="customer-name">Anna Kowalska</div>
                                <div class="customer-company">Budowa Plus Sp. z o.o.</div>
                            </td>
                            <td><span class="tag">Premium</span></td>
                            <td>1 dzień temu</td>
                            <td>18,940 PLN</td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerNotes('Anna Kowalska')">5 notatek</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerGoals('Anna Kowalska')">1 cel</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerProfile('Anna Kowalska')">Zobacz profil</button>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="customer-name">Piotr Nowak</div>
                                <div class="customer-company">Auto-All Magazynowa</div>
                            </td>
                            <td><span class="tag" style="background: #fef3c7; color: #92400e;">Standard</span></td>
                            <td style="color: #ef4444;">35 dni temu</td>
                            <td>12,340 PLN</td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerNotes('Piotr Nowak')">2 notatki</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerGoals('Piotr Nowak')">3 cele</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerProfile('Piotr Nowak')">Zobacz profil</button>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="customer-name">Katarzyna Lewandowska</div>
                                <div class="customer-company">Elmas Pawlak S.J.</div>
                            </td>
                            <td><span class="tag" style="background: #fef3c7; color: #92400e;">Standard</span></td>
                            <td>5 godz. temu</td>
                            <td>8,920 PLN</td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerNotes('Katarzyna Lewandowska')">1 notatka</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerGoals('Katarzyna Lewandowska')">1 cel</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerProfile('Katarzyna Lewandowska')">Zobacz profil</button>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="customer-name">Tomasz Zieliński</div>
                                <div class="customer-company">Przykładowa Firma Budowlana Sp. z o.o.</div>
                            </td>
                            <td><span class="tag">Premium</span></td>
                            <td>3 dni temu</td>
                            <td>31,560 PLN</td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerNotes('Tomasz Zieliński')">4 notatki</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerGoals('Tomasz Zieliński')">2 cele</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerProfile('Tomasz Zieliński')">Zobacz profil</button>
                            </td>
                        </tr>
                        <!-- Dodatkowi klienci -->
                        <tr>
                            <td>
                                <div class="customer-name">Michał Krawczyk</div>
                                <div class="customer-company">Pizzeria Bella</div>
                            </td>
                            <td><span class="tag">Premium</span></td>
                            <td>2 godz. temu</td>
                            <td>15,230 PLN</td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerNotes('Michał Krawczyk')">2 notatki</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerGoals('Michał Krawczyk')">1 cel</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerProfile('Michał Krawczyk')">Zobacz profil</button>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="customer-name">Agnieszka Wójcik</div>
                                <div class="customer-company">Sushi Bar Tokyo</div>
                            </td>
                            <td><span class="tag" style="background: #fef3c7; color: #92400e;">Standard</span></td>
                            <td>1 dzień temu</td>
                            <td>9,450 PLN</td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerNotes('Agnieszka Wójcik')">3 notatki</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerGoals('Agnieszka Wójcik')">2 cele</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerProfile('Agnieszka Wójcik')">Zobacz profil</button>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="customer-name">Paweł Dąbrowski</div>
                                <div class="customer-company">Kawiarnia Retro</div>
                            </td>
                            <td><span class="tag" style="background: #fef3c7; color: #92400e;">Standard</span></td>
                            <td style="color: #ef4444;">42 dni temu</td>
                            <td>6,780 PLN</td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerNotes('Paweł Dąbrowski')">1 notatka</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerGoals('Paweł Dąbrowski')">1 cel</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerProfile('Paweł Dąbrowski')">Zobacz profil</button>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="customer-name">Magdalena Szymańska</div>
                                <div class="customer-company">Magazyn Centralny</div>
                            </td>
                            <td><span class="tag">Premium</span></td>
                            <td>4 godz. temu</td>
                            <td>28,900 PLN</td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerNotes('Magdalena Szymańska')">6 notatek</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerGoals('Magdalena Szymańska')">3 cele</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerProfile('Magdalena Szymańska')">Zobacz profil</button>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="customer-name">Robert Kozłowski</div>
                                <div class="customer-company">Bar Mleczny</div>
                            </td>
                            <td><span class="tag" style="background: #fef3c7; color: #92400e;">Standard</span></td>
                            <td>6 godz. temu</td>
                            <td>11,200 PLN</td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerNotes('Robert Kozłowski')">2 notatki</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerGoals('Robert Kozłowski')">1 cel</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerProfile('Robert Kozłowski')">Zobacz profil</button>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="customer-name">Ewa Nowakowska</div>
                                <div class="customer-company">Punkt Odbioru Południe</div>
                            </td>
                            <td><span class="tag">Premium</span></td>
                            <td>1 dzień temu</td>
                            <td>22,150 PLN</td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerNotes('Ewa Nowakowska')">4 notatki</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerGoals('Ewa Nowakowska')">2 cele</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerProfile('Ewa Nowakowska')">Zobacz profil</button>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="customer-name">Krzysztof Jankowski</div>
                                <div class="customer-company">Steakhouse Prime</div>
                            </td>
                            <td><span class="tag">Premium</span></td>
                            <td>3 dni temu</td>
                            <td>35,780 PLN</td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerNotes('Krzysztof Jankowski')">5 notatek</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerGoals('Krzysztof Jankowski')">3 cele</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerProfile('Krzysztof Jankowski')">Zobacz profil</button>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="customer-name">Joanna Wiśniewska</div>
                                <div class="customer-company">Food Truck Smaki</div>
                            </td>
                            <td><span class="tag" style="background: #fef3c7; color: #92400e;">Standard</span></td>
                            <td style="color: #ef4444;">28 dni temu</td>
                            <td>7,890 PLN</td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerNotes('Joanna Wiśniewska')">1 notatka</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerGoals('Joanna Wiśniewska')">1 cel</button>
                            </td>
                            <td>
                                <button class="btn btn-secondary" onclick="showCustomerProfile('Joanna Wiśniewska')">Zobacz profil</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Calendar Tab -->
        <div id="calendar" class="tab-content">
            <div class="ecme-card">
                <div class="calendar-header">
                    <h3 class="card-title">Styczeń 2026</h3>
                    <div class="calendar-nav">
                        <button class="btn btn-secondary">← Poprzedni</button>
                        <button class="btn btn-secondary">Dziś</button>
                        <button class="btn btn-secondary">Następny →</button>
                        <button class="btn btn-primary" onclick="showModal('eventModal')">+ Nowe zdarzenie</button>
                    </div>
                </div>

                <div class="calendar-grid">
                    <div class="calendar-day-header">Pon</div>
                    <div class="calendar-day-header">Wt</div>
                    <div class="calendar-day-header">Śr</div>
                    <div class="calendar-day-header">Czw</div>
                    <div class="calendar-day-header">Pt</div>
                    <div class="calendar-day-header">Sob</div>
                    <div class="calendar-day-header">Nie</div>

                    <div class="calendar-day other-month">
                        <div class="calendar-day-number">28</div>
                    </div>
                    <div class="calendar-day other-month">
                        <div class="calendar-day-number">29</div>
                    </div>
                    <div class="calendar-day other-month">
                        <div class="calendar-day-number">30</div>
                    </div>
                    <div class="calendar-day other-month">
                        <div class="calendar-day-number">31</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">1</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">2</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">3</div>
                    </div>

                    <div class="calendar-day">
                        <div class="calendar-day-number">4</div>
                        <div class="calendar-event">📞 10:00 Tel. Budowa Plus Sp. z o.o.</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">5</div>
                        <div class="calendar-event visit">🚗 10:00 Wizyta - R. Italiana</div>
                        <div class="calendar-event visit">🚗 14:30 Wizyta - Przykładowa Firma Budowlana Sp. z o.o.</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">6</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">7</div>
                        <div class="calendar-event">📞 15:00 Tel. Auto-All Magazynowa</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">8</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">9</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">10</div>
                    </div>

                    <div class="calendar-day">
                        <div class="calendar-day-number">11</div>
                        <div class="calendar-event">📧 Wysłać ofertę - Elmas Pawlak S.J.</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">12</div>
                        <div class="calendar-event visit">🚗 11:00 Wizyta - Budowa Plus Sp. z o.o.</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">13</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">14</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">15</div>
                        <div class="calendar-event">📞 09:00 Tel. follow-up R. Italiana</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">16</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">17</div>
                    </div>

                    <div class="calendar-day">
                        <div class="calendar-day-number">18</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">19</div>
                        <div class="calendar-event visit">🚗 10:00 Wizyta - Auto-All Magazynowa</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">20</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">21</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">22</div>
                        <div class="calendar-event">📞 14:00 Tel. Przykładowa Firma Budowlana Sp. z o.o.</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">23</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">24</div>
                    </div>

                    <div class="calendar-day">
                        <div class="calendar-day-number">25</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">26</div>
                        <div class="calendar-event visit">🚗 Trasa: 3 klientów</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">27</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">28</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">29</div>
                    </div>
                    <div class="calendar-day">
                        <div class="calendar-day-number">30</div>
                    </div>
                    <div class="calendar-day other-month">
                        <div class="calendar-day-number">1</div>
                    </div>
                </div>
            </div>

            <!-- Upcoming Events -->
            <div class="ecme-card">
                <div class="card-header">
                    <h3 class="card-title">Nadchodzące zdarzenia</h3>
                </div>
                <div class="activity-feed">
                    <div class="activity-item">
                        <div class="activity-icon">🚗</div>
                        <div class="activity-content">
                            <div class="activity-title">Wizyta u klienta - Firma Budowlana Budowa</div>
                            <div class="activity-meta">ul. Marszałkowska 45, Warszawa • Cel: Prezentacja nowych produktów cementowych CN</div>
                        </div>
                        <div class="activity-time">Dziś, 10:00</div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon">🚗</div>
                        <div class="activity-content">
                            <div class="activity-title">Wizyta u klienta - Przykładowa Firma Budowlana Sp. z o.o.</div>
                            <div class="activity-meta">Al. Jerozolimskie 123, Warszawa • Cel: Omówienie umowy rocznej</div>
                        </div>
                        <div class="activity-time">Dziś, 14:30</div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon">📞</div>
                        <div class="activity-content">
                            <div class="activity-title">Telefon - Auto-All Magazynowa</div>
                            <div class="activity-meta">Kontakt reaktywacyjny (brak aktywności 35 dni)</div>
                        </div>
                        <div class="activity-time">7 stycznia, 15:00</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Routes Tab -->
        <div id="routes" class="tab-content">
            <div class="ecme-card">
                <div class="card-header">
                    <h3 class="card-title">Planowanie trasy wizyt</h3>
                    <div style="display: flex; gap: 1rem;">
                        <button class="btn btn-secondary" onclick="showModal('visitModal')">+ Zaplanuj wizytę</button>
                        <button class="btn btn-primary" onclick="showModal('routeModal')">+ Zaplanuj trasę</button>
                    </div>
                </div>

                <!-- Calendar and Map Section -->
                <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 2rem; margin-bottom: 2rem;">
                    <!-- Calendar -->
                    <div>
                        <h4 style="margin-bottom: 1rem; color: #000;">Kalendarz wizyt</h4>
                        <div id="visit-calendar" style="background: white; border: 1px solid #ccc; border-radius: 8px; padding: 1rem;">
                            <!-- Calendar will be loaded here -->
                        </div>
                    </div>
                    
                    <!-- Map -->
                    <div>
                        <h4 style="margin-bottom: 1rem; color: #000;">Mapa trasy</h4>
                        <div id="route-map" style="height: 300px; border-radius: 8px; border: 1px solid #ccc;"></div>
                    </div>
                </div>

                <!-- Route Details -->
                <div class="route-list">
                    <h4 style="font-weight: 600; margin-bottom: 1rem;">Trasa na 5 stycznia 2026</h4>
                    
                    <div class="route-item">
                        <div class="route-number">1</div>
                        <div class="route-info">
                            <div class="route-customer">Firma Budowlana Budowa</div>
                            <div class="route-address">ul. Marszałkowska 45, 00-001 Warszawa</div>
                        </div>
                        <div class="route-time">
                            <div>10:00 - 11:00</div>
                            <div style="color: #9ca3af;">15 min. jazdy</div>
                        </div>
                    </div>

                    <div class="route-item">
                        <div class="route-number">2</div>
                        <div class="route-info">
                            <div class="route-customer">Elmas Pawlak S.J.</div>
                            <div class="route-address">ul. Nowy Świat 28, 00-373 Warszawa</div>
                        </div>
                        <div class="route-time">
                            <div>11:30 - 12:15</div>
                            <div style="color: #9ca3af;">8 min. jazdy</div>
                        </div>
                    </div>

                    <div class="route-item">
                        <div class="route-number">3</div>
                        <div class="route-info">
                            <div class="route-customer">Przykładowa Firma Budowlana Sp. z o.o.</div>
                            <div class="route-address">Al. Jerozolimskie 123, 02-017 Warszawa</div>
                        </div>
                        <div class="route-time">
                            <div>14:30 - 15:30</div>
                            <div style="color: #9ca3af;">22 min. jazdy</div>
                        </div>
                    </div>
                </div>

                <div style="margin-top: 1rem; padding: 1rem; background: #fff; border-radius: 6px; border: 1px solid #ccc;">
                    <div style="font-weight: 500; margin-bottom: 0.5rem;">📊 Podsumowanie trasy</div>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;">
                        <div>
                            <div style="font-size: 0.813rem; color: #666;">Łączny dystans</div>
                            <div style="font-weight: 600;">45 km</div>
                        </div>
                        <div>
                            <div style="font-size: 0.813rem; color: #666;">Czas jazdy</div>
                            <div style="font-weight: 600;">45 min.</div>
                        </div>
                        <div>
                            <div style="font-size: 0.813rem; color: #666;">Liczba wizyt</div>
                            <div style="font-weight: 600;">3 klientów</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings" class="tab-content">
            <!-- Scoring Configuration Section -->
            <div class="ecme-card" style="margin-bottom: 2rem;">
                <div class="card-header">
                    <h3 class="card-title">Konfiguracja scoringu za zachowania</h3>
                    <button class="btn btn-secondary" onclick="showScoringConfigModal()">
                        <i class='bx bx-cog'></i> Konfiguruj scoring
                    </button>
                </div>

                <div class="scoring-config-grid">
                    <div class="scoring-category">
                        <h4>Odwiedzona strona</h4>
                        <div class="scoring-items">
                            <div class="scoring-item">
                                <span>Strona główna</span>
                                <input type="number" class="form-input scoring-points" value="1" min="0">
                            </div>
                            <div class="scoring-item">
                                <span>Strona produktu</span>
                                <input type="number" class="form-input scoring-points" value="3" min="0">
                            </div>
                            <div class="scoring-item">
                                <span>Logowanie/rejestracji</span>
                                <input type="number" class="form-input scoring-points" value="7" min="0">
                            </div>
                            <div class="scoring-item">
                                <span>Strona kategorii</span>
                                <input type="number" class="form-input scoring-points" value="2" min="0">
                            </div>
                            <div class="scoring-item">
                                <span>Strona koszyka</span>
                                <input type="number" class="form-input scoring-points" value="5" min="0">
                            </div>
                            <div class="scoring-item">
                                <span>Strony na koncie klienta</span>
                                <input type="number" class="form-input scoring-points" value="6" min="0">
                            </div>
                        </div>
                    </div>

                    <div class="scoring-category">
                        <h4>Akcje użytkownika</h4>
                        <div class="scoring-items">
                            <div class="scoring-item">
                                <span>Dodanie do koszyka</span>
                                <input type="number" class="form-input scoring-points" value="4" min="0">
                            </div>
                            <div class="scoring-item">
                                <span>Wyszukanie produktu</span>
                                <input type="number" class="form-input scoring-points" value="8" min="0">
                            </div>
                            <div class="scoring-item">
                                <span>Finalizacja zamówienia</span>
                                <input type="number" class="form-input scoring-points" value="15" min="0">
                            </div>
                            <div class="scoring-item">
                                <span>Dodanie do ulubionych</span>
                                <input type="number" class="form-input scoring-points" value="3" min="0">
                            </div>
                            <div class="scoring-item">
                                <span>Udostępnienie produktu</span>
                                <input type="number" class="form-input scoring-points" value="5" min="0">
                            </div>
                            <div class="scoring-item">
                                <span>Kontakt z obsługą</span>
                                <input type="number" class="form-input scoring-points" value="10" min="0">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="scoring-actions">
                    <button class="btn btn-primary" onclick="saveScoringConfig()">
                        <i class='bx bx-save'></i> Zapisz konfigurację
                    </button>
                    <button class="btn btn-outline" onclick="resetScoringConfig()">
                        <i class='bx bx-reset'></i> Resetuj do domyślnych
                    </button>
                </div>
            </div>

            <!-- Business Rules Section -->
            <div class="ecme-card" style="margin-bottom: 2rem;">
                <div class="card-header">
                    <h3 class="card-title">Reguły biznesowe</h3>
                    <button class="btn btn-primary" onclick="showAddRuleModal()">
                        <i class='bx bx-plus'></i> Dodaj nową regułę
                    </button>
                </div>

                <div class="business-rules-list">
                    <!-- Rule 1: Porzucony koszyk - scoring -->
                    <div class="rule-item">
                        <div class="rule-header">
                            <div class="rule-info">
                                <h4>Porzucony koszyk - wysoki scoring</h4>
                                <p class="rule-description">Wykrywa klientów z wysokim scoringiem za dodawanie do koszyka, ale bez finalizacji zamówienia</p>
                            </div>
                            <div class="rule-controls">
                                <label class="toggle-switch">
                                    <input type="checkbox" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                                <button class="btn btn-secondary" onclick="editRule(1)">Edytuj</button>
                            </div>
                        </div>
                        <div class="rule-details">
                            <div class="rule-triggers">
                                <strong>Triggery (AND):</strong>
                                <ul>
                                    <li>Dodanie do koszyka: 4+ punkty w ciągu 7 dni</li>
                                    <li>Finalizacja zamówienia: 0 punktów w ciągu 7 dni</li>
                                </ul>
                            </div>
                            <div class="rule-actions">
                                <strong>Akcje (OR):</strong>
                                <ul>
                                    <li>Wyślij email z kodem rabatowym 10% (wykonaj w ciągu 30 min)</li>
                                    <li>Utwórz zadanie dla handlowca: "Kontakt z klientem - porzucony koszyk"</li>
                                </ul>
                            </div>
                            <div class="rule-parameters">
                                <strong>Harmonogram:</strong>
                                <span>Poniedziałek-Piątek, 09:00 | Scheduler: Codziennie</span>
                            </div>
                        </div>
                    </div>

                    <!-- Rule 2: Spadek zaangażowania -->
                    <div class="rule-item">
                        <div class="rule-header">
                            <div class="rule-info">
                                <h4>Spadek zaangażowania w czasie rzeczywistym</h4>
                                <p class="rule-description">Monitoruje nagły spadek aktywności klienta i sugeruje działania prewencyjne</p>
                            </div>
                            <div class="rule-controls">
                                <label class="toggle-switch">
                                    <input type="checkbox" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                                <button class="btn btn-secondary" onclick="editRule(2)">Edytuj</button>
                            </div>
                        </div>
                        <div class="rule-details">
                            <div class="rule-triggers">
                                <strong>Triggery:</strong>
                                <ul>
                                    <li>Klient aktywny ostatnie 7 dni nagle nie logował się 48h</li>
                                    <li>Lub: otwarł 3+ produkty ale nie dodał do koszyka</li>
                                </ul>
                            </div>
                            <div class="rule-actions">
                                <strong>Akcje:</strong>
                                <ul>
                                    <li>Alert do opiekuna z sugestią kontaktu</li>
                                    <li>AI sugeruje tematykę rozmowy na bazie przeglądanych produktów</li>
                                </ul>
                            </div>
                            <div class="rule-parameters">
                                <strong>Parametry:</strong>
                                <span>Próg aktywności: 3+ sesje/tydzień | Czas reakcji: 48h</span>
                            </div>
                        </div>
                    </div>

                    <!-- Rule 3: Analiza zachowania konkurencyjnego -->
                    <div class="rule-item">
                        <div class="rule-header">
                            <div class="rule-info">
                                <h4>Analiza zachowania konkurencyjnego</h4>
                                <p class="rule-description">Wykrywa klientów porównujących ceny i sugeruje strategie cenowe</p>
                            </div>
                            <div class="rule-controls">
                                <label class="toggle-switch">
                                    <input type="checkbox" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                                <button class="btn btn-secondary" onclick="editRule(3)">Edytuj</button>
                            </div>
                        </div>
                        <div class="rule-details">
                            <div class="rule-triggers">
                                <strong>Triggery:</strong>
                                <ul>
                                    <li>Klient przegląda produkt >3 razy dziennie bez zakupu</li>
                                </ul>
                            </div>
                            <div class="rule-actions">
                                <strong>Akcje:</strong>
                                <ul>
                                    <li>Powiadomienie handlowca z insightem</li>
                                    <li>Historia oglądanych produktów i ich ceny</li>
                                    <li>Średni czas decyzji podobnych klientów</li>
                                    <li>Sugerowany próg rabatu (price history i AI recommendation)</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Rule 3: Cross-sell/Up-sell -->
                    <div class="rule-item">
                        <div class="rule-header">
                            <div class="rule-info">
                                <h4>Szansa Cross-sell/Up-sell</h4>
                                <p class="rule-description">Wykorzystuje AI do wykrywania wzorców zakupowych i proponowania dodatkowych produktów</p>
                            </div>
                            <div class="rule-controls">
                                <label class="toggle-switch">
                                    <input type="checkbox" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                                <button class="btn btn-secondary" onclick="editRule(4)">Edytuj</button>
                            </div>
                        </div>
                        <div class="rule-details">
                            <div class="rule-triggers">
                                <strong>Triggery:</strong>
                                <ul>
                                    <li>Klient kupił produkt kategorii X</li>
                                    <li>AI wykryło pattern zakupowy (np. zawsze dokupuje Y w ciągu 14 dni)</li>
                                </ul>
                            </div>
                            <div class="rule-actions">
                                <strong>Akcje:</strong>
                                <ul>
                                    <li>Zadanie dla handlowca: "Zaproponuj produkt Y"</li>
                                    <li>Auto-email z rekomendacją (opcjonalnie)</li>
                                </ul>
                            </div>
                            <div class="rule-parameters">
                                <strong>Dane:</strong>
                                <span>Machine learning na historii wszystkich klientów</span>
                            </div>
                        </div>
                    </div>

                    <!-- Rule 5: Ryzyko utraty klienta -->
                    <div class="rule-item">
                        <div class="rule-header">
                            <div class="rule-info">
                                <h4>Ryzyko utraty klienta</h4>
                                <p class="rule-description">Identyfikuje klientów zagrożonych odejściem i uruchamia działania retencyjne</p>
                            </div>
                            <div class="rule-controls">
                                <label class="toggle-switch">
                                    <input type="checkbox" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                                <button class="btn btn-secondary" onclick="editRule(5)">Edytuj</button>
                            </div>
                        </div>
                        <div class="rule-details">
                            <div class="rule-triggers">
                                <strong>Triggery (jeden z):</strong>
                                <ul>
                                    <li>Wartość zamówień spadła >40% vs poprzedni kwartał</li>
                                    <li>Częstotliwość logowań spadła >60%</li>
                                </ul>
                            </div>
                            <div class="rule-actions">
                                <strong>Akcje:</strong>
                                <ul>
                                    <li>Czerwony alert dla handlowca</li>
                                    <li>Auto-generowanie propozycji retencyjnej</li>
                                    <li>Szybki prewencyjny telefon do klienta</li>
                                </ul>
                            </div>
                            <div class="rule-parameters">
                                <strong>Metryka:</strong>
                                <span>CLV i Retention Rate vs segment klientów z tym samym tagiem</span>
                            </div>
                        </div>
                    </div>

                    <!-- Rule 6: Przekroczenie limitu kredytowego -->
                    <div class="rule-item">
                        <div class="rule-header">
                            <div class="rule-info">
                                <h4>Przekroczenie limitu kredytowego</h4>
                                <p class="rule-description">Monitoruje wykorzystanie limitu kredytowego i uruchamia wielopoziomowe akcje</p>
                            </div>
                            <div class="rule-controls">
                                <label class="toggle-switch">
                                    <input type="checkbox" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                                <button class="btn btn-secondary" onclick="editRule(6)">Edytuj</button>
                            </div>
                        </div>
                        <div class="rule-details">
                            <div class="rule-triggers">
                                <strong>Triggery:</strong>
                                <ul>
                                    <li>Koszyk + nieopłacone faktury > 90% limitu</li>
                                </ul>
                            </div>
                            <div class="rule-actions">
                                <strong>Akcje wielopoziomowe:</strong>
                                <ul>
                                    <li><strong>90%:</strong> Info dla handlowca</li>
                                    <li><strong>95%:</strong> Alert do handlowca o potrzebie interwencji</li>
                                    <li><strong>100%:</strong> Auto-email do klienta + handlowca i dział finansowy</li>
                                </ul>
                            </div>
                            <div class="rule-parameters">
                                <strong>Integracja:</strong>
                                <span>ERP (faktury) + Platforma</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Original Settings -->
            <div class="ecme-card">
                <div class="card-header">
                    <h3 class="card-title">Ustawienia powiadomień</h3>
                </div>

                <div class="form-group">
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: #fff; border-radius: 6px; margin-bottom: 0.75rem;">
                        <div>
                            <div style="font-weight: 500;">Brak aktywności klienta</div>
                            <div style="font-size: 0.813rem; color: #666;">Powiadom, gdy klient nie ma aktywności przez określony czas</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div style="display: flex; gap: 1rem; padding-left: 1rem;">
                        <div class="form-group" style="flex: 1;">
                            <label class="form-label">Czas bez aktywności (dni)</label>
                            <input type="number" class="form-input" value="30">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: #fff; border-radius: 6px; margin-bottom: 0.75rem;">
                        <div>
                            <div style="font-weight: 500;">Porzucony koszyk</div>
                            <div style="font-size: 0.813rem; color: #666;">Powiadom, gdy koszyk o wysokiej wartości zostanie porzucony</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div style="display: flex; gap: 1rem; padding-left: 1rem;">
                        <div class="form-group" style="flex: 1;">
                            <label class="form-label">Minimalna wartość koszyka (PLN)</label>
                            <input type="number" class="form-input" value="500">
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label class="form-label">Czas od porzucenia (godziny)</label>
                            <input type="number" class="form-input" value="24">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: #fff; border-radius: 6px; margin-bottom: 0.75rem;">
                        <div>
                            <div style="font-weight: 500;">Niskie zaangażowanie klienta Premium</div>
                            <div style="font-size: 0.813rem; color: #666;">Powiadom, gdy klient Premium zmniejsza częstotliwość zakupów</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div style="display: flex; gap: 1rem; padding-left: 1rem;">
                        <div class="form-group" style="flex: 1;">
                            <label class="form-label">Spadek częstotliwości (%)</label>
                            <input type="number" class="form-input" value="30">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: #fff; border-radius: 6px; margin-bottom: 0.75rem;">
                        <div>
                            <div style="font-weight: 500;">Przypomnienie o wizycie</div>
                            <div style="font-size: 0.813rem; color: #666;">Przypominaj o nadchodzącej wizycie u klienta</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div style="display: flex; gap: 1rem; padding-left: 1rem;">
                        <div class="form-group" style="flex: 1;">
                            <label class="form-label">Przypominaj przed (godziny)</label>
                            <input type="number" class="form-input" value="1">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: #fff; border-radius: 6px;">
                        <div>
                            <div style="font-weight: 500;">Raport tygodniowy</div>
                            <div style="font-size: 0.813rem; color: #666;">Otrzymuj podsumowanie tygodniowej aktywności</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid #ccc;">
                    <button class="btn btn-primary">Zapisz ustawienia</button>
                </div>
            </div>

            <div class="ecme-card">
                <div class="card-header">
                    <h3 class="card-title">Preferencje wyświetlania</h3>
                </div>

                <div class="form-group">
                    <label class="form-label">Domyślny widok startowy</label>
                    <select class="form-select">
                        <option>Dashboard</option>
                        <option>Cele handlowe</option>
                        <option>Klienci</option>
                        <option>Kalendarz</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Liczba rekordów na stronę</label>
                    <select class="form-select">
                        <option>10</option>
                        <option>25</option>
                        <option selected>50</option>
                        <option>100</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Format daty</label>
                    <select class="form-select">
                        <option selected>DD.MM.YYYY</option>
                        <option>YYYY-MM-DD</option>
                        <option>MM/DD/YYYY</option>
                    </select>
                </div>

                <div style="margin-top: 2rem;">
                    <button class="btn btn-primary">Zapisz preferencje</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Add (Zadanie/Wizyta/Cel) -->
    <div id="addModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Dodaj nową akcję</h3>
                <button class="modal-close" onclick="hideModal('addModal')">×</button>
            </div>

            <!-- Action Type Selector -->
            <div id="actionTypeSelector" class="action-type-selector">
                <div class="action-type-option" onclick="selectActionType('task')">
                    <div class="action-type-icon"><i class='bx bx-check'></i></div>
                    <div class="action-type-label">Zadanie</div>
                </div>
                <div class="action-type-option" onclick="selectActionType('visit')">
                    <div class="action-type-icon"><i class='bx bx-car'></i></div>
                    <div class="action-type-label">Wizyta</div>
                </div>
                <div class="action-type-option" onclick="selectActionType('goal')">
                    <div class="action-type-icon"><i class='bx bx-target-lock'></i></div>
                    <div class="action-type-label">Cel</div>
                </div>
                <div class="action-type-option" onclick="selectActionType('note')">
                    <div class="action-type-icon"><i class='bx bx-edit'></i></div>
                    <div class="action-type-label">Notatka</div>
                </div>
                <div class="action-type-option" onclick="selectActionType('call')">
                    <div class="action-type-icon"><i class='bx bx-phone-call'></i></div>
                    <div class="action-type-label">Rozmowa</div>
                </div>
                <div class="action-type-option" onclick="selectActionType('email')">
                    <div class="action-type-icon"><i class='bx bx-envelope'></i></div>
                    <div class="action-type-label">Email</div>
                </div>
            </div>

            <!-- Task Form -->
            <div id="taskForm" style="display: none;">
                <div class="form-group">
                    <label class="form-label">Tytuł zadania</label>
                    <input type="text" class="form-input" placeholder="Np. Kontakt z klientem">
                </div>
                <div class="form-group">
                    <label class="form-label">Opis</label>
                    <textarea class="form-textarea" placeholder="Szczegóły zadania"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Klient</label>
                    <select class="form-select">
                        <option>Wybierz klienta</option>
                        <option>Firma Budowlana Budowa</option>
                        <option>Budowa Plus Sp. z o.o.</option>
                        <option>Auto-All Magazynowa</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Termin</label>
                    <input type="date" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">Priorytet</label>
                    <select class="form-select">
                        <option>Wysoki</option>
                        <option>Średni</option>
                        <option>Niski</option>
                    </select>
                </div>
            </div>

            <!-- Visit Form -->
            <div id="visitForm" style="display: none;">
                <div class="form-group">
                    <label class="form-label">Klient</label>
                    <select class="form-select">
                        <option>Wybierz klienta</option>
                        <option>Firma Budowlana Budowa</option>
                        <option>Budowa Plus Sp. z o.o.</option>
                        <option>Auto-All Magazynowa</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Data wizyty</label>
                    <input type="date" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">Godzina</label>
                    <input type="time" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">Cel wizyty</label>
                    <textarea class="form-textarea" placeholder="Np. Omówienie zamówienia cementu, prezentacja produktów"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Adres</label>
                    <input type="text" class="form-input" placeholder="ul. Marszałkowska 15, Warszawa">
                </div>
            </div>

            <!-- Goal Form -->
            <div id="goalForm" style="display: none;">
                <div class="form-group">
                    <label class="form-label">Nazwa celu</label>
                    <input type="text" class="form-input" placeholder="Np. Przychód Q1 2025">
                </div>
                <div class="form-group">
                    <label class="form-label">Typ celu</label>
                    <select class="form-select">
                        <option>Liczbowy</option>
                        <option>Jakościowy</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Wartość docelowa</label>
                    <input type="number" class="form-input" placeholder="Np. 300000">
                </div>
                <div class="form-group">
                    <label class="form-label">Jednostka</label>
                    <input type="text" class="form-input" placeholder="Np. PLN, sztuki, %">
                </div>
                <div class="form-group">
                    <label class="form-label">Termin realizacji</label>
                    <input type="date" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">Opis</label>
                    <textarea class="form-textarea" placeholder="Szczegóły celu"></textarea>
                </div>
            </div>

            <!-- Note Form -->
            <div id="noteForm" style="display: none;">
                <div class="form-group">
                    <label class="form-label">Klient</label>
                    <select class="form-select">
                        <option>Wybierz klienta</option>
                        <option>Firma Budowlana Budowa</option>
                        <option>Budowa Plus Sp. z o.o.</option>
                        <option>Auto-All Magazynowa</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Typ notatki</label>
                    <select class="form-select">
                        <option>Rozmowa telefoniczna</option>
                        <option>Wizyta</option>
                        <option>Email</option>
                        <option>Inne</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Treść notatki</label>
                    <textarea class="form-textarea" placeholder="Wpisz treść notatki"></textarea>
                </div>
            </div>

            <!-- Call Form -->
            <div id="callForm" style="display: none;">
                <div class="form-group">
                    <label class="form-label">Klient</label>
                    <select class="form-select">
                        <option>Wybierz klienta</option>
                        <option>Firma Budowlana Budowa</option>
                        <option>Budowa Plus Sp. z o.o.</option>
                        <option>Auto-All Magazynowa</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Data rozmowy</label>
                    <input type="date" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">Godzina</label>
                    <input type="time" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">Cel rozmowy</label>
                    <textarea class="form-textarea" placeholder="Np. Follow-up, prezentacja oferty"></textarea>
                </div>
            </div>

            <!-- Email Form -->
            <div id="emailForm" style="display: none;">
                <div class="form-group">
                    <label class="form-label">Klient</label>
                    <select class="form-select">
                        <option>Wybierz klienta</option>
                        <option>Firma Budowlana Budowa</option>
                        <option>Budowa Plus Sp. z o.o.</option>
                        <option>Auto-All Magazynowa</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Temat</label>
                    <input type="text" class="form-input" placeholder="Temat wiadomości">
                </div>
                <div class="form-group">
                    <label class="form-label">Treść</label>
                    <textarea class="form-textarea" placeholder="Treść wiadomości email"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Data wysłania</label>
                    <input type="date" class="form-input">
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal('addModal')">Anuluj</button>
                <button class="btn btn-primary" onclick="saveAction()">Zapisz</button>
            </div>
        </div>
    </div>

    <!-- Goal Modal -->
    <div id="goalModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Dodaj nowy cel handlowy</h3>
                <button class="modal-close" onclick="hideModal('goalModal')">&times;</button>
            </div>

            <form>
                <div class="form-group">
                    <label class="form-label">Nazwa celu</label>
                    <input type="text" class="form-input" placeholder="np. Przychód Styczeń 2026">
                </div>

                <div class="form-group">
                    <label class="form-label">Typ celu</label>
                    <select class="form-select">
                        <option>Liczbowy</option>
                        <option>Jakościowy</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Kategoria</label>
                    <select class="form-select">
                        <option>Przychody/Sprzedaż</option>
                        <option>Rejestracje</option>
                        <option>Wizyty u klientów</option>
                        <option>Retencja klientów</option>
                        <option>Standardy pracy</option>
                        <option>Jakość CRM</option>
                        <option>Raportowanie</option>
                        <option>Inne</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Wartość docelowa</label>
                    <input type="text" class="form-input" placeholder="np. 300000 PLN lub 25 rejestracji">
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label class="form-label">Data rozpoczęcia</label>
                        <input type="date" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Termin realizacji</label>
                        <input type="date" class="form-input">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Opis</label>
                    <textarea class="form-textarea" placeholder="Opcjonalny opis celu..."></textarea>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="hideModal('goalModal')">Anuluj</button>
                    <button type="submit" class="btn btn-primary">Dodaj cel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Note Modal -->
    <div id="noteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Dodaj notatkę</h3>
                <button class="modal-close" onclick="hideModal('noteModal')">&times;</button>
            </div>
            <div class="form-group">
                <label class="form-label">Klient</label>
                <input type="text" id="noteClient" class="form-input" readonly>
            </div>
            <div class="form-group">
                <label class="form-label">Typ notatki</label>
                <select class="form-select">
                    <option>Rozmowa telefoniczna</option>
                    <option>Wizyta</option>
                    <option>Email</option>
                    <option>Inne</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Treść notatki</label>
                <textarea class="form-textarea" placeholder="Wpisz treść notatki"></textarea>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal('noteModal')">Anuluj</button>
                <button class="btn btn-primary" onclick="saveNote()">Zapisz</button>
            </div>
        </div>
    </div>

    <!-- Task Modal -->
    <div id="taskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Dodaj zadanie</h3>
                <button class="modal-close" onclick="hideModal('taskModal')">&times;</button>
            </div>
            <div class="form-group">
                <label class="form-label">Klient</label>
                <input type="text" id="taskClient" class="form-input" readonly>
            </div>
            <div class="form-group">
                <label class="form-label">Tytuł zadania</label>
                <input type="text" class="form-input" placeholder="Np. Kontakt z klientem">
            </div>
            <div class="form-group">
                <label class="form-label">Opis</label>
                <textarea class="form-textarea" placeholder="Szczegóły zadania"></textarea>
            </div>
            <div class="form-group">
                <label class="form-label">Termin</label>
                <input type="date" class="form-input">
            </div>
            <div class="form-group">
                <label class="form-label">Priorytet</label>
                <select class="form-select">
                    <option>Wysoki</option>
                    <option>Średni</option>
                    <option>Niski</option>
                </select>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal('taskModal')">Anuluj</button>
                <button class="btn btn-primary" onclick="saveTask()">Zapisz</button>
            </div>
        </div>
    </div>

    <!-- Note Modal (Original) -->
    <div id="noteModalOriginal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Notatki - Firma Budowlana Budowa</h3>
                <button class="modal-close" onclick="hideModal('noteModalOriginal')">&times;</button>
            </div>

            <div style="max-height: 400px; overflow-y: auto; margin-bottom: 1.5rem;">
                <div class="note-item">
                    <div class="note-header">
                        <span class="note-type">📝 Notatka ogólna</span>
                        <span class="note-date">2 stycznia 2026</span>
                    </div>
                    <div class="note-content">
                        Klient zainteresowany nowymi pojemnikami CN 1/3. Poproszono o przygotowanie oferty cenowej dla zamówienia >500 szt. Termin: do 10 listopada.
                    </div>
                </div>

                <div class="note-item">
                    <div class="note-header">
                        <span class="note-type">🚗 Po wizycie</span>
                        <span class="note-date">28 stycznia 2026</span>
                    </div>
                    <div class="note-content">
                        Wizyta przebiegła pomyślnie. Omówiono współpracę na 2025 rok. Klient planuje rozbudowę lokalu - potencjalne zwiększenie zamówień o 30%.
                    </div>
                </div>

                <div class="note-item">
                    <div class="note-header">
                        <span class="note-type">🛒 Po zamówieniu</span>
                        <span class="note-date">15 października 2024</span>
                    </div>
                    <div class="note-content">
                        Zamówienie #8911 zrealizowane terminowo. Klient bardzo zadowolony z szybkości dostawy. Zapytał o możliwość wydłużenia terminu płatności do 21 dni.
                    </div>
                </div>
            </div>

            <form>
                <div class="form-group">
                    <label class="form-label">Typ notatki</label>
                    <select class="form-select">
                        <option>Notatka ogólna</option>
                        <option>Po rejestracji</option>
                        <option>Po zamówieniu</option>
                        <option>Po reklamacji</option>
                        <option>Po zapytaniu</option>
                        <option>Po wizycie</option>
                        <option>Przy odwiedzonym produkcie</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Treść notatki</label>
                    <textarea class="form-textarea" placeholder="Wpisz treść notatki..."></textarea>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="hideModal('noteModal')">Anuluj</button>
                    <button type="submit" class="btn btn-primary">Dodaj notatkę</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Customer Goal Modal -->
    <div id="customerGoalModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Cele przy kliencie - Firma Budowlana Budowa</h3>
                <button class="modal-close" onclick="hideModal('customerGoalModal')">&times;</button>
            </div>

            <div style="margin-bottom: 1.5rem;">
                <div class="goal-item">
                    <div class="goal-header">
                        <div>
                            <div class="goal-title">Wizyta u klienta</div>
                            <div class="goal-meta">Zaplanowano: 5 stycznia 2026, 10:00</div>
                        </div>
                        <span class="goal-badge liczbowy" style="background: #dcfce7; color: #166534;">Zaplanowane</span>
                    </div>
                    <div style="font-size: 0.875rem; color: #666; margin-top: 0.5rem;">
                        Cel: Prezentacja nowych produktów cementowych CN i omówienie oferty na Q1 2025
                    </div>
                </div>

                <div class="goal-item">
                    <div class="goal-header">
                        <div>
                            <div class="goal-title">Przygotowanie oferty</div>
                            <div class="goal-meta">Termin: 10 stycznia 2026</div>
                        </div>
                        <span class="goal-badge liczbowy" style="background: #fef3c7; color: #92400e;">W trakcie</span>
                    </div>
                    <div style="font-size: 0.875rem; color: #666; margin-top: 0.5rem;">
                        Oferta cenowa dla zamówienia pojemników CN 1/3 >500 szt.
                    </div>
                </div>
            </div>

            <form>
                <div class="form-group">
                    <label class="form-label">Typ celu</label>
                    <select class="form-select">
                        <option>Wizyta u klienta</option>
                        <option>Kontakt telefoniczny</option>
                        <option>Przygotowanie oferty</option>
                        <option>Wysłanie maila</option>
                        <option>Własny cel</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Termin realizacji</label>
                    <input type="datetime-local" class="form-input">
                </div>

                <div class="form-group">
                    <label class="form-label">Opis celu</label>
                    <textarea class="form-textarea" placeholder="Opcjonalny opis..."></textarea>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="hideModal('customerGoalModal')">Anuluj</button>
                    <button type="submit" class="btn btn-primary">Dodaj cel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Event Modal -->
    <div id="eventModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Dodaj nowe zdarzenie</h3>
                <button class="modal-close" onclick="hideModal('eventModal')">&times;</button>
            </div>

            <form>
                <div class="form-group">
                    <label class="form-label">Typ zdarzenia</label>
                    <select class="form-select">
                        <option>Wizyta u klienta</option>
                        <option>Rozmowa telefoniczna</option>
                        <option>Wysłanie oferty</option>
                        <option>Spotkanie</option>
                        <option>Inne</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Klient</label>
                    <select class="form-select">
                        <option>Firma Budowlana Budowa</option>
                        <option>Budowa Plus Sp. z o.o.</option>
                        <option>Auto-All Magazynowa</option>
                        <option>Elmas Pawlak S.J.</option>
                        <option>Przykładowa Firma Budowlana Sp. z o.o.</option>
                    </select>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label class="form-label">Data</label>
                        <input type="date" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Godzina</label>
                        <input type="time" class="form-input">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Opis/Cel</label>
                    <textarea class="form-textarea" placeholder="Cel wizyty, tematy do omówienia..."></textarea>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="hideModal('eventModal')">Anuluj</button>
                    <button type="submit" class="btn btn-primary">Dodaj zdarzenie</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Route Modal -->
    <div id="routeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Zaplanuj trasę wizyt</h3>
                <button class="modal-close" onclick="hideModal('routeModal')">&times;</button>
            </div>

            <form>
                <div class="form-group">
                    <label class="form-label">Data trasy</label>
                    <input type="date" class="form-input">
                </div>

                <div class="form-group">
                    <label class="form-label">Wybierz klientów do odwiedzenia</label>
                    <div style="display: flex; flex-direction: column; gap: 0.5rem; max-height: 200px; overflow-y: auto; padding: 0.5rem; background: #fff; border-radius: 6px;">
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox"> Firma Budowlana Budowa (ul. Marszałkowska 45)
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox"> Budowa Plus Sp. z o.o. (ul. Nowy Świat 67)
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox"> Auto-All Magazynowa (ul. Puławska 234)
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox"> Elmas Pawlak S.J. (ul. Nowy Świat 28)
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox"> Przykładowa Firma Budowlana Sp. z o.o. (Al. Jerozolimskie 123)
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Godzina rozpoczęcia</label>
                    <input type="time" class="form-input" value="09:00">
                </div>

                <div class="form-group">
                    <label class="form-label">Średni czas wizyty (minuty)</label>
                    <input type="number" class="form-input" value="45">
                </div>

                <div class="alert alert-info" style="margin-top: 1rem;">
                    <div class="alert-icon">ℹ️</div>
                    <div style="font-size: 0.813rem;">System automatycznie zoptymalizuje trasę, aby zminimalizować czas jazdy między klientami</div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="hideModal('routeModal')">Anuluj</button>
                    <button type="submit" class="btn btn-primary">Generuj trasę</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Customer Notes Modal -->
    <div id="customerNotesModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3>Notatki - <span id="customerNotesName"></span></h3>
                <button class="modal-close" onclick="hideModal('customerNotesModal')">×</button>
            </div>
            <div class="modal-body">
                <!-- Add Note Form -->
                <div style="background: #fff; border: 1px solid #ccc; border-radius: 8px; padding: 1.5rem; margin-bottom: 2rem;">
                    <h4 style="margin: 0 0 1rem 0; color: #000;">Dodaj nową notatkę</h4>
                    <form id="customerNoteForm">
                        <div class="form-group">
                            <label for="customerNoteTitle">Tytuł notatki</label>
                            <input type="text" id="customerNoteTitle" class="form-input" placeholder="Wprowadź tytuł notatki..." required>
                        </div>
                        <div class="form-group">
                            <label for="customerNoteContent">Treść notatki</label>
                            <textarea id="customerNoteContent" class="form-input" rows="4" placeholder="Wprowadź treść notatki..." required></textarea>
                        </div>
                        <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                            <button type="button" class="btn btn-secondary" onclick="clearNoteForm()">Wyczyść</button>
                            <button type="submit" class="btn btn-primary">Dodaj notatkę</button>
                        </div>
                    </form>
                </div>

                <!-- Search and History -->
                <div>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h4 style="margin: 0; color: #000;">Historia notatek</h4>
                        <div style="display: flex; gap: 1rem; align-items: center;">
                            <input type="text" id="noteSearchInput" class="form-input" placeholder="Szukaj w notatkach..." style="width: 250px;" onkeyup="searchNotes()">
                            <button class="btn btn-secondary" onclick="clearSearch()">
                                <i class='bx bx-x'></i> Wyczyść
                            </button>
                        </div>
                    </div>
                    <div id="customerNotesList">
                        <!-- Notes will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Customer Goals Modal -->
    <div id="customerGoalsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Cele powiązane z klientem: <span id="customerGoalsName"></span></h3>
                <button class="modal-close" onclick="hideModal('customerGoalsModal')">×</button>
            </div>
            <div class="modal-body">
                <div id="customerGoalsList">
                    <!-- Goals will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Customer Profile Modal -->
    <div id="customerProfileModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3>Profil klienta - <span id="customerProfileName"></span></h3>
                <button class="modal-close" onclick="hideModal('customerProfileModal')">×</button>
            </div>
            <div class="modal-body">
                <!-- Aktywności na stronie internetowej - na górze -->
                <div style="margin-bottom: 2rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h4 style="margin: 0; color: #000;">Aktywności na stronie internetowej</h4>
                        <input type="text" id="webActivitiesSearchInput" class="form-input" placeholder="Szukaj aktywności..." style="width: 250px;" onkeyup="searchWebActivities()">
                    </div>
                    <div id="customerWebActivitiesList" style="max-height: 200px; overflow-y: auto; background: #fff; border-radius: 8px; padding: 1rem;">
                        <!-- Web activities will be loaded here -->
                    </div>
                </div>
                
                <!-- Ostatnie aktywności - na cały wiersz -->
                <div style="margin-bottom: 2rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h4 style="margin: 0; color: #000;">Ostatnie aktywności względem klienta</h4>
                        <input type="text" id="activitiesSearchInput" class="form-input" placeholder="Szukaj aktywności..." style="width: 250px;" onkeyup="searchActivities()">
                    </div>
                    <div id="customerActivitiesList" style="max-height: 200px; overflow-y: auto;">
                        <!-- Activities will be loaded here -->
                    </div>
                </div>
                
                <!-- Notatki i cele - na cały wiersz -->
                <div style="margin-bottom: 2rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h4 style="margin: 0; color: #000;">Notatki i cele</h4>
                        <input type="text" id="notesGoalsSearchInput" class="form-input" placeholder="Szukaj..." style="width: 250px;" onkeyup="searchNotesGoals()">
                    </div>
                    <div id="customerNotesGoalsList" style="max-height: 200px; overflow-y: auto;">
                        <!-- Notes and goals will be loaded here -->
                    </div>
                </div>
                
                <!-- Przyciski akcji -->
                <div style="margin-top: 2rem; padding-top: 1rem; border-top: 1px solid #ccc;">
                    <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                        <button class="btn btn-secondary" onclick="showAddNoteModal()" style="flex: 1;">
                            <i class='bx bx-edit'></i> Dodaj notatkę
                        </button>
                        <button class="btn btn-secondary" onclick="showAddTaskModal()" style="flex: 1;">
                            <i class='bx bx-check'></i> Dodaj zadanie
                        </button>
                    </div>
                    <button class="btn btn-primary" onclick="openCustomerProfile()" style="width: 100%;">
                        <i class='bx bx-user'></i> Przejdź do pełnego profilu klienta
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Visit Planning Modal -->
    <div id="visitModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Zaplanuj wizytę</h3>
                <button class="modal-close" onclick="hideModal('visitModal')">×</button>
            </div>
            <form id="visitForm">
                <div class="modal-body">
                    <div class="form-group">
                        <label for="visitCustomer">Klient</label>
                        <select id="visitCustomer" class="form-select" required>
                            <option value="">Wybierz klienta</option>
                            <option value="Mateusz Wiktorowicz">Mateusz Wiktorowicz - Firma Budowlana Budowa</option>
                            <option value="Anna Kowalska">Anna Kowalska - Budowa Plus Sp. z o.o.</option>
                            <option value="Piotr Nowak">Piotr Nowak - Auto-All Magazynowa</option>
                            <option value="Katarzyna Lewandowska">Katarzyna Lewandowska - Elmas Pawlak S.J.</option>
                            <option value="Tomasz Zieliński">Tomasz Zieliński - Przykładowa Firma Budowlana Sp. z o.o.</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="visitDate">Data wizyty</label>
                        <input type="date" id="visitDate" class="form-input" required>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label for="visitStartTime">Godzina rozpoczęcia</label>
                            <input type="time" id="visitStartTime" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label for="visitEndTime">Godzina zakończenia</label>
                            <input type="time" id="visitEndTime" class="form-input" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="visitPurpose">Cel wizyty</label>
                        <select id="visitPurpose" class="form-select" required>
                            <option value="">Wybierz cel</option>
                            <option value="prezentacja">Prezentacja produktów</option>
                            <option value="negocjacje">Negocjacje cenowe</option>
                            <option value="podpisanie">Podpisanie umowy</option>
                            <option value="konsultacje">Konsultacje techniczne</option>
                            <option value="odbiór">Odbiór zamówienia</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="visitNotes">Notatki</label>
                        <textarea id="visitNotes" class="form-input" rows="3" placeholder="Dodatkowe informacje o wizycie..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="hideModal('visitModal')">Anuluj</button>
                    <button type="submit" class="btn btn-primary">Zaplanuj wizytę</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Rule Modal -->
    <div id="addRuleModal" class="modal">
        <div class="modal-content" style="max-width: 1000px;">
            <div class="modal-header">
                <h3>Dodaj nową regułę biznesową</h3>
                <button class="modal-close" onclick="hideModal('addRuleModal')">×</button>
            </div>
            <form id="addRuleForm">
                <div class="modal-body">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="ruleName">Nazwa reguły</label>
                            <input type="text" id="ruleName" class="form-input" placeholder="np. Porzucony koszyk - wysoki scoring" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="ruleType">Typ reguły</label>
                            <select id="ruleType" class="form-select" required>
                                <option value="">Wybierz typ reguły</option>
                                <option value="scoring">Reguła oparta na scoringu</option>
                                <option value="engagement">Spadek zaangażowania</option>
                                <option value="competitive">Analiza zachowania konkurencyjnego</option>
                                <option value="crosssell">Cross-sell/Up-sell</option>
                                <option value="retention">Ryzyko utraty klienta</option>
                                <option value="credit">Przekroczenie limitu kredytowego</option>
                                <option value="custom">Niestandardowa</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="ruleDescription">Opis reguły</label>
                        <textarea id="ruleDescription" class="form-input" rows="2" placeholder="Krótki opis działania reguły..."></textarea>
                    </div>

                    <!-- Scheduler Configuration -->
                    <div class="form-section">
                        <h4><i class='bx bx-time'></i> Scheduler - Harmonogram wykonania</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="scheduleDays">Dni tygodnia</label>
                                <div class="checkbox-group">
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="scheduleDays" value="monday">
                                        <span>Poniedziałek</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="scheduleDays" value="tuesday">
                                        <span>Wtorek</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="scheduleDays" value="wednesday">
                                        <span>Środa</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="scheduleDays" value="thursday">
                                        <span>Czwartek</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="scheduleDays" value="friday">
                                        <span>Piątek</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="scheduleDays" value="saturday">
                                        <span>Sobota</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="scheduleDays" value="sunday">
                                        <span>Niedziela</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="scheduleTime">Godzina wykonania</label>
                                <input type="time" id="scheduleTime" class="form-input" value="09:00">
                            </div>
                        </div>
                    </div>

                    <!-- Trigger Configuration -->
                    <div class="form-section">
                        <h4><i class='bx bx-target-lock'></i> Triggery - Warunki uruchomienia</h4>
                        <div class="form-group">
                            <label for="triggerLogic">Logika łączenia triggerów</label>
                            <select id="triggerLogic" class="form-select">
                                <option value="AND">AND (wszystkie warunki muszą być spełnione)</option>
                                <option value="OR">OR (jeden z warunków musi być spełniony)</option>
                            </select>
                        </div>
                        
                        <div id="triggersList">
                            <div class="trigger-item">
                                <div class="trigger-config">
                                    <div class="form-group">
                                        <label>Typ triggera</label>
                                        <select class="form-select" onchange="updateTriggerType(this)">
                                            <option value="scoring">Punkty scoringowe</option>
                                            <option value="custom">Niestandardowy</option>
                                        </select>
                                    </div>
                                    
                                    <div class="scoring-trigger-config" style="display: block;">
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label>Działanie</label>
                                                <select class="form-select">
                                                    <option value="add_to_cart">Dodanie do koszyka</option>
                                                    <option value="product_view">Strona produktu</option>
                                                    <option value="search">Wyszukanie produktu</option>
                                                    <option value="login">Logowanie/rejestracji</option>
                                                    <option value="checkout">Finalizacja zamówienia</option>
                                                    <option value="favorite">Dodanie do ulubionych</span>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label>Ilość punktów</label>
                                                <input type="number" class="form-input scoring-points-input" placeholder="np. 4" min="0">
                                            </div>
                                            <div class="form-group">
                                                <label>Czas na osiągnięcie (dni)</label>
                                                <input type="number" class="form-input scoring-time-input" placeholder="np. 7" min="1">
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="custom-trigger-config" style="display: none;">
                                        <input type="text" class="form-input" placeholder="Opis niestandardowego triggera...">
                                    </div>
                                </div>
                                <button type="button" class="btn btn-secondary" onclick="removeTrigger(this)">Usuń</button>
                            </div>
                        </div>
                        <button type="button" class="btn btn-outline" onclick="addTrigger()">+ Dodaj trigger</button>
                    </div>

                    <!-- Action Configuration -->
                    <div class="form-section">
                        <h4><i class='bx bx-play'></i> Akcje - Co ma zostać wykonane</h4>
                        <div class="form-group">
                            <label for="actionLogic">Logika łączenia akcji</label>
                            <select id="actionLogic" class="form-select">
                                <option value="AND">AND (wszystkie akcje muszą być wykonane)</option>
                                <option value="OR">OR (jedna z akcji musi być wykonana)</option>
                            </select>
                        </div>
                        
                        <div id="actionsList">
                            <div class="action-item">
                                <div class="action-config">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label>Typ akcji</label>
                                            <select class="form-select">
                                                <option value="email">Wyślij email</option>
                                                <option value="task">Utwórz zadanie</option>
                                                <option value="notification">Powiadomienie w dashboard</option>
                                                <option value="call">Zadzwoń do klienta</option>
                                                <option value="discount">Wyślij kod rabatowy</option>
                                                <option value="custom">Niestandardowa akcja</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label>Czas wykonania (minuty)</label>
                                            <input type="number" class="form-input action-time-input" placeholder="np. 30" min="1">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label>Opis akcji</label>
                                        <input type="text" class="form-input action-description-input" placeholder="Szczegółowy opis akcji...">
                                    </div>
                                </div>
                                <button type="button" class="btn btn-secondary" onclick="removeAction(this)">Usuń</button>
                            </div>
                        </div>
                        <button type="button" class="btn btn-outline" onclick="addAction()">+ Dodaj akcję</button>
                    </div>

                    <div class="form-group">
                        <label class="toggle-switch">
                            <input type="checkbox" id="ruleEnabled" checked>
                            <span class="toggle-slider"></span>
                            <span style="margin-left: 0.5rem;">Reguła aktywna</span>
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="hideModal('addRuleModal')">Anuluj</button>
                    <button type="submit" class="btn btn-primary">Dodaj regułę</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Rule Modal -->
    <div id="editRuleModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3>Edytuj regułę biznesową</h3>
                <button class="modal-close" onclick="hideModal('editRuleModal')">×</button>
            </div>
            <form id="editRuleForm">
                <div class="modal-body">
                    <div class="form-group">
                        <label for="editRuleName">Nazwa reguły</label>
                        <input type="text" id="editRuleName" class="form-input" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="editRuleDescription">Opis reguły</label>
                        <textarea id="editRuleDescription" class="form-input" rows="2"></textarea>
                    </div>

                    <div class="form-group">
                        <label for="editRuleType">Typ reguły</label>
                        <select id="editRuleType" class="form-select" required>
                            <option value="engagement">Spadek zaangażowania</option>
                            <option value="competitive">Analiza zachowania konkurencyjnego</option>
                            <option value="crosssell">Cross-sell/Up-sell</option>
                            <option value="retention">Ryzyko utraty klienta</option>
                            <option value="credit">Przekroczenie limitu kredytowego</option>
                            <option value="custom">Niestandardowa</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Triggery</label>
                        <div id="editTriggersList">
                            <!-- Will be populated dynamically -->
                        </div>
                        <button type="button" class="btn btn-outline" onclick="addEditTrigger()">+ Dodaj trigger</button>
                    </div>

                    <div class="form-group">
                        <label>Akcje</label>
                        <div id="editActionsList">
                            <!-- Will be populated dynamically -->
                        </div>
                        <button type="button" class="btn btn-outline" onclick="addEditAction()">+ Dodaj akcję</button>
                    </div>

                    <div class="form-group">
                        <label for="editRuleParameters">Parametry</label>
                        <textarea id="editRuleParameters" class="form-input" rows="2"></textarea>
                    </div>

                    <div class="form-group">
                        <label class="toggle-switch">
                            <input type="checkbox" id="editRuleEnabled">
                            <span class="toggle-slider"></span>
                            <span style="margin-left: 0.5rem;">Reguła aktywna</span>
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="hideModal('editRuleModal')">Anuluj</button>
                    <button type="submit" class="btn btn-primary">Zapisz zmiany</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // =====================================================
        // localStorage Helper Functions
        // =====================================================
        const STORAGE_PREFIX = 'app:panel-handlowiec:';

        function storageGet(key, defaultValue = []) {
            try {
                const data = localStorage.getItem(STORAGE_PREFIX + key);
                return data ? JSON.parse(data) : defaultValue;
            } catch (e) {
                console.error('Error reading from localStorage:', e);
                return defaultValue;
            }
        }

        function storageSet(key, value) {
            try {
                localStorage.setItem(STORAGE_PREFIX + key, JSON.stringify(value));
                return true;
            } catch (e) {
                console.error('Error writing to localStorage:', e);
                return false;
            }
        }

        function generateId() {
            return Date.now() + Math.random();
        }

        function upsertRecord(key, record) {
            const records = storageGet(key, []);
            if (!record.id) {
                record.id = generateId();
            }
            const index = records.findIndex(r => r.id === record.id);
            if (index >= 0) {
                records[index] = record;
            } else {
                records.push(record);
            }
            storageSet(key, records);
            return record;
        }

        function deleteRecord(key, id) {
            const records = storageGet(key, []);
            const filtered = records.filter(r => r.id !== id);
            storageSet(key, filtered);
            return filtered;
        }

        // =====================================================
        // Render Saved Activities
        // =====================================================
        function renderSavedActivities() {
            const activities = storageGet('activities', []);
            const activityList = document.querySelector('.activity-timeline');
            if (!activityList) return;

            // Remove previously rendered localStorage activities
            activityList.querySelectorAll('.activity-item[data-storage-id]').forEach(item => item.remove());

            // Insert at the beginning
            const firstStaticItem = activityList.querySelector('.activity-item:not([data-storage-id])');

            activities.forEach(activity => {
                const icons = {
                    'task': 'fi fi-rr-checkbox',
                    'visit': 'fi fi-rr-marker',
                    'goal': 'fi fi-rr-target',
                    'note': 'fi fi-rr-document',
                    'call': 'fi fi-rr-phone-call',
                    'email': 'fi fi-rr-envelope'
                };
                const icon = icons[activity.type] || 'fi fi-rr-document';

                const newItem = document.createElement('div');
                newItem.className = 'activity-item';
                newItem.setAttribute('data-storage-id', activity.id);
                newItem.innerHTML = `
                    <div class="activity-icon">
                        <i class="${icon}"></i>
                    </div>
                    <div class="activity-content">
                        <div class="activity-title">${activity.title || activity.type}</div>
                        <div class="activity-meta">${activity.client || ''} • ${activity.dateStr || ''}</div>
                        ${activity.description ? `<div class="activity-description">${activity.description}</div>` : ''}
                    </div>
                    <button onclick="deleteActivity(${activity.id})" title="Usuń" style="background: none; border: none; cursor: pointer; color: var(--color-gray);">
                        <i class="fi fi-rr-trash"></i>
                    </button>
                `;
                if (firstStaticItem) {
                    activityList.insertBefore(newItem, firstStaticItem);
                } else {
                    activityList.appendChild(newItem);
                }
            });
        }

        function deleteActivity(id) {
            if (confirm('Czy na pewno chcesz usunąć tę aktywność?')) {
                deleteRecord('activities', id);
                renderSavedActivities();
            }
        }

        // =====================================================
        // Render Saved Tasks
        // =====================================================
        function renderSavedTasks() {
            const tasks = storageGet('tasks', []);
            const taskList = document.getElementById('taskList');
            if (!taskList) return;

            // Remove previously rendered localStorage tasks
            taskList.querySelectorAll('.task-item[data-storage-id]').forEach(item => item.remove());

            // Insert at the beginning
            const firstStaticItem = taskList.querySelector('.task-item:not([data-storage-id])');

            tasks.forEach(task => {
                const priorityColors = {
                    'Wysoki': '#ef4444',
                    'Średni': '#f59e0b',
                    'Niski': '#22c55e'
                };
                const priorityColor = priorityColors[task.priority] || '#666';

                const newItem = document.createElement('div');
                newItem.className = 'task-item';
                newItem.draggable = true;
                newItem.setAttribute('data-storage-id', task.id);
                newItem.innerHTML = `
                    <div class="task-checkbox">
                        <input type="checkbox" onchange="toggleTask(this)">
                    </div>
                    <div class="task-content">
                        <div class="task-title">${task.title} - ${task.client || 'Brak klienta'}</div>
                        <div class="task-meta">
                            <span><i class="fi fi-rr-calendar"></i> ${task.dateStr || 'Brak terminu'}</span>
                            <span style="color: ${priorityColor}"><i class="fi fi-rr-flag"></i> ${task.priority}</span>
                        </div>
                    </div>
                    <div class="task-actions">
                        <button class="icon-btn" onclick="editTask(this)" title="Edytuj"><i class="fi fi-rr-edit"></i></button>
                        <button class="icon-btn" onclick="deleteTaskItem(${task.id})" title="Usuń"><i class="fi fi-rr-trash"></i></button>
                    </div>
                `;
                if (firstStaticItem) {
                    taskList.insertBefore(newItem, firstStaticItem);
                } else {
                    taskList.appendChild(newItem);
                }
            });
        }

        function deleteTaskItem(id) {
            if (confirm('Czy na pewno chcesz usunąć to zadanie?')) {
                deleteRecord('tasks', id);
                renderSavedTasks();
            }
        }

        // =====================================================
        // Initialize on DOMContentLoaded
        // =====================================================
        document.addEventListener('DOMContentLoaded', function() {
            renderSavedActivities();
            renderSavedTasks();
            
            // Load tab from URL on page load
            const tabFromUrl = getTabFromUrl();
            if (tabFromUrl && tabFromUrl !== 'dashboard') {
                switchTab(tabFromUrl, false);
            }
        });

        // =====================================================
        // UI Functions
        // =====================================================
        // User menu toggle
        function toggleUserMenu(event) {
            event.stopPropagation();
            const dropdown = document.getElementById('userMenuDropdown');
            dropdown.classList.toggle('active');
        }

        function toggleNotificationMenu(event) {
            event.stopPropagation();
            const dropdown = document.getElementById('notificationDropdown');
            dropdown.classList.toggle('active');
        }

        // Close dropdowns when clicking outside
        document.addEventListener('click', function(event) {
            const userMenu = document.querySelector('.user-menu');
            const userDropdown = document.getElementById('userMenuDropdown');
            const notificationDropdown = document.getElementById('notificationDropdown');
            
            if (userMenu && !userMenu.contains(event.target)) {
                userDropdown.classList.remove('active');
            }
            
            if (!event.target.closest('.notification-btn') && !event.target.closest('.notification-dropdown')) {
                notificationDropdown.classList.remove('active');
            }
        });

        // Tab switching with URL support
        function getTabFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('tab') || 'dashboard';
        }
        
        function updateUrlWithTab(tabName) {
            const url = new URL(window.location);
            url.searchParams.set('tab', tabName);
            window.history.pushState({tab: tabName}, '', url);
        }
        
        function switchTab(tabName, updateUrl = true) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active from all nav tabs
            document.querySelectorAll('.nav-tab').forEach(navTab => {
                navTab.classList.remove('active');
            });
            
            // Show selected tab
            const selectedTab = document.getElementById(tabName);
            if (selectedTab) {
                selectedTab.classList.add('active');
            }
            
            // Add active to clicked nav tab if event exists
            if (typeof event !== 'undefined' && event && event.target) {
                event.target.classList.add('active');
            } else {
                // Find and activate the corresponding nav tab
                const navTab = document.querySelector(`.nav-tab[onclick*="switchTab('${tabName}'"]`);
                if (navTab) {
                    navTab.classList.add('active');
                }
            }

            // Initialize map and calendar if routes tab is selected
            if (tabName === 'routes') {
                setTimeout(initMap, 100);
                setTimeout(initializeVisitCalendar, 100);
            }
            
            // Update URL with tab parameter
            if (updateUrl) {
                updateUrlWithTab(tabName);
            }
        }
        
        // Handle browser back/forward buttons
        window.addEventListener('popstate', function(event) {
            if (event.state && event.state.tab) {
                switchTab(event.state.tab, false);
            } else {
                const tab = getTabFromUrl();
                switchTab(tab, false);
            }
        });

        // Modal functions
        function showModal(modalId) {
            document.getElementById(modalId).classList.add('active');
            if (modalId === 'addModal') {
                // Reset to action type selector
                document.getElementById('actionTypeSelector').style.display = 'grid';
                document.getElementById('taskForm').style.display = 'none';
                document.getElementById('visitForm').style.display = 'none';
                document.getElementById('goalForm').style.display = 'none';
                document.getElementById('noteForm').style.display = 'none';
                document.getElementById('callForm').style.display = 'none';
                document.getElementById('emailForm').style.display = 'none';
            }
        }

        function hideModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Action type selection
        function selectActionType(type) {
            document.getElementById('actionTypeSelector').style.display = 'none';
            
            // Remove all selected states
            document.querySelectorAll('.action-type-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            if (type === 'task') {
                document.getElementById('taskForm').style.display = 'block';
                document.querySelector('.modal-title').textContent = 'Dodaj zadanie';
            } else if (type === 'visit') {
                document.getElementById('visitForm').style.display = 'block';
                document.querySelector('.modal-title').textContent = 'Dodaj wizytę';
            } else if (type === 'goal') {
                document.getElementById('goalForm').style.display = 'block';
                document.querySelector('.modal-title').textContent = 'Dodaj cel';
            } else if (type === 'note') {
                document.getElementById('noteForm').style.display = 'block';
                document.querySelector('.modal-title').textContent = 'Dodaj notatkę';
            } else if (type === 'call') {
                document.getElementById('callForm').style.display = 'block';
                document.querySelector('.modal-title').textContent = 'Dodaj rozmowę';
            } else if (type === 'email') {
                document.getElementById('emailForm').style.display = 'block';
                document.querySelector('.modal-title').textContent = 'Dodaj email';
            }
        }

        function saveAction() {
            // Determine which form is visible and save appropriately
            const taskForm = document.getElementById('taskForm');
            const visitForm = document.getElementById('visitForm');
            const goalForm = document.getElementById('goalForm');
            const noteForm = document.getElementById('noteForm');
            const callForm = document.getElementById('callForm');
            const emailForm = document.getElementById('emailForm');

            let activityType = '';
            let activityData = {};

            const today = new Date();
            const dateStr = today.toLocaleDateString('pl-PL');

            if (taskForm && taskForm.style.display !== 'none') {
                activityType = 'task';
                const client = taskForm.querySelector('.form-select')?.value || '';
                const title = taskForm.querySelector('.form-input[placeholder*="Tytuł"]')?.value || 'Zadanie';
                const date = taskForm.querySelector('input[type="date"]')?.value || '';
                const priority = taskForm.querySelector('.form-select:last-of-type')?.value || 'Średni';
                const description = taskForm.querySelector('.form-textarea')?.value || '';

                // Also save as task
                const taskRecord = {
                    title: title,
                    client: client,
                    dateStr: date ? new Date(date).toLocaleDateString('pl-PL') : dateStr,
                    priority: priority,
                    description: description,
                    createdAt: new Date().toISOString()
                };
                upsertRecord('tasks', taskRecord);
                renderSavedTasks();

                activityData = { title, client, description, dateStr };
            } else if (visitForm && visitForm.style.display !== 'none') {
                activityType = 'visit';
                const client = visitForm.querySelector('.form-select')?.value || '';
                const date = visitForm.querySelector('input[type="date"]')?.value || '';
                const time = visitForm.querySelector('input[type="time"]')?.value || '';
                const description = visitForm.querySelector('.form-textarea')?.value || '';
                activityData = { title: 'Wizyta u klienta', client, description, dateStr: date ? new Date(date).toLocaleDateString('pl-PL') : dateStr };
            } else if (noteForm && noteForm.style.display !== 'none') {
                activityType = 'note';
                const client = noteForm.querySelector('.form-select')?.value || '';
                const content = noteForm.querySelector('.form-textarea')?.value || '';
                activityData = { title: 'Notatka', client, description: content, dateStr };
            } else if (callForm && callForm.style.display !== 'none') {
                activityType = 'call';
                const client = callForm.querySelector('.form-select')?.value || '';
                const date = callForm.querySelector('input[type="date"]')?.value || '';
                const description = callForm.querySelector('.form-textarea')?.value || '';
                activityData = { title: 'Rozmowa telefoniczna', client, description, dateStr: date ? new Date(date).toLocaleDateString('pl-PL') : dateStr };
            } else if (emailForm && emailForm.style.display !== 'none') {
                activityType = 'email';
                const client = emailForm.querySelector('.form-select')?.value || '';
                const subject = emailForm.querySelector('input[type="text"]')?.value || 'Email';
                const content = emailForm.querySelector('.form-textarea')?.value || '';
                activityData = { title: subject, client, description: content, dateStr };
            }

            if (activityType) {
                const activityRecord = {
                    type: activityType,
                    ...activityData,
                    createdAt: new Date().toISOString()
                };
                upsertRecord('activities', activityRecord);
                renderSavedActivities();
            }

            alert('Akcja zapisana!');
            hideModal('addModal');
        }

        // Activity actions
        function showActivityActions(element) {
            // Hide all other action buttons
            document.querySelectorAll('.activity-actions').forEach(actions => {
                actions.style.display = 'none';
            });
            
            // Show this activity's actions
            const actions = element.querySelector('.activity-actions');
            actions.style.display = 'flex';
        }

        function showNoteModal(clientName) {
            document.getElementById('noteClient').value = clientName;
            showModal('noteModal');
        }

        function showTaskModal(clientName) {
            document.getElementById('taskClient').value = clientName;
            showModal('taskModal');
        }

        function saveNote() {
            const client = document.getElementById('noteClient')?.value || '';
            const noteType = document.querySelector('#noteModal .form-select')?.value || 'Notatka ogólna';
            const content = document.querySelector('#noteModal .form-textarea')?.value || '';

            if (!content.trim()) {
                alert('Proszę wpisać treść notatki.');
                return;
            }

            const today = new Date();
            const dateStr = today.toLocaleDateString('pl-PL');

            const activityRecord = {
                type: 'note',
                title: noteType,
                client: client,
                description: content,
                dateStr: dateStr,
                createdAt: new Date().toISOString()
            };
            upsertRecord('activities', activityRecord);
            renderSavedActivities();

            alert('Notatka zapisana!');
            hideModal('noteModal');
        }

        function saveTask() {
            const client = document.getElementById('taskClient')?.value || '';
            const title = document.querySelector('#taskModal .form-input[placeholder*="Kontakt"]')?.value || 'Zadanie';
            const description = document.querySelector('#taskModal .form-textarea')?.value || '';
            const date = document.querySelector('#taskModal input[type="date"]')?.value || '';
            const priority = document.querySelector('#taskModal .form-select')?.value || 'Średni';

            if (!title.trim()) {
                alert('Proszę wpisać tytuł zadania.');
                return;
            }

            const today = new Date();
            const dateStr = date ? new Date(date).toLocaleDateString('pl-PL') : today.toLocaleDateString('pl-PL');

            // Save as task
            const taskRecord = {
                title: title,
                client: client,
                dateStr: dateStr,
                priority: priority,
                description: description,
                createdAt: new Date().toISOString()
            };
            upsertRecord('tasks', taskRecord);
            renderSavedTasks();

            // Also save as activity
            const activityRecord = {
                type: 'task',
                title: title,
                client: client,
                description: description,
                dateStr: dateStr,
                createdAt: new Date().toISOString()
            };
            upsertRecord('activities', activityRecord);
            renderSavedActivities();

            alert('Zadanie zapisane!');
            hideModal('taskModal');
        }

        // Task management functions
        function toggleTask(checkbox) {
            const taskItem = checkbox.closest('.task-item');
            if (checkbox.checked) {
                taskItem.classList.add('completed');
            } else {
                taskItem.classList.remove('completed');
            }
        }

        function editTask(button) {
            const taskItem = button.closest('.task-item');
            const taskTitle = taskItem.querySelector('.task-title').textContent.split(' - ')[0];
            alert('Edytowanie zadania: ' + taskTitle);
        }

        function toggleGoalActions(goalItem) {
            // Hide all other goal actions
            document.querySelectorAll('.goal-actions').forEach(actions => {
                actions.classList.remove('show');
            });
            
            // Toggle this goal's actions
            const actions = goalItem.querySelector('.goal-actions');
            actions.classList.toggle('show');
        }

        function filterGoals(filter) {
            // Update active tab
            document.querySelectorAll('.goal-filter-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.style.borderBottom = '2px solid transparent';
            });
            
            event.target.classList.add('active');
            event.target.style.borderBottom = '2px solid #ef7d05';
            
            // Filter goals
            const goals = document.querySelectorAll('.goal-item');
            goals.forEach(goal => {
                const type = goal.getAttribute('data-type');
                const status = goal.getAttribute('data-status');
                
                let show = false;
                
                switch(filter) {
                    case 'all':
                        show = true;
                        break;
                    case 'numeric':
                        show = type === 'numeric';
                        break;
                    case 'qualitative':
                        show = type === 'qualitative';
                        break;
                    case 'in-progress':
                        show = status === 'in-progress';
                        break;
                    case 'completed':
                        show = status === 'completed';
                        break;
                }
                
                goal.style.display = show ? 'block' : 'none';
            });
        }

        // Drag and drop functionality
        function initializeDragAndDrop() {
            const taskList = document.getElementById('taskList');
            let draggedElement = null;

            taskList.addEventListener('dragstart', function(e) {
                draggedElement = e.target;
                e.target.classList.add('dragging');
            });

            taskList.addEventListener('dragend', function(e) {
                e.target.classList.remove('dragging');
                draggedElement = null;
            });

            taskList.addEventListener('dragover', function(e) {
                e.preventDefault();
                const afterElement = getDragAfterElement(taskList, e.clientY);
                if (afterElement == null) {
                    taskList.appendChild(draggedElement);
                } else {
                    taskList.insertBefore(draggedElement, afterElement);
                }
            });
        }

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.task-item:not(.dragging)')];
            
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        // Initialize drag and drop when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeDragAndDrop();
        });

        // Customer functions
        function showCustomerNotes(customerName) {
            document.getElementById('customerNotesName').textContent = customerName;
            
            // Pre-fill the note form with customer name
            const noteTitleInput = document.getElementById('customerNoteTitle');
            const noteContentInput = document.getElementById('customerNoteContent');
            
            if (noteTitleInput) {
                noteTitleInput.value = `Notatka - ${customerName}`;
            }
            if (noteContentInput) {
                noteContentInput.value = `Notatka dotycząca klienta: ${customerName}\n\n`;
            }
            
            // Load notes
            loadCustomerNotes(customerName);
            
            showModal('customerNotesModal');
        }

        function loadCustomerNotes(customerName) {
            // Sample notes data
            const notesData = {
                'Mateusz Wiktorowicz': [
                    { id: 1, date: '2024-01-15', title: 'Nowa linia produktów', content: 'Klient zainteresowany nową linią produktów. Wysłać ofertę do końca tygodnia.', author: 'Jan Kowalski' },
                    { id: 2, date: '2024-01-10', title: 'Spotkanie biznesowe', content: 'Spotkanie przebiegło bardzo dobrze. Klient rozważa zwiększenie zamówienia o 30%.', author: 'Anna Nowak' },
                    { id: 3, date: '2024-01-05', title: 'Pierwszy kontakt', content: 'Pierwszy kontakt telefoniczny. Klient bardzo pozytywnie nastawiony.', author: 'Jan Kowalski' }
                ],
                'Anna Kowalska': [
                    { id: 4, date: '2024-01-14', title: 'Jakość produktów', content: 'Klient zadowolony z jakości produktów. Rozważa długoterminową współpracę.', author: 'Anna Nowak' },
                    { id: 5, date: '2024-01-08', title: 'Dostawa', content: 'Dostawa przebiegła bez problemów. Klient potwierdził kolejne zamówienie.', author: 'Jan Kowalski' },
                    { id: 6, date: '2024-01-03', title: 'Negocjacje cenowe', content: 'Klient pytał o możliwość negocjacji cen. Przekazałem informacje do działu handlowego.', author: 'Anna Nowak' },
                    { id: 7, date: '2023-12-28', title: 'Pierwsze zamówienie', content: 'Pierwsze zamówienie zrealizowane. Klient bardzo zadowolony.', author: 'Jan Kowalski' },
                    { id: 8, date: '2023-12-20', title: 'Kontakt telefoniczny', content: 'Kontakt telefoniczny - klient zainteresowany naszą ofertą.', author: 'Anna Nowak' }
                ]
            };
            
            const notes = notesData[customerName] || [
                { id: 0, date: '2024-01-15', title: 'Brak notatek', content: 'Brak notatek dla tego klienta.', author: 'System' }
            ];
            
            // Store notes for search functionality
            window.currentCustomerNotes = notes;
            
            const notesList = document.getElementById('customerNotesList');
            notesList.innerHTML = notes.map(note => `
                <div class="note-item" data-note-id="${note.id}" style="padding: 1rem; border: 1px solid #ccc; border-radius: 8px; margin-bottom: 1rem;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <div>
                            <span style="font-weight: 600; color: #000;">${note.title}</span>
                            <span style="color: #666; font-size: 0.875rem; margin-left: 1rem;">${note.date}</span>
                        </div>
                        <span style="color: #666; font-size: 0.875rem;">${note.author}</span>
                    </div>
                    <p style="margin: 0; color: #000;">${note.content}</p>
                </div>
            `).join('');
        }

        function showCustomerGoals(customerName) {
            document.getElementById('customerGoalsName').textContent = customerName;
            
            // Sample goals data
            const goalsData = {
                'Mateusz Wiktorowicz': [
                    { title: 'Zwiększenie sprzedaży o 20%', progress: 65, deadline: '2024-03-31' },
                    { title: 'Nawiązanie długoterminowej współpracy', progress: 80, deadline: '2024-02-28' }
                ],
                'Anna Kowalska': [
                    { title: 'Realizacja zamówienia na 50,000 PLN', progress: 45, deadline: '2024-04-30' }
                ]
            };
            
            const goals = goalsData[customerName] || [
                { title: 'Brak celów dla tego klienta', progress: 0, deadline: '-' }
            ];
            
            const goalsList = document.getElementById('customerGoalsList');
            goalsList.innerHTML = goals.map(goal => `
                <div style="padding: 1rem; border: 1px solid #ccc; border-radius: 8px; margin-bottom: 1rem;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <h4 style="margin: 0; color: #000;">${goal.title}</h4>
                        <span style="color: #666; font-size: 0.875rem;">${goal.deadline}</span>
                    </div>
                    <div style="background: #fff; border-radius: 4px; height: 8px; margin-bottom: 0.5rem;">
                        <div style="background: #ef7d05; height: 100%; border-radius: 4px; width: ${goal.progress}%;"></div>
                    </div>
                    <span style="color: #666; font-size: 0.875rem;">${goal.progress}% ukończone</span>
                </div>
            `).join('');
            
            showModal('customerGoalsModal');
        }

        function showCustomerProfile(customerName) {
            document.getElementById('customerProfileName').textContent = customerName;
            
            // Load activities
            const activitiesList = document.getElementById('customerActivitiesList');
            activitiesList.innerHTML = `
                <div style="padding: 0.75rem; border: 1px solid #ccc; border-radius: 6px; margin-bottom: 0.5rem;">
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <div style="width: 8px; height: 8px; background: #10b981; border-radius: 50%;"></div>
                        <div>
                            <div style="font-weight: 500; color: #000;">Rozmowa telefoniczna</div>
                            <div style="font-size: 0.875rem; color: #666;">2 godz. temu</div>
                        </div>
                    </div>
                </div>
                <div style="padding: 0.75rem; border: 1px solid #ccc; border-radius: 6px; margin-bottom: 0.5rem;">
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <div style="width: 8px; height: 8px; background: #ef7d05; border-radius: 50%;"></div>
                        <div>
                            <div style="font-weight: 500; color: #000;">Wizyta u klienta</div>
                            <div style="font-size: 0.875rem; color: #666;">1 dzień temu</div>
                        </div>
                    </div>
                </div>
                <div style="padding: 0.75rem; border: 1px solid #ccc; border-radius: 6px; margin-bottom: 0.5rem;">
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <div style="width: 8px; height: 8px; background: #f59e0b; border-radius: 50%;"></div>
                        <div>
                            <div style="font-weight: 500; color: #000;">Wysłanie oferty</div>
                            <div style="font-size: 0.875rem; color: #666;">3 dni temu</div>
                        </div>
                    </div>
                </div>
            `;
            
            // Load notes and goals
            const notesGoalsList = document.getElementById('customerNotesGoalsList');
            notesGoalsList.innerHTML = `
                <div style="margin-bottom: 1rem;">
                    <h5 style="margin: 0 0 0.5rem 0; color: #000;">Ostatnie notatki</h5>
                    <div style="padding: 0.75rem; background: #fff; border-radius: 6px; margin-bottom: 0.5rem;">
                        <div style="font-size: 0.875rem; color: #666;">2 godz. temu</div>
                        <div style="color: #000;">Klient zainteresowany nową linią produktów...</div>
                    </div>
                </div>
                <div>
                    <h5 style="margin: 0 0 0.5rem 0; color: #000;">Aktywne cele</h5>
                    <div style="padding: 0.75rem; background: #fff; border-radius: 6px;">
                        <div style="font-weight: 500; color: #000;">Zwiększenie sprzedaży o 20%</div>
                        <div style="font-size: 0.875rem; color: #666;">65% ukończone</div>
                    </div>
                </div>
            `;
            
            // Load web activities
            const webActivitiesList = document.getElementById('customerWebActivitiesList');
            webActivitiesList.innerHTML = `
                <div style="padding: 0.75rem; border: 1px solid #ccc; border-radius: 6px; margin-bottom: 0.5rem; background: white;">
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <div style="width: 8px; height: 8px; background: #8b5cf6; border-radius: 50%;"></div>
                        <div>
                            <div style="font-weight: 500; color: #000;">Przeglądanie kategorii "Cement"</div>
                            <div style="font-size: 0.875rem; color: #666;">1 godz. temu • 15 min</div>
                        </div>
                    </div>
                </div>
                <div style="padding: 0.75rem; border: 1px solid #ccc; border-radius: 6px; margin-bottom: 0.5rem; background: white;">
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <div style="width: 8px; height: 8px; background: #ef4444; border-radius: 50%;"></div>
                        <div>
                            <div style="font-weight: 500; color: #000;">Dodanie do koszyka - Zestaw sztućców Premium</div>
                            <div style="font-size: 0.875rem; color: #666;">2 godz. temu</div>
                        </div>
                    </div>
                </div>
                <div style="padding: 0.75rem; border: 1px solid #ccc; border-radius: 6px; margin-bottom: 0.5rem; background: white;">
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <div style="width: 8px; height: 8px; background: #06b6d4; border-radius: 50%;"></div>
                        <div>
                            <div style="font-weight: 500; color: #000;">Wyszukiwanie "talerze ceramiczne"</div>
                            <div style="font-size: 0.875rem; color: #666;">3 godz. temu</div>
                        </div>
                    </div>
                </div>
                <div style="padding: 0.75rem; border: 1px solid #ccc; border-radius: 6px; margin-bottom: 0.5rem; background: white;">
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <div style="width: 8px; height: 8px; background: #10b981; border-radius: 50%;"></div>
                        <div>
                            <div style="font-weight: 500; color: #000;">Otwarcie strony produktu</div>
                            <div style="font-size: 0.875rem; color: #666;">1 dzień temu • 5 min</div>
                        </div>
                    </div>
                </div>
                <div style="padding: 0.75rem; border: 1px solid #ccc; border-radius: 6px; background: white;">
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <div style="width: 8px; height: 8px; background: #f59e0b; border-radius: 50%;"></div>
                        <div>
                            <div style="font-weight: 500; color: #000;">Porzucenie koszyka z wartością 1,250 PLN</div>
                            <div style="font-size: 0.875rem; color: #666;">2 dni temu</div>
                        </div>
                    </div>
                </div>
            `;
            
            showModal('customerProfileModal');
        }

        function openCustomerProfile() {
            alert('Przekierowanie do pełnego profilu klienta w systemie CRM');
        }

        // Search functions for customer profile sections
        function searchActivities() {
            const searchTerm = document.getElementById('activitiesSearchInput').value.toLowerCase();
            const activityItems = document.querySelectorAll('#customerActivitiesList > div');
            
            activityItems.forEach(item => {
                const text = item.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        function searchNotesGoals() {
            const searchTerm = document.getElementById('notesGoalsSearchInput').value.toLowerCase();
            const noteGoalItems = document.querySelectorAll('#customerNotesGoalsList > div');
            
            noteGoalItems.forEach(item => {
                const text = item.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        function searchWebActivities() {
            const searchTerm = document.getElementById('webActivitiesSearchInput').value.toLowerCase();
            const webActivityItems = document.querySelectorAll('#customerWebActivitiesList > div');
            
            webActivityItems.forEach(item => {
                const text = item.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        function showAddNoteModal() {
            // Hide current modal
            hideModal('customerNotesModal');
            hideModal('customerProfileModal');
            
            // Pre-fill the note form with customer name if available
            const customerName = document.getElementById('customerNotesName')?.textContent || 
                                document.getElementById('customerProfileName')?.textContent || '';
            
            if (customerName) {
                const noteTitleInput = document.getElementById('noteTitle');
                const noteContentInput = document.getElementById('noteContent');
                
                if (noteTitleInput) {
                    noteTitleInput.value = `Notatka - ${customerName}`;
                }
                if (noteContentInput) {
                    noteContentInput.value = `Notatka dotycząca klienta: ${customerName}\n\n`;
                }
            }
            
            // Show note modal
            showModal('noteModal');
        }

        // Note management functions
        function clearNoteForm() {
            document.getElementById('customerNoteTitle').value = '';
            document.getElementById('customerNoteContent').value = '';
        }

        function searchNotes() {
            const searchTerm = document.getElementById('noteSearchInput').value.toLowerCase();
            const noteItems = document.querySelectorAll('.note-item');
            
            noteItems.forEach(item => {
                const title = item.querySelector('span[style*="font-weight: 600"]').textContent.toLowerCase();
                const content = item.querySelector('p').textContent.toLowerCase();
                const author = item.querySelector('span[style*="color: #666"]').textContent.toLowerCase();
                
                if (title.includes(searchTerm) || content.includes(searchTerm) || author.includes(searchTerm)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        function clearSearch() {
            document.getElementById('noteSearchInput').value = '';
            const noteItems = document.querySelectorAll('.note-item');
            noteItems.forEach(item => {
                item.style.display = 'block';
            });
        }

        // Customer note form submission
        document.addEventListener('DOMContentLoaded', function() {
            const customerNoteForm = document.getElementById('customerNoteForm');
            if (customerNoteForm) {
                customerNoteForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const title = document.getElementById('customerNoteTitle').value;
                    const content = document.getElementById('customerNoteContent').value;
                    const customerName = document.getElementById('customerNotesName').textContent;
                    
                    if (!title || !content) {
                        alert('Proszę wypełnić wszystkie pola');
                        return;
                    }
                    
                    // Add new note to the list
                    const newNote = {
                        id: Date.now(),
                        date: new Date().toISOString().split('T')[0],
                        title: title,
                        content: content,
                        author: 'Aktualny użytkownik'
                    };
                    
                    // Add to current notes array
                    if (window.currentCustomerNotes) {
                        window.currentCustomerNotes.unshift(newNote);
                    }
                    
                    // Refresh the notes list
                    loadCustomerNotes(customerName);
                    
                    // Clear the form
                    clearNoteForm();
                    
                    // Show success message
                    alert('Notatka została dodana pomyślnie!');
                });
            }
        });

        function showAddGoalModal() {
            // Hide current modal
            hideModal('customerGoalsModal');
            hideModal('customerProfileModal');
            
            // Show goal modal
            showModal('goalModal');
        }

        function showAddTaskModal() {
            // Hide current modal
            hideModal('customerProfileModal');
            
            // Show task modal
            showModal('taskModal');
        }

        // Visit planning functions
        function initializeVisitCalendar() {
            const calendar = document.getElementById('visit-calendar');
            if (!calendar) return;

            const today = new Date();
            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();
            
            // Generate calendar HTML
            const monthNames = [
                'Styczeń', 'Luty', 'Marzec', 'Kwiecień', 'Maj', 'Czerwiec',
                'Lipiec', 'Sierpień', 'Wrzesień', 'Październik', 'Listopad', 'Grudzień'
            ];
            
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            
            let calendarHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h5 style="margin: 0; color: #000;">${monthNames[currentMonth]} ${currentYear}</h5>
                    <div style="display: flex; gap: 0.5rem;">
                        <button onclick="changeMonth(-1)" style="padding: 0.25rem 0.5rem; border: 1px solid #d1d5db; background: white; border-radius: 4px; cursor: pointer;">‹</button>
                        <button onclick="changeMonth(1)" style="padding: 0.25rem 0.5rem; border: 1px solid #d1d5db; background: white; border-radius: 4px; cursor: pointer;">›</button>
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; margin-bottom: 1rem;">
                    <div style="text-align: center; font-weight: 600; color: #666; padding: 0.5rem; font-size: 0.875rem;">P</div>
                    <div style="text-align: center; font-weight: 600; color: #666; padding: 0.5rem; font-size: 0.875rem;">W</div>
                    <div style="text-align: center; font-weight: 600; color: #666; padding: 0.5rem; font-size: 0.875rem;">Ś</div>
                    <div style="text-align: center; font-weight: 600; color: #666; padding: 0.5rem; font-size: 0.875rem;">C</div>
                    <div style="text-align: center; font-weight: 600; color: #666; padding: 0.5rem; font-size: 0.875rem;">P</div>
                    <div style="text-align: center; font-weight: 600; color: #666; padding: 0.5rem; font-size: 0.875rem;">S</div>
                    <div style="text-align: center; font-weight: 600; color: #666; padding: 0.5rem; font-size: 0.875rem;">N</div>
                </div>
                <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px;">
            `;
            
            // Add empty cells for days before month starts
            for (let i = 0; i < firstDay; i++) {
                calendarHTML += `<div style="height: 40px;"></div>`;
            }
            
            // Add days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const isToday = day === today.getDate();
                const hasVisits = [5, 12, 18, 25].includes(day); // Sample days with visits
                
                calendarHTML += `
                    <div onclick="selectDate(${day})" style="
                        height: 40px; 
                        display: flex; 
                        align-items: center; 
                        justify-content: center; 
                        cursor: pointer; 
                        border-radius: 4px;
                        background: ${isToday ? 'rgba(239, 125, 5, 0.1)' : hasVisits ? '#fef3c7' : 'transparent'};
                        color: ${isToday ? '#d66a04' : hasVisits ? '#92400e' : '#000'};
                        font-weight: ${isToday ? '600' : 'normal'};
                        position: relative;
                    ">
                        ${day}
                        ${hasVisits ? '<div style="position: absolute; bottom: 2px; width: 4px; height: 4px; background: #f59e0b; border-radius: 50%;"></div>' : ''}
                    </div>
                `;
            }
            
            calendarHTML += '</div>';
            calendar.innerHTML = calendarHTML;
        }

        function changeMonth(direction) {
            // This would update the calendar month
            // For now, just reinitialize
            initializeVisitCalendar();
        }

        function selectDate(day) {
            // Set the selected date in the visit form
            const visitDateInput = document.getElementById('visitDate');
            if (visitDateInput) {
                const today = new Date();
                const selectedDate = new Date(today.getFullYear(), today.getMonth(), day);
                const dateString = selectedDate.toISOString().split('T')[0];
                visitDateInput.value = dateString;
            }
            
            // Show visit modal
            showModal('visitModal');
        }

        // Visit form submission
        document.addEventListener('DOMContentLoaded', function() {
            const visitForm = document.getElementById('visitForm');
            if (visitForm) {
                visitForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const formData = {
                        customer: document.getElementById('visitCustomer').value,
                        date: document.getElementById('visitDate').value,
                        startTime: document.getElementById('visitStartTime').value,
                        endTime: document.getElementById('visitEndTime').value,
                        purpose: document.getElementById('visitPurpose').value,
                        notes: document.getElementById('visitNotes').value
                    };
                    
                    // Here you would typically save the visit
                    alert('Wizyta została zaplanowana!\n\nKlient: ' + formData.customer + '\nData: ' + formData.date + '\nGodzina: ' + formData.startTime + ' - ' + formData.endTime);
                    
                    // Reset form and close modal
                    visitForm.reset();
                    hideModal('visitModal');
                    
                    // Refresh calendar
                    initializeVisitCalendar();
                });
            }
        });

        // Close modal on outside click
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('active');
                }
            });
        });

        // Initialize map
        let map = null;
        function initMap() {
            if (map) return; // Map already initialized

            map = L.map('route-map').setView([52.2297, 21.0122], 12);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors'
            }).addTo(map);

            // Add markers for customers
            const customers = [
                { name: 'Firma Budowlana Budowa', coords: [52.2297, 21.0122], number: 1 },
                { name: 'Elmas Pawlak S.J.', coords: [52.2335, 21.0188], number: 2 },
                { name: 'Przykładowa Firma Budowlana Sp. z o.o.', coords: [52.2237, 21.0044], number: 3 }
            ];

            customers.forEach(customer => {
                const marker = L.marker(customer.coords).addTo(map);
                marker.bindPopup(`<b>${customer.number}. ${customer.name}</b>`);
            });

            // Draw route line
            const routeCoords = customers.map(c => c.coords);
            L.polyline(routeCoords, { color: '#ef7d05', weight: 3 }).addTo(map);
        }

        // Scoring Configuration Functions
        function showScoringConfigModal() {
            alert('Demo: Otwieranie zaawansowanej konfiguracji scoringu...');
        }

        function saveScoringConfig() {
            const scoringData = {};
            document.querySelectorAll('.scoring-points').forEach(input => {
                const label = input.parentElement.querySelector('span').textContent;
                scoringData[label] = parseInt(input.value) || 0;
            });
            
            console.log('Zapisano konfigurację scoringu:', scoringData);
            alert('Konfiguracja scoringu została zapisana!');
        }

        function resetScoringConfig() {
            const defaultValues = {
                'Strona główna': 1,
                'Strona produktu': 3,
                'Logowanie/rejestracji': 7,
                'Strona kategorii': 2,
                'Strona koszyka': 5,
                'Strony na koncie klienta': 6,
                'Dodanie do koszyka': 4,
                'Wyszukanie produktu': 8,
                'Finalizacja zamówienia': 15,
                'Dodanie do ulubionych': 3,
                'Udostępnienie produktu': 5,
                'Kontakt z obsługą': 10
            };
            
            document.querySelectorAll('.scoring-points').forEach(input => {
                const label = input.parentElement.querySelector('span').textContent;
                input.value = defaultValues[label] || 0;
            });
            
            alert('Konfiguracja scoringu została zresetowana do domyślnych wartości!');
        }

        // Business Rules Functions
        function showAddRuleModal() {
            showModal('addRuleModal');
        }

        function updateTriggerType(selectElement) {
            const triggerItem = selectElement.closest('.trigger-item');
            const scoringConfig = triggerItem.querySelector('.scoring-trigger-config');
            const customConfig = triggerItem.querySelector('.custom-trigger-config');
            
            if (selectElement.value === 'scoring') {
                scoringConfig.style.display = 'block';
                customConfig.style.display = 'none';
            } else {
                scoringConfig.style.display = 'none';
                customConfig.style.display = 'block';
            }
        }

        function editRule(ruleId) {
            // Pre-fill edit form with rule data
            const ruleData = getRuleData(ruleId);
            
            document.getElementById('editRuleName').value = ruleData.name;
            document.getElementById('editRuleDescription').value = ruleData.description;
            document.getElementById('editRuleType').value = ruleData.type;
            document.getElementById('editRuleParameters').value = ruleData.parameters;
            document.getElementById('editRuleEnabled').checked = ruleData.enabled;
            
            // Populate triggers
            const editTriggersList = document.getElementById('editTriggersList');
            editTriggersList.innerHTML = '';
            ruleData.triggers.forEach(trigger => {
                addEditTrigger(trigger);
            });
            
            // Populate actions
            const editActionsList = document.getElementById('editActionsList');
            editActionsList.innerHTML = '';
            ruleData.actions.forEach(action => {
                addEditAction(action);
            });
            
            showModal('editRuleModal');
        }

        function getRuleData(ruleId) {
            // Mock data for existing rules
            const rules = {
                1: {
                    name: "Porzucony koszyk - wysoki scoring",
                    description: "Wykrywa klientów z wysokim scoringiem za dodawanie do koszyka, ale bez finalizacji zamówienia",
                    type: "scoring",
                    parameters: "Harmonogram: Poniedziałek-Piątek, 09:00 | Scheduler: Codziennie",
                    enabled: true,
                    triggers: [
                        "Dodanie do koszyka: 4+ punkty w ciągu 7 dni",
                        "Finalizacja zamówienia: 0 punktów w ciągu 7 dni"
                    ],
                    actions: [
                        "Wyślij email z kodem rabatowym 10% (wykonaj w ciągu 30 min)",
                        "Utwórz zadanie dla handlowca: \"Kontakt z klientem - porzucony koszyk\""
                    ]
                },
                2: {
                    name: "Spadek zaangażowania w czasie rzeczywistym",
                    description: "Monitoruje nagły spadek aktywności klienta i sugeruje działania prewencyjne",
                    type: "engagement",
                    parameters: "Próg aktywności: 3+ sesje/tydzień | Czas reakcji: 48h",
                    enabled: true,
                    triggers: [
                        "Klient aktywny ostatnie 7 dni nagle nie logował się 48h",
                        "Lub: otwarł 3+ produkty ale nie dodał do koszyka"
                    ],
                    actions: [
                        "Alert do opiekuna z sugestią kontaktu",
                        "AI sugeruje tematykę rozmowy na bazie przeglądanych produktów"
                    ]
                },
                3: {
                    name: "Analiza zachowania konkurencyjnego",
                    description: "Wykrywa klientów porównujących ceny i sugeruje strategie cenowe",
                    type: "competitive",
                    parameters: "",
                    enabled: true,
                    triggers: [
                        "Klient przegląda produkt >3 razy dziennie bez zakupu"
                    ],
                    actions: [
                        "Powiadomienie handlowca z insightem",
                        "Historia oglądanych produktów i ich ceny",
                        "Średni czas decyzji podobnych klientów",
                        "Sugerowany próg rabatu (price history i AI recommendation)"
                    ]
                },
                4: {
                    name: "Szansa Cross-sell/Up-sell",
                    description: "Wykorzystuje AI do wykrywania wzorców zakupowych i proponowania dodatkowych produktów",
                    type: "crosssell",
                    parameters: "Machine learning na historii wszystkich klientów",
                    enabled: true,
                    triggers: [
                        "Klient kupił produkt kategorii X",
                        "AI wykryło pattern zakupowy (np. zawsze dokupuje Y w ciągu 14 dni)"
                    ],
                    actions: [
                        "Zadanie dla handlowca: \"Zaproponuj produkt Y\"",
                        "Auto-email z rekomendacją (opcjonalnie)"
                    ]
                },
                5: {
                    name: "Ryzyko utraty klienta",
                    description: "Identyfikuje klientów zagrożonych odejściem i uruchamia działania retencyjne",
                    type: "retention",
                    parameters: "CLV i Retention Rate vs segment klientów z tym samym tagiem",
                    enabled: true,
                    triggers: [
                        "Wartość zamówień spadła >40% vs poprzedni kwartał",
                        "Częstotliwość logowań spadła >60%"
                    ],
                    actions: [
                        "Czerwony alert dla handlowca",
                        "Auto-generowanie propozycji retencyjnej",
                        "Szybki prewencyjny telefon do klienta"
                    ]
                },
                6: {
                    name: "Przekroczenie limitu kredytowego",
                    description: "Monitoruje wykorzystanie limitu kredytowego i uruchamia wielopoziomowe akcje",
                    type: "credit",
                    parameters: "ERP (faktury) + Platforma",
                    enabled: true,
                    triggers: [
                        "Koszyk + nieopłacone faktury > 90% limitu"
                    ],
                    actions: [
                        "90%: Info dla handlowca",
                        "95%: Alert do handlowca o potrzebie interwencji",
                        "100%: Auto-email do klienta + handlowca i dział finansowy"
                    ]
                }
            };
            
            return rules[ruleId] || {};
        }

        function addTrigger() {
            const triggersList = document.getElementById('triggersList');
            const triggerItem = document.createElement('div');
            triggerItem.className = 'trigger-item';
            triggerItem.innerHTML = `
                <input type="text" class="form-input" placeholder="Opis triggera...">
                <button type="button" class="btn btn-secondary" onclick="removeTrigger(this)">Usuń</button>
            `;
            triggersList.appendChild(triggerItem);
        }

        function removeTrigger(button) {
            button.parentElement.remove();
        }

        function addAction() {
            const actionsList = document.getElementById('actionsList');
            const actionItem = document.createElement('div');
            actionItem.className = 'action-item';
            actionItem.innerHTML = `
                <input type="text" class="form-input" placeholder="Opis akcji...">
                <button type="button" class="btn btn-secondary" onclick="removeAction(this)">Usuń</button>
            `;
            actionsList.appendChild(actionItem);
        }

        function removeAction(button) {
            button.parentElement.remove();
        }

        function addEditTrigger(text = '') {
            const editTriggersList = document.getElementById('editTriggersList');
            const triggerItem = document.createElement('div');
            triggerItem.className = 'trigger-item';
            triggerItem.innerHTML = `
                <input type="text" class="form-input" placeholder="Opis triggera..." value="${text}">
                <button type="button" class="btn btn-secondary" onclick="removeTrigger(this)">Usuń</button>
            `;
            editTriggersList.appendChild(triggerItem);
        }

        function addEditAction(text = '') {
            const editActionsList = document.getElementById('editActionsList');
            const actionItem = document.createElement('div');
            actionItem.className = 'action-item';
            actionItem.innerHTML = `
                <input type="text" class="form-input" placeholder="Opis akcji..." value="${text}">
                <button type="button" class="btn btn-secondary" onclick="removeAction(this)">Usuń</button>
            `;
            editActionsList.appendChild(actionItem);
        }

        // Prevent form submissions (for demo)
        document.querySelectorAll('form').forEach(form => {
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                alert('Demo: Formularz został przesłany pomyślnie!');
                // Close modal if form is in modal
                const modal = this.closest('.modal');
                if (modal) {
                    modal.classList.remove('active');
                }
            });
        });
    </script>
</body>
</html>